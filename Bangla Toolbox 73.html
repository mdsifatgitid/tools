<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangla Toolbox</title>
	<link rel="icon" type="image/png" href="https://mdsifatgitid.github.io/converticon.png">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and basic styles */
        /* SUTONNYMJ ফন্টটি লোড করার জন্য @font-face ব্যবহার করা হয়েছে। */
        /* মোবাইল ডিভাইসে দ্রুত এবং নির্ভরযোগ্য লোডিং নিশ্চিত করতে jsDelivr CDN ব্যবহার করা হয়েছে। */
        @font-face {
            font-family: 'SUTONNYMJ';
            src: url('https://cdn.jsdelivr.net/gh/mdsifatgitid/mdsifatgitid.github.io/SUTONNYMJ.TTF') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        /* Preloader Styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000; /* Changed to black */
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            /* পরিবর্তন: লোডার ফেড-আউট হওয়ার ট্রানজিশন ডিউরেশন 0.75s থেকে 1.5s করা হয়েছে */
            transition: opacity 1.5s ease, visibility 1.5s ease;
        }

        #preloader.preloader-hidden {
            opacity: 0;
            visibility: hidden;
        }

        #preloader-name {
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            opacity: 0;
            /* পরিবর্তন: নামের অ্যানিমেশন ডিউরেশন 2.5s থেকে 3.5s করা হয়েছে */
            animation: animate-name 3.5s ease-out forwards;
            text-align: center;
        }

        @keyframes animate-name {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes fadeInContent {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        /* Animated Background Styles */
        .area {
            background: #e0f2f7;
            background: -webkit-linear-gradient(to left, #e0f2f7, #d2eaf1);
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        /* ডার্ক মোডে অ্যানিমেটেড ব্যাকগ্রাউন্ড পরিবর্তন */
        .dark .area {
             background: #1a202c; /* গাঢ় নীল-ধূসর */
             background: -webkit-linear-gradient(to left, #2d3748, #1a202c);
        }


        .circles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .circles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.4);
            animation: animate-bg 25s linear infinite;
            bottom: -150px;
        }
        /* ডার্ক মোডে বৃত্তের রঙ পরিবর্তন */
        .dark .circles li {
            background: rgba(255, 255, 255, 0.1);
        }


        .circles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .circles li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .circles li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .circles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .circles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .circles li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .circles li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .circles li:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .circles li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .circles li:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes animate-bg {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                border-radius: 0;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
                border-radius: 50%;
            }
        }

        body {
            font-family: 'Inter', 'Hind Siliguri', sans-serif;
            display: flex;
            justify-content: center; /* horizontally center */
            align-items: center;     /* vertically center */
            min-height: 100vh;
            background-color: transparent; /* Made transparent for animated background */
            padding: 5px; /* ছোট স্ক্রিনের জন্য প্যাডিং যোগ করুন */
        }

        .main-container {
            background-color: rgba(255, 255, 255, 0.85); /* Slightly transparent white */
            backdrop-filter: blur(10px); /* Frosted glass effect */
            -webkit-backdrop-filter: blur(10px);
            padding: 10px; /* বর্ধিত প্যাডিং */
            border-radius: 20px; /* গোলাকার কোণ */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); /* গভীর ছায়া */
            max-width: 1000px; /* সমস্ত কন্টেন্টের জন্য বর্ধিত সর্বোচ্চ প্রস্থ */
            width: 100%; /* প্রতিক্রিয়াশীল প্রস্থ */
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            visibility: hidden; /* Initially hidden */
        }
        .dark .main-container {
            background-color: rgba(26, 32, 44, 0.85); /* গাঢ় ব্যাকগ্রাউন্ড */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        /* নতুন: থিম টগল বাটন */
        .theme-toggle-container {
            display: flex;
            align-items: center;
        }
        .theme-toggle-button {
            background-color: #e0e7ff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            padding: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .dark .theme-toggle-button {
            background-color: #4a5568;
        }
        .theme-toggle-button:hover {
            transform: scale(1.1);
        }
        .theme-toggle-button svg {
            width: 24px;
            height: 24px;
            color: #3f51b5;
        }
        .dark .theme-toggle-button svg {
            color: #f7fafc;
        }
        #moon-icon { display: none; }
        .dark #sun-icon { display: none; }
        .dark #moon-icon { display: block; }


        .tab-buttons {
            display: flex;
            justify-content: center;
            align-items: center; /* উল্লম্বভাবে কেন্দ্র করার জন্য যোগ করা হয়েছে */
            margin-bottom: 5px; /* বর্ধিত মার্জিন */
            gap: 10px; /* বর্ধিত ফাঁক */
            flex-wrap: wrap; /* ছোট স্ক্রিনে ট্যাবগুলি মোড়ানো */
        }

        .tab-button {
            padding: 10px 16px; /* বর্ধিত প্যাডিং */
            background-color: #e0e7ff; /* হালকা নীল */
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem; /* সামঞ্জস্যপূর্ণ ফন্ট সাইজ */
            font-weight: 600;
            color: #3f51b5; /* গাঢ় নীল টেক্সট */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .dark .tab-button {
            background-color: #2d3748;
            color: #cbd5e0;
        }

        .tab-button.active {
            background-color: #3f51b5; /* সক্রিয় ট্যাবের রঙ (গভীর নীল) */
            color: white;
            box-shadow: 0 4px 8px rgba(63, 81, 181, 0.3);
            transform: translateY(-2px);
        }
        .dark .tab-button.active {
            background-color: #4c51bf;
            color: #f7fafc;
        }

        .tab-button:hover:not(.active) {
            background-color: #c5cae9; /* হোভারে হালকা নীল */
            transform: translateY(-1px);
        }
        .dark .tab-button:hover:not(.active) {
            background-color: #4a5568;
        }

        /* মৌলিক ক্যালকুলেটর স্টাইল */
        .basic-calculator-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretcht; 
            gap: 20px;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 কলাম, সমান প্রস্থ */
            grid-template-rows: minmax(100px, auto) repeat(5, 1fr); /* ডিসপ্লে এবং 5 সারি বোতাম */
            gap: 10px; /* বোতামগুলির মধ্যে ফাঁক */
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 20px; /* গোলাকার কোণ */
            background-color: #263238; /* গাঢ় ধূসর/নীল ক্যালকুলেটর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* ছায়া */
            /* margin: 0 auto; Removed as parent flex handles centering */
            max-width: 380px; /* মৌলিক ক্যালকুলেটরের জন্য বর্ধিত প্রস্থ */
        }
        .output {
            grid-column: 1 / -1; /* ডিসপ্লে পূর্ণ প্রস্থ জুড়ে বিস্তৃত */
            background-color: #1c262b; /* ডিসপ্লে ব্যাকগ্রাউন্ড */
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: space-around;
            padding: 12px; /* বর্ধিত প্যাডিং */
            border-radius: 12px; /* ডিসপ্লের জন্য গোলাকার কোণ */
            margin-bottom: 8px; /* বর্ধিত মার্জিন */
            height: 100px; /* বর্ধিত নির্দিষ্ট উচ্চতা */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
            box-sizing: border-box; /* উচ্চতায় প্যাডিং এবং বর্ডার অন্তর্ভুক্ত করুন */
        }
        .output .previous-operand {
            color: rgba(255, 255, 255, 0.6); /* পূর্ববর্তী অপারেশনের রঙ */
            font-size: 1.5rem; /* বর্ধিত ফন্ট সাইজ */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
            align-self: flex-end; /* ডানদিকে সারিবদ্ধ করুন */
            max-width: 100%; /* নিশ্চিত করুন যে এটি তার কন্টেইনারের বাইরে না যায় */
        }
        .output .current-operand {
            color: white; /* বর্তমান অপারেশনের রঙ */
            font-size: 2.8rem; /* ফন্ট সাইজ কমানো হয়েছে */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
            align-self: flex-end; /* ডানদিকে সারিবদ্ধ করুন */
            max-width: 100%; /* নিশ্চিত করুন যে এটি তার কন্টেইনারের বাইরে না যায় */
        }
        .calculator-button {
            cursor: pointer;
            font-size: 1.6rem; /* বর্ধিত ফন্ট সাইজ */
            border: none;
            outline: none;
            background-color: #455a64; /* বোতামের ব্যাকগ্রাউন্ড (নীল-ধূসর) */
            color: white; /* বোতামের টেক্সট রঙ */
            border-radius: 10px; /* বোতামগুলির জন্য গোলাকার কোণ */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease; /* হোভার প্রভাব */
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .calculator-button:hover {
            background-color: #546e7a; /* হোভারে ব্যাকগ্রাউন্ড */
            transform: translateY(-1px);
        }
        .operator {
            background-color: #007bff; /* নীল অপারেটর বোতামের রঙ */
        }
        .operator:hover {
            background-color: #0056b3; /* নীল অপারেটর হোভার রঙ */
        }
        .equals {
            background-color: #007bff; /* ইকুয়ালস বোতামের রঙ (নীল) */
        }
        .equals:hover {
            background-color: #0056b3; /* ইকুয়ালস বোতাম হোভার রঙ (গাঢ় নীল) */
        }
        .clear {
            grid-column: span 2; /* ক্লিয়ার বোতাম দুটি কলাম জুড়ে বিস্তৃত */
            background-color: #ef5350; /* লাল ক্লিয়ার বোতামের রঙ */
            color: white; /* ক্লিয়ার বোতামের টেক্সট রঙ */
        }
        .clear:hover {
            background-color: #d32f2f; /* লাল ক্লিয়ার বোতাম হোভার রঙ */
        }
        .zero {
            grid-column: span 2; /* জিরো বোতাম দুটি কলাম জুড়ে বিস্তৃত */
        }
        
        /* নতুন: হিস্টোরি প্যানেল স্টাইল */
        .history-panel {
            background-color: #263238;
            color: white;
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-width: 300px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #455a64;
            padding-bottom: 10px;
        }
        .history-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        #clearHistoryBtn {
            background-color: #ef5350;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s ease;
        }
        #clearHistoryBtn:hover {
            background-color: #d32f2f;
        }
        #history-list {
            height: 350px;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: right;
        }
        #history-list li {
            padding: 8px 5px;
            border-bottom: 1px solid #37474f;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
        }
        #history-list li:last-child {
            border-bottom: none;
        }

        /* ব্যাখ্যা বোতামের জন্য নতুন স্টাইল */
        .explain-button {
            background-color: #28a745; /* সবুজ */
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 10px;
            margin-top: 15px;
            margin-bottom: 5px;
            display: block; /* ব্লক লেভেল উপাদান হিসাবে সেট করুন */
            margin-left: auto; /* কেন্দ্র করার জন্য */
            margin-right: auto; /* কেন্দ্র করার জন্য */
            width: fit-content; /* কন্টেন্টের আকারের সাথে প্রস্থ সামঞ্জস্য করুন */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .explain-button:hover {
            background-color: #218838;
        }

        /* বয়স ক্যালকুলেটর স্টাইল */
        .age-calculator-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 16px;
            margin: 0 auto;
            max-width: 400px; /* বয়স ক্যালকুলেটরের জন্য বর্ধিত প্রস্থ */
            background-color: #f8f9fa; /* হালকা ধূসর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .age-calculator-content {
            background-color: #2d3748;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        .age-calculator-content .input-group {
            margin-bottom: 20px; /* বর্ধিত মার্জিন */
            text-align: left;
        }
        .age-calculator-content .input-group label {
            display: block;
            margin-bottom: 8px; /* বর্ধিত মার্জিন */
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            color: #333;
            font-weight: 600;
        }
        .dark .age-calculator-content .input-group label {
            color: #e2e8f0;
        }

        .age-calculator-content .input-group input[type="date"],
        .age-calculator-content .input-group input[type="number"] {
            width: 100%;
            padding: 12px; /* বর্ধিত প্যাডিং */
            border: 1px solid #cce7ff; /* হালকা নীল বর্ডার */
            border-radius: 10px;
            font-size: 1rem; /* বর্ধিত ফন্ট সাইজ */
            box-sizing: border-box; /* প্রস্থে প্যাডিং এবং বর্ডার অন্তর্ভুক্ত করুন */
            cursor: pointer;
            background-color: #eaf6ff; /* হালকা নীল ইনপুট ব্যাকগ্রাউন্ড */
            color: #333;
        }
        .dark .age-calculator-content .input-group input[type="date"],
        .dark .age-calculator-content .input-group input[type="number"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .age-calculator-content .input-group input[type="date"] {
             appearance: none; /* ডিফল্ট তারিখ ইনপুট স্টাইলিং সরান */
            -webkit-appearance: none;
        }
        .age-calculator-content .calculate-button {
            background-color: #007bff; /* নীল বোতাম */
            color: white;
            padding: 14px 25px; /* বর্ধিত প্যাডিং */
            border: none;
            border-radius: 10px;
            font-size: 1.15rem; /* বর্ধিত ফন্ট সাইজ */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .age-calculator-content .calculate-button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .age-calculator-content .result-area {
            margin-top: 25px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff; /* ফলাফলের জন্য হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            min-height: 80px; /* বর্ধিত উচ্চতা */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .dark .age-calculator-content .result-area {
            background-color: #1a202c;
            border-color: #4a5568;
        }

        .age-calculator-content .result-area p {
            font-size: 1.3rem; /* বর্ধিত ফন্ট সাইজ */
            color: #0056b3;
            font-weight: 700;
            margin: 5px 0; /* সামঞ্জস্যপূর্ণ মার্জিন */
        }
        .dark .age-calculator-content .result-area p {
            color: #90cdf4;
        }

        .age-calculator-content .result-area .error-message {
            color: #d9534f; /* ত্রুটি বার্তার জন্য লাল */
            font-size: 1rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 500;
        }
        
        /* বছর ক্যালকুলেটরের ফলাফলের জন্য স্টাইল */
        #yearCalcResult {
            align-items: stretch;
            text-align: center;
            padding: 10px;
        }
        #yearCalcResult .result-item {
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #cce7ff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .dark #yearCalcResult .result-item {
            background-color: #4a5568;
            border-color: #718096;
        }
        #yearCalcResult h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }
        .dark #yearCalcResult h3 {
            color: #e2e8f0;
        }
        #yearCalcResult p {
            font-size: 1.2rem;
            font-weight: 600;
        }
        #yearCalcResult .past-date {
            color: #c62828; /* লাল */
        }
        .dark #yearCalcResult .past-date {
            color: #feb2b2;
        }
        #yearCalcResult .future-date {
            color: #28a745; /* সবুজ */
        }
        .dark #yearCalcResult .future-date {
            color: #9ae6b4;
        }

        /* তারিখ ও সময় ক্যালকুলেটর স্টাইল */
        .date-time-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 16px;
            margin: 0 auto;
            max-width: 450px; /* বর্ধিত প্রস্থ */
            background-color: #f8f9fa; /* হালকা ধূসর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .date-time-content {
            background-color: #2d3748;
        }
        .date-time-content .button-group {
            display: flex;
            justify-content: space-around;
            gap: 10px; /* বর্ধিত ফাঁক */
            margin-bottom: 20px; /* বর্ধিত মার্জিন */
            flex-wrap: wrap;
        }
        .date-time-content .show-date-button {
            background-color: #007bff; /* নীল বোতাম */
            color: white;
            padding: 14px 25px; /* বর্ধিত প্যাডিং */
            border: none;
            border-radius: 10px;
            font-size: 1.15rem; /* বর্ধিত ফন্ট সাইজ */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            flex: 1; /* বোতামগুলি সমান প্রস্থ নেবে */
            min-width: 160px; /* ছোট স্ক্রিনে মোড়ানোর জন্য */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .date-time-content .show-date-button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .date-time-content .result-area {
            margin-top: 25px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff; /* ফলাফলের জন্য হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            min-height: 80px; /* বর্ধিত উচ্চতা */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start; /* টেক্সট বামদিকে সারিবদ্ধ করুন */
            text-align: left; /* টেক্সট বামদিকে সারিবদ্ধ করুন */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .dark .date-time-content .result-area {
            background-color: #1a202c;
            border-color: #4a5568;
        }

        .date-time-content .result-area p {
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            color: #333;
            font-weight: 500;
            margin: 5px 0; /* সামঞ্জস্যপূর্ণ মার্জিন */
        }
        .dark .date-time-content .result-area p {
            color: #e2e8f0;
        }
        .date-time-content .result-area strong {
            font-weight: 700;
            color: #0056b3;
        }
        .dark .date-time-content .result-area strong {
            color: #90cdf4;
        }
        .date-time-content .result-section-title {
            font-size: 1.3rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 700;
            color: #0056b3;
            margin-top: 15px; /* বর্ধিত মার্জিন */
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
            width: 100%;
            text-align: center;
        }
        .dark .date-time-content .result-section-title {
            color: #90cdf4;
        }
        .date-time-content .result-section-title:first-child {
            margin-top: 0;
        }
        .date-time-content .input-group input[type="date"] {
            padding: 12px; /* বর্ধিত প্যাডিং */
            border: 1px solid #cce7ff; /* হালকা নীল বর্ডার */
            border-radius: 10px;
            font-size: 1rem; /* বর্ধিত ফন্ট সাইজ */
            background-color: #eaf6ff; /* হালকা নীল ইনপুট ব্যাকগ্রাউন্ড */
            color: #333;
        }
        .dark .date-time-content .input-group input[type="date"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .dark .text-gray-700 {
            color: #cbd5e0;
        }

        /* বৈজ্ঞানিক ক্যালকুলেটর স্টাইল */
        .scientific-calculator-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 20px; /* গোলাকার কোণ */
            background-color: #263238; /* গাঢ় ধূসর/নীল ক্যালকুলেটর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* ছায়া */
            margin: 0 auto;
            max-width: 500px; /* বর্ধিত প্রস্থ */
        }
        .scientific-calculator-content .input-area {
            margin-bottom: 15px; /* বর্ধিত মার্জিন */
        }
        .scientific-calculator-content .expression-input {
            width: 100%;
            padding: 12px; /* প্যাডিং কমানো হয়েছে */
            font-size: 1.2rem; /* ফন্ট সাইজ কমানো হয়েছে */
            border: 1px solid #ccc;
            border-radius: 12px;
            box-sizing: border-box;
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
            text-align: right;
            background-color: #1c262b;
            color: white;
            height: 55px; /* উচ্চতা কমানো হয়েছে */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
        }
        .scientific-calculator-content .scientific-buttons-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 কলামে পরিবর্তিত */
            gap: 10px; /* বর্ধিত ফাঁক */
            margin-bottom: 15px; /* বর্ধিত মার্জিন */
        }
        .scientific-calculator-content .scientific-button {
            padding: 14px; /* বর্ধিত প্যাডিং */
            font-size: 1.1rem; /* বর্ধিত ফন্ট সাইজ */
            border: none;
            outline: none;
            background-color: #455a64; /* বোতামের ব্যাকগ্রাউন্ড (নীল-ধূসর) */
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .scientific-calculator-content .scientific-button:hover {
            background-color: #546e7a;
            transform: translateY(-1px);
        }
        .scientific-calculator-content .scientific-button.operator-btn {
            background-color: #007bff; /* নীল অপারেটর */
        }
        .scientific-calculator-content .scientific-button.operator-btn:hover {
            background-color: #0056b3;
        }
        .scientific-calculator-content .scientific-button.clear-btn {
            background-color: #ef5350; /* লাল ক্লিয়ার */
            color: white;
        }
        .scientific-calculator-content .scientific-button.clear-btn:hover {
            background-color: #d32f2f;
        }
        .scientific-calculator-content .scientific-button.equals-btn {
            background-color: #007bff; /* ইকুয়ালস বোতামের রঙ (নীল) */
        }
        .scientific-calculator-content .scientific-button.equals-btn:hover {
            background-color: #0056b3;
        }
        .scientific-result { /* স্টাইলিংয়ের জন্য scientific-calculator-content এর বাইরে সরানো হয়েছে */
            margin-top: 20px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff;
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            font-size: 1.6rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 600;
            color: #0056b3;
            min-height: 65px; /* বর্ধিত উচ্চতা */
            display: flex;
            align-items: center;
            justify-content: flex-end;
            word-wrap: break-word;
            word-break: break-all;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-left: auto;
            margin-right: auto;
            max-width: 500px; /* scientific-calculator-content এর সর্বোচ্চ প্রস্থের সাথে সারিবদ্ধ করুন */
        }
        .dark .scientific-result {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #90cdf4;
        }
        .error-message { /* স্টাইলিংয়ের জন্য scientific-calculator-content এর বাইরে সরানো হয়েছে */
            color: #d9534f;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 10px;
            margin-left: auto;
            margin-right: auto;
            max-width: 500px; /* scientific-calculator-content এর সর্বোচ্চ প্রস্থের সাথে সারিবদ্ধ করুন */
        }
        .dark .error-message {
            color: #fc8181;
        }
        .dark .text-gray-800 {
            color: #f7fafc;
        }


        /* সংবাদ বিভাগের স্টাইল */
        .news-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 16px;
            margin: 0 auto;
            max-width: 480px; /* বর্ধিত প্রস্থ */
            background-color: #f8f9fa; /* হালকা ধূসর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .news-content {
            background-color: #2d3748;
        }
        .news-content .news-display-area {
            margin-top: 20px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff; /* হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            min-height: 100px; /* বর্ধিত উচ্চতা */
            text-align: left;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .dark .news-content .news-display-area {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .news-content .news-display-area h3 {
            font-size: 1.4rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 700;
            color: #0056b3;
            margin-bottom: 12px; /* বর্ধিত মার্জিন */
        }
        .dark .news-content .news-display-area h3 {
            color: #90cdf4;
        }
        .news-content .news-display-area ul {
            list-style: none;
            padding: 0;
        }
        .news-content .news-display-area li {
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
        }
        .news-content .news-display-area a {
            color: #007bff;
            text-decoration: none;
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            transition: color 0.2s ease;
        }
        .dark .news-content .news-display-area a {
            color: #63b3ed;
        }
        .news-content .news-display-area a:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        .dark .news-content .news-display-area a:hover {
            color: #90cdf4;
        }
        .news-content .news-display-area .error-message {
            color: #d9534f;
            font-size: 1rem;
            font-weight: 500;
        }

        .bio-link-section {
            margin-top: 20px; /* বর্ধিত মার্জিন */
            text-align: center;
            padding-top: 15px; /* বর্ধিত প্যাডিং */
            border-top: 1px solid #e0e0e0;
        }
        .dark .bio-link-section {
            border-top-color: #4a5568;
        }

        .bio-link-section p {
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 600;
            color: #333;
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
        }
        .dark .bio-link-section p {
            color: #e2e8f0;
        }


        /* ফন্ট কনভার্টার বিভাগের স্টাইল */
        .font-converter-content {
            padding: 15px; /* বডির সাথে মিলিয়ে প্যাডিং বাড়ানো হয়েছে */
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); /* গভীর ছায়া */
            width: 100%;
            max-width: 1000px; /* দুটি কলামের জন্য সর্বোচ্চ প্রস্থ সামঞ্জস্য করা হয়েছে */
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: #ffffff; /* কনভার্টার বিভাগের জন্য সাদা ব্যাকগ্রাউন্ড */
        }
        .dark .font-converter-content {
            background-color: #2d3748;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        .font-converter-sections-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .font-converter-sections-wrapper {
                flex-direction: row;
            }
        }
        .font-converter-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .font-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .font-section-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        .dark .font-section-header h2 {
            color: #e2e8f0;
        }
        .font-converter-content textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            color: #333; /* টেক্সটএরিয়া টেক্সট পঠনযোগ্য নিশ্চিত করুন */
        }
        .dark .font-converter-content textarea {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #f7fafc;
        }
        /* ডানদিকের টেক্সটএরিয়ার জন্য লোড করা SutonnyMJ ফন্ট ব্যবহার করার স্টাইল */
        #textAreaRight {
            font-family: 'SUTONNYMJ', sans-serif;
            font-size: 1.3rem;
        }
        .font-converter-content textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .font-button-group {
            display: flex;
            justify-content: center;
            gap: 4px; /* গ্যাপ কমানো হয়েছে */
            flex-wrap: wrap;
        }
        .font-converter-content button {
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .font-converter-content button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            z-index: -1;
            transform: skewX(-20deg);
        }
        .font-converter-content button:hover:before {
            left: 100%;
        }
        .font-converter-content button:hover {
            transform: translateY(-3px);
        }
        .font-converter-content button:active {
            transform: translateY(0);
        }

        .font-conversion-button {
            background-image: linear-gradient(to right, #34d399 0%, #10b981 100%); /* সবুজ গ্রেডিয়েন্ট */
            padding: 10px 15px; /* প্যাডিং কমানো হয়েছে */
            font-size: 1.05rem; /* সামান্য বড় ফন্ট */
            border-radius: 8px; /* আরও গোলাকার */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* উন্নত ছায়া */
        }
        .font-conversion-button:hover {
            background-image: linear-gradient(to right, #10b981 0%, #059669 100%); /* হোভারে গাঢ় সবুজ গ্রেডিয়েন্ট */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-conversion-button:active {
            background-image: linear-gradient(to right, #059669 0%, #047857 100%); /* সক্রিয় অবস্থায় আরও গাঢ় সবুজ */
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .font-copy-button {
            background-image: linear-gradient(to right, #34d399 0%, #10b981 100%); /* সবুজ গ্রেডিয়েন্ট */
            padding: 8px 15px; /* কপি বোতামের জন্য ছোট */
            font-size: 0.9rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .font-copy-button:hover {
            background-image: linear-gradient(to right, #10b981 0%, #059669 100%); /* হোভারে গাঢ় সবুজ গ্রেডিয়েন্ট */
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-copy-button:active {
            background-image: linear-gradient(to right, #059669 0%, #047857 100%); /* সক্রিয় অবস্থায় আরও গাঢ় সবুজ */
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .font-undo-redo-button {
            background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%); /* নীল গ্রেডিয়েন্ট */
            padding: 10px 15px; /* প্যাডিং কমানো হয়েছে */
            font-size: 0.95rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .font-undo-redo-button:hover {
            background-image: linear-gradient(to right, #3b82f6 0%, #2563eb 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-undo-redo-button:active {
            background-image: linear-gradient(to right, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }
        .font-undo-redo-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }

        .font-clear-button {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%); /* লাল গ্রেডিয়েন্ট */
            padding: 10px 15px; /* প্যাডিং কমানো হয়েছে */
            font-size: 0.95rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .font-clear-button:hover {
            background-image: linear-gradient(to right, #d32f2f 0%, #c62828 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-clear-button:active {
            background-image: linear-gradient(to right, #c62828 0%, #b71c1c 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .font-clear-all-button {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%); /* লাল গ্রেডিয়েন্ট */
            padding: 15px 30px;
            font-size: 1.05rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%; /* পূর্ণ প্রস্থ জুড়ে বিস্তৃত করুন */
            margin-top: 00px; /* কিছু টপ মার্জিন যোগ করুন */
        }
        .font-clear-all-button:hover {
            background-image: linear-gradient(to right, #d32f2f 0%, #c62828 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-clear-all-button:active {
            background-image: linear-gradient(to right, #c62828 0%, #b71c1c 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }


        .external-converter-link {
            display: block;
            margin-top: 100px; /* বর্ধিত মার্জিন */
            padding: 12px 18px; /* বর্ধিত প্যাডিং */
            background-color: #007bff;
            color: white;
            border-radius: 10px;
            text-decoration: none;
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center; /* লিঙ্কের মধ্যে টেক্সট কেন্দ্র করুন */
        }
        .external-converter-link:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .dark .text-green-700 {
            color: #68d391;
        }
        .dark .text-purple-700 {
            color: #b794f4;
        }
        .dark .text-blue-700 {
            color: #63b3ed;
        }
        .dark .list-disc, .dark .list-circle {
            color: #a0aec0;
        }

        /* নতুন: পরিমাপ (ইউনিট কনভার্টার) স্টাইল */
        .measurement-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 800px; /* প্রস্থ বাড়ানো হয়েছে */
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .measurement-content {
            background-color: #2d3748;
        }
        .converter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        .converter-section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .dark .converter-section {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .converter-section h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #3f51b5;
            margin-bottom: 15px;
            text-align: center;
        }
        .dark .converter-section h3 {
            color: #90cdf4;
        }
        .converter-section .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .converter-section .input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        .converter-section label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 5px;
        }
        .dark .converter-section label {
            color: #a0aec0;
        }
        .converter-section input[type="number"],
        .converter-section select {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #f7fafc;
        }
        .dark .converter-section input[type="number"],
        .dark .converter-section select {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .swap-icon {
            font-size: 1.5rem;
            color: #3f51b5;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 20px; /* ইনপুটের সাথে সারিবদ্ধ করতে */
        }
        .dark .swap-icon {
            color: #90cdf4;
        }
        .swap-icon:hover {
            transform: rotate(180deg);
        }


        /* টেক্সট অ্যাসিস্ট্যান্ট (চ্যাট) বিভাগের নতুন স্টাইল */
        .text-assistant-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px; /* চ্যাটের জন্য প্রস্থ বাড়ানো হয়েছে */
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .text-assistant-content {
            background-color: #2d3748;
        }
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .chat-header h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
        }
        .dark .chat-header h3 {
            color: #e2e8f0;
        }
        .clear-chat-button {
            background-color: #ef5350;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .clear-chat-button:hover {
            background-color: #d32f2f;
        }
        .chat-window {
            height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            background-color: #e6f7ff;
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            margin-bottom: 15px;
        }
        .dark .chat-window {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .message {
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .user-message {
            background-color: #3f51b5;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .gemini-message {
            background-color: #ffffff;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .dark .gemini-message {
            background-color: #4a5568;
            color: #f7fafc;
        }
        .gemini-error-message {
            background-color: #ffebee;
            color: #c62828;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .input-container {
            display: flex;
            gap: 10px;
            align-items: stretch; /* বোতাম এবং টেক্সটএরিয়া একই উচ্চতায় রাখুন */
        }
        .text-assistant-content textarea {
            flex-grow: 1;
            height: auto;
            min-height: 50px;
            padding: 12px;
            margin-bottom: 0;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1rem;
            resize: vertical;
        }
        .dark .text-assistant-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .text-assistant-content .ask-button {
            width: auto;
            margin-bottom: 0;
            flex-shrink: 0;
            background-color: #8A2BE2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
        }
        .text-assistant-content .loading-indicator {
            display: none;
            text-align: center;
            padding: 10px;
            font-size: 1rem;
            color: #555;
        }
        .dark .text-assistant-content .loading-indicator {
            color: #a0aec0;
        }

        /* নতুন: ফাইল আপলোড প্রিভিউ স্টাইল */
        #filePreviewContainer {
            background-color: #e6f7ff;
            border-color: #b3e0ff;
        }
        .dark #filePreviewContainer {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        #filePreviewContainer img, #filePreviewContainer video {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: cover;
        }
        #removeFileBtn {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #ef5350;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #333;
        }
        .dark .file-info {
            color: #e2e8f0;
        }
        .user-message img {
            max-width: 150px;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        /* নতুন: বাংলা বানান সংশোধন স্টাইল */
        .spell-checker-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .spell-checker-content {
            background-color: #2d3748;
        }
        .spell-checker-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
        }
        .dark .spell-checker-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .spell-checker-content .result-area #spellCheckResult {
            min-height: 150px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
            white-space: pre-wrap; /* ফরম্যাটিং বজায় রাখতে */
        }
        .dark .spell-checker-content .result-area #spellCheckResult {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        /* বানান পরীক্ষা করুন বোতামের জন্য নতুন সুন্দর স্টাইল */
        .spell-check-button {
            background-image: linear-gradient(to right, #8A2BE2 0%, #4A00E0 100%); /* বেগুনি গ্রেডিয়েন্ট */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px; /* আরও গোলাকার */
            font-size: 1.15rem;
            font-weight: 700; /* বোল্ড */
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: 100%;
            box-shadow: 0 5px 15px rgba(74, 0, 224, 0.3); /* রঙের সাথে মানানসই ছায়া */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* আইকন এবং টেক্সটের মধ্যে ফাঁক */
        }

        .spell-check-button:hover {
            background-image: linear-gradient(to right, #9932CC 0%, #5D00EE 100%); /* হোভারে ভিন্ন গ্রেডিয়েন্ট */
            transform: translateY(-2px); /* উপরে ওঠার প্রভাব */
            box-shadow: 0 8px 20px rgba(74, 0, 224, 0.4); /* গভীর ছায়া */
        }

        .spell-check-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(74, 0, 224, 0.3);
        }

        /* নতুন: লেখা সাজানো স্টাইল */
        .text-beautifier-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .text-beautifier-content {
            background-color: #2d3748;
        }
        .text-beautifier-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
        }
        .dark .text-beautifier-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .text-beautifier-content .result-area #beautifyResult {
            min-height: 150px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
            white-space: pre-wrap; /* ফরম্যাটিং বজায় রাখতে */
        }
        .dark .text-beautifier-content .result-area #beautifyResult {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        /* লেখা সাজানো বোতামের জন্য নতুন সুন্দর স্টাইল */
        .beautify-button {
            background-image: linear-gradient(to right, #20c997 0%, #087f5b 100%); /* টিল/সায়ান গ্রেডিয়েন্ট */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: 100%;
            box-shadow: 0 5px 15px rgba(32, 201, 151, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .beautify-button:hover {
            background-image: linear-gradient(to right, #12b886 0%, #099268 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(32, 201, 151, 0.4);
        }

        .beautify-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(32, 201, 151, 0.3);
        }

        /* নতুন: শব্দের অর্থ বিভাগের স্টাইল */
        .word-meaning-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .word-meaning-content {
            background-color: #2d3748;
        }
        .word-meaning-content input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
        }
        .dark .word-meaning-content input[type="text"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .word-meaning-content .result-area #wordMeaningResult {
            min-height: 150px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
            white-space: pre-wrap; /* ফরম্যাটিং বজায় রাখতে */
            text-align: left;
        }
        .dark .word-meaning-content .result-area #wordMeaningResult {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        .find-meaning-button {
            background-image: linear-gradient(to right, #fd7e14 0%, #f76707 100%); /* কমলা গ্রেডিয়েন্ট */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: 100%;
            box-shadow: 0 5px 15px rgba(253, 126, 20, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .find-meaning-button:hover {
            background-image: linear-gradient(to right, #f76707 0%, #e8590c 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(253, 126, 20, 0.4);
        }

        .find-meaning-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(253, 126, 20, 0.3);
        }
        
        /* নতুন: টেক্সট টু স্পিচ (TTS) স্টাইল */
        .tts-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .tts-content {
            background-color: #2d3748;
        }
        .tts-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
            margin-bottom: 20px;
        }
        .dark .tts-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .tts-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
        }
        .control-group label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
        }
        .dark .control-group label {
            color: #e2e8f0;
        }
        .control-group select, .control-group input[type="range"] {
            flex-grow: 1;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #cce7ff;
            background-color: #eaf6ff;
        }
        .dark .control-group select, .dark .control-group input[type="range"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .control-group input[type="range"] {
            cursor: pointer;
        }
        .control-group span {
            font-weight: 500;
            min-width: 25px;
            text-align: center;
        }
        .dark .control-group span {
            color: #e2e8f0;
        }
        .tts-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .tts-button {
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tts-button.speak {
            background-color: #28a745; /* Green */
        }
        .tts-button.speak:hover {
            background-color: #218838;
        }
        .tts-button.pause {
            background-color: #ffc107; /* Yellow */
        }
        .tts-button.pause:hover {
            background-color: #e0a800;
        }
        .tts-button.resume {
            background-color: #17a2b8; /* Cyan */
        }
        .tts-button.resume:hover {
            background-color: #138496;
        }
        .tts-button.stop {
            background-color: #dc3545; /* Red */
        }
        .tts-button.stop:hover {
            background-color: #c82333;
        }
		/* New download button style */
        .tts-button.download {
            background-color: #007bff; /* Blue */
        }
        .tts-button.download:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .tts-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* New clear button style for TTS/STT */
        .tts-button.clear-input,
        .stt-button.clear-input {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%); /* Red gradient */
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tts-button.clear-input:hover,
        .stt-button.clear-input:hover {
            background-image: linear-gradient(to right, #d32f2f 0%, #c62828 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .tts-button.clear-input:active,
        .stt-button.clear-input:active {
            background-image: linear-gradient(to right, #c62828 0%, #b71c1c 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }


        /* নতুন: স্পিচ টু টেক্সট (STT) স্টাইল */
        .stt-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .stt-content {
            background-color: #2d3748;
        }
        .stt-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
            margin-bottom: 20px;
        }
        .dark .stt-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .stt-status {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            padding: 10px;
            background-color: #e6f7ff;
            border-radius: 8px;
            border: 1px solid #b3e0ff;
        }
        .dark .stt-status {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        .stt-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .stt-button {
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .stt-button.start {
            background-color: #28a745; /* Green */
        }
        .stt-button.start:hover {
            background-color: #218838;
        }
        .stt-button.stop {
            background-color: #dc3545; /* Red */
        }
        .stt-button.stop:hover {
            background-color: #c82333;
        }
        .stt-button.copy {
            background-color: #007bff; /* Blue */
        }
        .stt-button.copy:hover {
            background-color: #0056b3;
        }
        .stt-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* নতুন: টাইপিং টেস্ট স্টাইল */
        .typing-test-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 800px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .typing-test-content {
            background-color: #2d3748;
        }
        .typing-settings {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .typing-settings label {
            font-weight: 600;
            color: #333;
        }
        .dark .typing-settings label {
            color: #e2e8f0;
        }
        .typing-settings select, .typing-settings textarea {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #cce7ff;
            background-color: #eaf6ff;
            cursor: pointer;
        }
        .dark .typing-settings select, .dark .typing-settings textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        #custom-text-input {
            width: 100%;
            margin-top: 10px;
            resize: vertical;
        }
        .typing-text-display {
            font-size: 1.2rem;
            line-height: 2.5rem;
            letter-spacing: 1px;
            padding: 20px;
            border-radius: 12px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            margin-bottom: 20px;
            text-align: justify;
            user-select: none;
            height: 180px;
            overflow-y: auto;
        }
        .dark .typing-text-display {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        .typing-text-display span.correct {
            color: #28a745;
        }
        .typing-text-display span.incorrect {
            color: #dc3545;
            text-decoration: underline;
        }
        .typing-text-display span.current {
            background-color: #b3e0ff;
            border-radius: 4px;
        }
        .dark .typing-text-display span.current {
             background-color: #4a5568;
        }
        .typing-input {
            width: 100%;
            padding: 15px;
            font-size: 1rem;
            border: 2px solid #007bff;
            border-radius: 10px;
            box-sizing: border-box;
        }
        .typing-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
        }
        .typing-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        .dark .typing-stats {
            background-color: #1a202c;
        }
        .stat-item {
            text-align: center;
        }
        .stat-item h4 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 5px;
        }
        .dark .stat-item h4 {
            color: #a0aec0;
        }
        .stat-item p {
            font-size: 1rem;
            font-weight: 700;
            color: #3f51b5;
        }
        .dark .stat-item p {
            color: #90cdf4;
        }
        .typing-controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .typing-btn {
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .typing-btn.restart {
             background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);
        }
        .typing-btn.clear {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%);
        }
		/* নতুন: টাইপিং টেস্টের পজ/রিজিউম বাটনের জন্য স্টাইল */
        .typing-btn.pause {
            background-image: linear-gradient(to right, #ffc107 0%, #f7b733 100%); /* হলুদ গ্রেডিয়েন্ট */
        }

        .typing-btn.pause:hover {
            background-image: linear-gradient(to right, #f7b733 0%, #e0a800 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .typing-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        /* নতুন: ট্রান্সলেটর স্টাইল */
        .translator-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 800px; /* সাইড-বাই-সাইড টেক্সটএরিয়ার জন্য প্রস্থ বাড়ানো হয়েছে */
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .translator-content {
            background-color: #2d3748;
        }
        .translator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .translator-section textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
            min-height: 200px;
        }
        .dark .translator-section textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .translator-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .language-selector-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .dark .language-selector-wrapper label {
            color: #e2e8f0;
        }
        .translator-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .translate-button {
            background-image: linear-gradient(to right, #2980B9 0%, #6DD5FA 100%);
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: auto;
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .translate-button:hover {
            background-image: linear-gradient(to right, #6DD5FA 0%, #2980B9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(41, 128, 185, 0.4);
        }

        /* কন্টেন্ট প্রাথমিকভাবে লুকানো */
        .calculator-content {
            display: none;
        }
        .calculator-content.active {
            display: block;
        }

/* নতুন: গুগল ম্যাপ স্টাইল */
.map-container {
    padding: 10px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 98%; /* প্রস্থ প্রায় সম্পূর্ণ স্ক্রিন জুড়ে দেওয়া হলো */
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .map-container {
    background-color: #2d3748;
}
.map-container iframe {
    border-radius: 12px;
    width: 100%;
    height: 65vh; /* উচ্চতা ভিউপোর্টের উচ্চতার ৬৫% করা হলো */
}
@media (max-width: 600px) {
    .map-container iframe {
        height: 55vh; /* মোবাইল ডিভাইসের জন্য উচ্চতা */
    }
}

/* গুগল ম্যাপের নতুন ফিচারগুলোর জন্য স্টাইল */
    .map-features {
        max-width: 98%;
        margin: 1rem auto 0;
        border: 1px solid #e2e8f0;
    }

    .dark .map-features {
        border-color: #4a5568;
    }

    .feature-section:not(:last-child) {
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 1rem;
    }

    .dark .feature-section:not(:last-child) {
        border-color: #4a5568;
    }

    .feature-section input[type="text"] {
        transition: all 0.3s ease;
    }

    .feature-section button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    /* নতুন: নামাজের সময়সূচি স্টাইল */
    .prayer-time-content {
        padding: 20px;
        border-radius: 16px;
        margin: 0 auto;
        max-width: 800px;
        background-color: #f8f9fa;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    .dark .prayer-time-content {
        background-color: #2d3748;
    }
    .prayer-times-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        text-align: center;
    }
    .prayer-time-card {
        background-color: #e6f7ff;
        border: 1px solid #b3e0ff;
        border-radius: 12px;
        padding: 20px 15px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .dark .prayer-time-card {
        background-color: #1a202c;
        border-color: #4a5568;
    }
    .prayer-time-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    .prayer-time-card h4 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #0056b3;
        margin-bottom: 10px;
    }
    .dark .prayer-time-card h4 {
        color: #90cdf4;
    }
    .prayer-time-card p {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
    }
    .dark .prayer-time-card p {
        color: #e2e8f0;
    }
	
	/* টগল সুইচের জন্য CSS */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
}

input:checked + .slider {
    background-color: #2196F3;
}

input:focus + .slider {
    box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
    -webkit-transform: translateX(26px);
    -ms-transform: translateX(26px);
    transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

        /* API কী মডেল স্টাইল */
        .api-key-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* গাঢ় ব্যাকগ্রাউন্ড */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px); /* ব্যাকগ্রাউন্ড ব্লার */
        }

        .api-key-modal-content {
            background-color: #ffffff;
            padding: 30px; /* বর্ধিত প্যাডিং */
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* গভীর ছায়া */
            max-width: 450px;
            width: 90%;
            text-align: center;
            transform: translateY(-30px); /* সামান্য উপর থেকে আসবে */
            animation: fadeInScale 0.4s ease-out forwards;
        }
        .dark .api-key-modal-content {
            background-color: #2d3748;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .api-key-modal-content h3 {
            font-size: 1.8rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 700;
            color: #333;
            margin-bottom: 25px; /* বর্ধিত মার্জিন */
        }
        .dark .api-key-modal-content h3 {
            color: #e2e8f0;
        }

        .api-key-modal-content input[type="text"] {
            width: 100%;
            padding: 15px; /* বর্ধিত প্যাডিং */
            margin-bottom: 20px; /* বর্ধিত মার্জিন */
            border: 1px solid #cce7ff; /* হালকা নীল বর্ডার */
            border-radius: 10px;
            font-size: 1.05rem;
            box-sizing: border-box;
            background-color: #eaf6ff; /* হালকা নীল ইনপুট ব্যাকগ্রাউন্ড */
            color: #333;
        }
        .dark .api-key-modal-content input[type="text"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }

        .api-key-modal-content .modal-buttons {
            display: flex;
            justify-content: space-around;
            gap: 15px; /* বর্ধিত ফাঁক */
        }

        .api-key-modal-content .modal-button {
            padding: 12px 25px; /* বর্ধিত প্যাডিং */
            border: none;
            border-radius: 10px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            flex: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .api-key-modal-content .modal-button.save {
            background-color: #28a745; /* সবুজ */
            color: white;
        }
        .api-key-modal-content .modal-button.save:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

        .api-key-modal-content .modal-button.cancel {
            background-color: #ef5350; /* লাল */
            color: white;
        }
        .api-key-modal-content .modal-button.cancel:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
        }

        .api-key-modal-content .message-area {
            margin-top: 20px; /* বর্ধিত মার্জিন */
            font-size: 1rem;
            font-weight: 500;
            min-height: 25px; /* বার্তা প্রদর্শনের জন্য ন্যূনতম উচ্চতা */
        }
        .api-key-modal-content .message-area.success {
            color: #28a745; /* সবুজ */
        }
        .dark .api-key-modal-content .message-area.success {
            color: #68d391;
        }
        .api-key-modal-content .message-area.error {
            color: #d9534f; /* লাল */
        }
        .dark .api-key-modal-content .message-area.error {
            color: #fc8181;
        }
        .dark .response-area {
            background-color: #1a202c !important;
            border-color: #4a5568 !important;
            color: #e2e8f0;
        }

        /* নতুন: বর্তমান তারিখ ও সময় ব্যানার */
        #currentDateTimeBanner {
            display: flex; /* Flexbox ব্যবহার করুন */
            justify-content: center; /* অনুভূমিকভাবে মাঝখানে আনুন */
            align-items: center; /* উল্লম্বভাবে মাঝখানে আনুন */
            flex-wrap: wrap; /* ছোট স্ক্রিনে টেক্সট মোড়ানোর জন্য */
            text-align: center;
            font-size: 0.95rem; /* ফন্ট সাইজ সামঞ্জস্য করুন */
            font-weight: 600;
            margin-bottom: 10px; /* এখানে মার্জিন কমানো হয়েছে */
            margin-top: 0px; /* এখানে মার্জিন কমানো হয়েছে */
            padding: 05px 05px; /* প্যাডিং যোগ করুন */
            background-color: #e0e7ff; /* হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 15px; /* গোলাকার কোণ */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* হালকা শ্যাডো */
            color: #3f51b5; /* টেক্সটের রঙ */
            line-height: 1.5; /* লাইন উচ্চতা */
        }
        .dark #currentDateTimeBanner {
            background-color: #2d3748; /* ডার্ক মোডে গাঢ় ব্যাকগ্রাউন্ড */
            color: #cbd5e0; /* ডার্ক মোডে হালকা টেক্সট */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        #currentDateTimeBanner span {
            margin: 0 4px; /* প্রতিটি অংশের মধ্যে সামান্য ফাঁক */
        }

        /* ছোট স্ক্রিনের জন্য প্রতিক্রিয়াশীল সামঞ্জস্য */
        @media (max-width: 768px) {
            .translator-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 600px) {
            .main-container {
                padding: 15px;
                border-radius: 15px;
            }
            #preloader-name {
                font-size: 1.8rem;
            }
            #currentDateTimeBanner {
                font-size: 0.8rem; /* ছোট স্ক্রিনে ফন্ট সাইজ আরও কমানো */
                padding: 8px 10px;
                margin-bottom: 0px; /* এখানে মার্জিন কমানো হয়েছে */
                margin-top: 0px; /* এখানে মার্জিন কমানো হয়েছে */
            }
            #currentDateTimeBanner span {
                margin: 0 2px;
            }
            .tab-buttons {
                margin-bottom: 15px;
                gap: 6px;
            }
            .tab-button {
                padding: 8px 10px;
                font-size: 0.8rem;
                border-radius: 8px;
            }
            .calculator-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: minmax(80px, auto) repeat(5, 1fr);
                gap: 8px;
                padding: 15px;
                max-width: 320px;
            }
            .calculator-button {
                font-size: 1.4rem;
                border-radius: 8px;
            }
            .output {
                height: 80px;
                padding: 10px;
                border-radius: 10px;
            }
            .output .current-operand {
                font-size: 2.4rem; /* ছোট স্ক্রিনের জন্য ফন্ট সাইজ কমানো হয়েছে */
            }
            .output .previous-operand {
                font-size: 1.3rem;
            }
            .explain-button {
                padding: 8px 15px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            .age-calculator-content,
            .date-time-content,
            .scientific-calculator-content,
            .news-content,
            .font-converter-content,
            .measurement-content, /* Measurement content responsiveness */
            .text-assistant-content,
            .spell-checker-content,
            .text-beautifier-content,
            .word-meaning-content,
            .tts-content,
            .stt-content,
            .typing-test-content,
            .translator-content { /* Translator content responsiveness */
                padding: 15px;
                border-radius: 12px;
            }
            .age-calculator-content .input-group label,
            .date-time-content .input-group label {
                font-size: 0.95rem;
            }
            .age-calculator-content .input-group input[type="date"],
            .date-time-content .input-group input[type="date"] {
                padding: 10px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            .age-calculator-content .calculate-button,
            .date-time-content .show-date-button {
                padding: 12px 20px;
                font-size: 1.05rem;
                border-radius: 8px;
            }
            .age-calculator-content .result-area p,
            .date-time-content .result-area p {
                font-size: 1rem;
            }
            .scientific-calculator-content .expression-input {
                font-size: 1.1rem; /* ছোট স্ক্রিনের জন্য ফন্ট সাইজ কমানো হয়েছে */
                padding: 10px; /* ছোট স্ক্রিনের জন্য প্যাডিং কমানো হয়েছে */
                height: 45px; /* ছোট স্ক্রিনের জন্য উচ্চতা কমানো হয়েছে */
                border-radius: 10px;
            }
            .scientific-button { /* বৈজ্ঞানিক বোতামের জন্য সামঞ্জস্যপূর্ণ */
                font-size: 0.9rem;
                padding: 10px;
                border-radius: 8px;
            }
            .scientific-result { /* বৈজ্ঞানিক ফলাফলের জন্য সামঞ্জস্যপূর্ণ */
                font-size: 1.4rem;
                padding: 15px;
                min-height: 55px;
                border-radius: 12px;
            }
            .news-content .news-display-area h3 {
                font-size: 1.3rem;
            }
            .news-content .news-display-area a {
                font-size: 0.95rem;
            }
            .font-converter-content textarea {
                height: 100px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .font-converter-content .font-conversion-button { /* কনভার্টার বোতাম থেকে পরিবর্তিত */
                padding: 10px 15px;
                font-size: 0.95rem;
                min-width: 140px;
                border-radius: 8px;
            }
            .font-converter-content .font-copy-button { /* কনভার্টার বোতাম থেকে পরিবর্তিত */
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
            .font-undo-redo-button {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
            .font-clear-button {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
            .font-clear-all-button {
                padding: 12px 20px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .text-assistant-content textarea {
                height: 120px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .text-assistant-content .ask-button {
                padding: 12px 20px;
                font-size: 1.05rem;
                border-radius: 8px;
            }
            .api-key-modal-content {
                padding: 20px;
                border-radius: 15px;
            }
            .api-key-modal-content h3 {
                font-size: 1.5rem;
            }
            .api-key-modal-content input[type="text"] {
                padding: 12px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .api-key-modal-content .modal-button {
                padding: 10px 15px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
        }
		/* নতুন: ছবি থেকে লেখা (OCR) স্টাইল */
.image-to-text-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 600px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .image-to-text-content {
    background-color: #2d3748;
}
.image-upload-area {
    border: 2px dashed #007bff;
    border-radius: 12px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    background-color: #eaf6ff;
    transition: background-color 0.3s ease;
}
.dark .image-upload-area {
    border-color: #63b3ed;
    background-color: #1a202c;
}
.image-upload-area:hover {
    background-color: #d4eaff;
}
.dark .image-upload-area:hover {
    background-color: #2c3748;
}
.image-upload-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: #007bff;
    font-weight: 600;
    cursor: pointer;
}
.dark .image-upload-label {
    color: #63b3ed;
}
.image-preview {
    margin-top: 20px;
    text-align: center;
    position: relative;
}
.image-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 12px;
    border: 2px solid #b3e0ff;
}
.dark .image-preview img {
    border-color: #4a5568;
}
.image-preview .remove-image-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: rgba(239, 83, 80, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 1.5rem;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.extract-text-button {
    background-image: linear-gradient(to right, #6d28d9 0%, #4c1d95 100%); /* Deep Purple Gradient */
    color: white;
    padding: 14px 25px;
    border: none;
    border-radius: 12px;
    font-size: 1.15rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    width: 100%;
    box-shadow: 0 5px 15px rgba(109, 40, 217, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.extract-text-button:hover {
    background-image: linear-gradient(to right, #5b21b6 0%, #4c1d95 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(109, 40, 217, 0.4);
}
.image-to-text-content .result-area textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1.1rem;
    resize: vertical;
    box-sizing: border-box;
    background-color: #eaf6ff;
    color: #333;
	text-align: justify;
}
.dark .image-to-text-content .result-area textarea {
    background-color: #1a202c;
    border-color: #4a5568;
    color: #f7fafc;
}
/* Drag & Drop এর জন্য নতুন স্টাইল */
.image-upload-area.drag-over {
    background-color: #cce7ff; /* ড্র্যাগ করার সময় ব্যাকগ্রাউন্ড রঙ পরিবর্তন হবে */
    border-style: solid;
    border-color: #0056b3;
}
.dark .image-upload-area.drag-over {
    background-color: #2c3748;
    border-color: #90cdf4;
}
/* নতুন: ওয়ার্ড কাউন্টার স্টাইল */
.word-counter-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 800px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .word-counter-content {
    background-color: #2d3748;
}

/* নতুন: আবহাওয়া বিভাগের স্টাইল */
.weather-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 500px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .weather-content {
    background-color: #2d3748;
}
.weather-search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.city-input {
    flex-grow: 1;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1rem;
    background-color: #eaf6ff;
    color: #333;
}
.dark .city-input {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.search-weather-button {
    background-color: #007bff;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
.search-weather-button:hover {
    background-color: #0056b3;
}
.weather-result-area {
    background-color: #e6f7ff;
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    border: 1px solid #b3e0ff;
    min-height: auto; /* উচ্চতা পরিবর্তন করা হয়েছে */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* কন্টেন্ট ওপর থেকে শুরু হবে */
}
.dark .weather-result-area {
    background-color: #1a202c;
    border-color: #4a5568;
}
.weather-result-area h4 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #0056b3;
}
.dark .weather-result-area h4 {
    color: #90cdf4;
}
.weather-result-area .weather-icon {
    width: 100px;
    height: 100px;
    margin: 10px auto;
}
.weather-result-area .temp {
    font-size: 2.5rem;
    font-weight: 700;
}
.weather-result-area .description {
    font-size: 1.2rem;
    text-transform: capitalize;
    margin-bottom: 15px;
}

/* নতুন যুক্ত করা এবং আপডেট করা স্টাইল */
.weather-feels-like {
    font-size: 1rem;
    margin-top: -10px;
    margin-bottom: 15px;
    color: #555;
}
.dark .weather-feels-like {
    color: #a0aec0;
}
.weather-extra-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    width: 100%;
    margin-top: 20px;
    text-align: left;
}
.detail-item {
    background-color: rgba(255, 255, 255, 0.5);
    padding: 10px;
    border-radius: 10px;
}
.dark .detail-item {
    background-color: rgba(0, 0, 0, 0.2);
}
.detail-item strong {
    display: block;
    font-size: 0.9rem;
    color: #3f51b5;
    margin-bottom: 5px;
}
.dark .detail-item strong {
    color: #90cdf4;
}

/* নতুন: নোটপ্যাড / টু-ডু লিস্ট স্টাইল (আপডেট করা) */
.notepad-container {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 600px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .notepad-container {
    background-color: #2d3748;
}
.notepad-input-area {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.task-input {
    flex-grow: 1;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1rem;
    background-color: #eaf6ff;
    color: #333;
}
.dark .task-input {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.add-task-btn {
    background-color: #28a745;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color: 0.3s ease;
}
.add-task-btn:hover {
    background-color: #218838;
}
.task-list {
    list-style: none;
    padding: 0;
    max-height: 400px;
    overflow-y: auto;
}
.task-item {
    display: flex;
    align-items: center; /* উল্লম্বভাবে মাঝখানে রাখার জন্য */
    gap: 10px; /* আইটেমগুলোর মধ্যে ফাঁক */
    padding: 12px;
    background-color: #ffffff;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    word-break: break-word;
}
.dark .task-item {
    background-color: #1a202c;
    border-color: #4a5568;
}
.task-item.completed .task-text { /* Selector updated */
    text-decoration: line-through;
    color: #6c757d;
}
.dark .task-item.completed .task-text { /* Dark mode selector updated */
    color: #a0aec0;
}
.task-item .task-text { /* New class for text span */
    flex-grow: 1;
    text-align: justify; /* Justify can look weird for short text */
    cursor: pointer;
}
.dark .task-item .task-text {
    color: #f4f4f4; /* এটি একটি হালকা ধূসর রং যা কালো ব্যাকগ্রাউন্ডে ভালোভাবে দেখা যাবে */
}
.delete-task-btn {
    background-color: #ef5350;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 1.2rem;
    cursor: pointer;
    margin-left: auto; /* ডিলিট বাটন ডানদিকে ঠেলে দেওয়ার জন্য */
    flex-shrink: 0;
    line-height: 1;
    transition: background-color 0.2s ease;
}
.delete-task-btn:hover {
    background-color: #d32f2f;
}

/* নতুন: টাস্ক আইটেমের নাম্বারিং স্টাইল (আপডেট করা) */
.task-number {
    font-weight: bold;
    color: #3f51b5;
    background-color: #e0e7ff;
    border-radius: 50%;
    width: 24px;       /* সাইজ কমানো হয়েছে */
    height: 24px;      /* সাইজ কমানো হয়েছে */
    font-size: 0.85rem;  /* ফন্ট সাইজ কমানো হয়েছে */
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    flex-shrink: 0;
}

.dark .task-number {
    color: #90cdf4;
    background-color: #4a5568;
}

/* নতুন: ড্র্যাগ করার সময় টাস্ক আইটেমের স্টাইল */
.task-item.dragging {
    opacity: 0.5;
    background-color: #cce7ff;
}

.dark .task-item.dragging {
    background-color: #2c3748;
}


 /* প্রিসেট ড্রপডাউন বাটনের জন্য নতুন CSS */
    #presetButtonLeft.open svg, #presetButtonRight.open svg {
        transform: rotate(180deg);
    }


<!-- এখান থেকে ওপরে নতুন ট্যাবের সি এস এস কোড লিখতে হবে -->
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <h1 id="preloader-name">Md Shahiduzzaman Sifat</h1>
    </div>

    <!-- Animated Background -->
    <div class="area">
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>
	
<!--css style started from here ওপরে অন্যান্য স্টাইলগুলো আছে।-->

    <div class="main-container">
        <!-- বর্তমান তারিখ ও সময় ব্যানার -->
        <!-- মার্জিন কমানো হয়েছে: mb-4 থেকে mb-0 এবং mt-0 যোগ করা হয়েছে -->
        <div id="currentDateTimeBanner" class="text-center text-lg font-semibold mb-0 mt-0 p-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg shadow-md">
            <!-- JavaScript দ্বারা তারিখ ও সময় এখানে আপডেট হবে -->
        </div>

        <h2 class="text-3xl font-bold text-gray-800 mb-4">বাংলা টুলবক্স</h2>

        <div class="tab-buttons">
            <!-- থিম টগল বাটন এখানে সরানো হয়েছে -->
            <div class="theme-toggle-container">
                <button id="theme-toggle" type="button" class="theme-toggle-button" title="লাইট/ডার্ক মোডে পরিবর্তন করুন">
                    <svg id="sun-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                    <svg id="moon-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                </button>
            </div>
            <button id="basicCalcTab" class="tab-button active rounded-xl">সাধারণ ক্যালকুলেটর</button>
            <button id="scientificCalcTab" class="tab-button rounded-xl">সাইন্টিফিক ক্যালকুলেটর</button>
            <button id="ageCalcTab" class="tab-button rounded-xl">বয়স ক্যালকুলেটর</button>
            <button id="dateCalcTab" class="tab-button rounded-xl">তারিখ ও সময়</button>
            <button id="measurementTab" class="tab-button rounded-xl">পরিমাপ</button>
            <button id="typingTestTab" class="tab-button rounded-xl">টাইপিং টেস্ট</button>
            <button id="converterTab" class="tab-button rounded-xl">কনভার্টার</button>
            <button id="translatorTab" class="tab-button rounded-xl">ট্রান্সলেটর</button> <!-- নতুন ট্রান্সলেটর বাটন -->
            <button id="spellCheckTab" class="tab-button rounded-xl">বানান সংশোধন</button>
            <button id="textBeautifierTab" class="tab-button rounded-xl">লেখা সাজানো</button>
            <button id="wordMeaningTab" class="tab-button rounded-xl">শব্দের অর্থ</button>
            <button id="ttsTab" class="tab-button rounded-xl">টেক্সট টু স্পিচ</button>
            <button id="sttTab" class="tab-button rounded-xl">স্পিচ টু টেক্সট</button>
            <button id="textAssistantTab" class="tab-button rounded-xl">টেক্সট অ্যাসিস্ট্যান্ট</button>
            <button id="newsTab" class="tab-button rounded-xl">সাম্প্রতিক খবর</button>
			<button id="mapTab" class="tab-button rounded-xl">গুগল ম্যাপ</button>
			<button id="prayerTimeTab" class="tab-button rounded-xl">নামাজের সময়সূচি</button>
			<button id="imageToTextTab" class="tab-button rounded-xl">ছবি থেকে লেখা</button>
			<button id="wordCounterTab" class="tab-button rounded-xl">ওয়ার্ড কাউন্টার</button>
			<button id="weatherTab" class="tab-button rounded-xl">আবহাওয়া</button>
			<button id="notepadTab" class="tab-button rounded-xl">নোটপ্যাড</button>
            <button id="allFeaturesTab" class="tab-button rounded-xl">সকল ফিচার</button>
            <button id="setApiKeyBtn" class="tab-button rounded-xl" style="background-color: #ef5350; color: white;">API কী সেট করুন</button>
        </div>

        <!-- মৌলিক ক্যালকুলেটর বিভাগ -->
        <div id="basicCalculatorContent" class="calculator-content active">
            <div class="basic-calculator-wrapper">
                <div class="calculator-grid">
                    <div class="output">
                        <div data-previous-operand class="previous-operand"></div>
                        <div data-current-operand class="current-operand"></div>
                    </div>
                    <button data-all-clear class="clear calculator-button rounded-xl" style="grid-column: span 2;">AC</button>
                    <button data-delete class="calculator-button rounded-xl">DEL</button>
                    <button data-operator class="operator calculator-button rounded-xl">÷</button> <!-- ভাগ -->
                    <button data-number class="calculator-button rounded-xl">7</button>
                    <button data-number class="calculator-button rounded-xl">8</button>
                    <button data-number class="calculator-button rounded-xl">9</button>
                    <button data-operator class="operator calculator-button rounded-xl">×</button> <!-- গুণ -->
                    <button data-number class="calculator-button rounded-xl">4</button>
                    <button data-number class="calculator-button rounded-xl">5</button>
                    <button data-number class="calculator-button rounded-xl">6</button>
                    <button data-operator class="operator calculator-button rounded-xl">-</button> <!-- বিয়োগ -->
                    <button data-number class="calculator-button rounded-xl">1</button>
                    <button data-number class="calculator-button rounded-xl">2</button>
                    <button data-number class="calculator-button rounded-xl">3</button>
                    <button data-operator class="operator calculator-button rounded-xl">+</button> <!-- যোগ -->
                    <button data-number class="zero calculator-button rounded-xl" style="grid-column: span 2;">0</button>
                    <button data-number class="calculator-button rounded-xl">.</button>
                    <button data-equals class="equals calculator-button rounded-xl">=</button> <!-- সমান -->
                </div>
                <!-- নতুন: হিস্টোরি প্যানেল -->
                <div class="history-panel">
                    <div class="history-header">
                        <h3>হিস্টোরি</h3>
                        <button id="clearHistoryBtn">মুছুন</button>
                    </div>
                    <ul id="history-list">
                        <!-- হিস্টোরি আইটেম এখানে যুক্ত হবে -->
                    </ul>
                </div>
            </div>
            <!-- LLM-চালিত ব্যাখ্যা বৈশিষ্ট্য -->
            <button id="explainBasicBtn" class="explain-button rounded-xl">ব্যাখ্যা করুন ✨</button>
            <div id="basicExplanationLoading" class="loading-indicator">জেমিনি ব্যাখ্যা করছে</div>
            <div id="basicExplanation" class="response-area rounded-lg mt-4" style="background-color: #e6f7ff; border: 1px solid #b3e0ff;"></div>
        </div>

        <!-- বয়স ক্যালকুলেটর বিভাগ -->
        <div id="ageCalculatorContent" class="calculator-content">
            <div class="age-calculator-content">
                <!-- Existing Age Calculator -->
                <h3 class="text-xl font-bold text-gray-700 mb-4">বয়স গণনা করুন</h3>
                <div class="input-group">
                    <label for="birthDate">জন্ম তারিখ:</label>
                    <input type="date" id="birthDate" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="input-group">
                    <label for="currentDate">বর্তমান তারিখ:</label>
                    <input type="date" id="currentDate" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button id="calculateAgeBtn" class="calculate-button rounded-xl">বয়স গণনা করুন</button>
                <div id="ageResultArea" class="result-area">
                    <p id="ageResult" class="text-xl"></p>
                    <p id="ageErrorMessage" class="error-message"></p>
                </div>
                
                <!-- Divider -->
                <hr class="my-8 border-gray-300">

                <!-- New Year Calculator Feature -->
                <h3 class="text-xl font-bold text-gray-700 mb-4">বছর ক্যালকুলেটর</h3>
                <p class="text-gray-600 mb-4">যেকোনো তারিখ থেকে নির্দিষ্ট বছর আগে ও পরের তারিখ খুঁজুন।</p>
                <div class="input-group">
                    <label for="yearCalcDateInput">একটি তারিখ নির্বাচন করুন (খালি রাখলে আজকের তারিখ ব্যবহৃত হবে)</label>
                    <input type="date" id="yearCalcDateInput" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="input-group">
                    <label for="yearCalcYearsInput">বছরের সংখ্যা লিখুন</label>
                    <input type="number" id="yearCalcYearsInput" value="10" placeholder="যেমন: ১০" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button id="calculateYearsBtn" class="calculate-button rounded-xl">হিসাব করুন</button>
                <div id="yearCalcResult" class="result-area">
                    <!-- Results will be injected here -->
                </div>
            </div>
        </div>


        <!-- তারিখ ও সময় ক্যালকুলেটর বিভাগ -->
        <div id="dateCalculatorContent" class="calculator-content">
            <div class="date-time-content">
                <div class="button-group">
                    <button id="showTodayDatesBtn" class="show-date-button rounded-xl">আজকের তারিখ ও সময়</button>
                    <button id="showTomorrowDatesBtn" class="show-date-button rounded-xl">আগামীকালের তারিখ ও সময়</button>
                </div>
                <div id="dateDisplayResult" class="result-area">
                    <!-- আজকের তারিখের জন্য -->
                    <div id="todayResultSection">
                        <p class="result-section-title">আজকের তারিখ</p>
                        <p id="todayGregorianDateDisplay"></p>
                        <p id="todayBengaliDateDisplay"></p>
                        <p id="todayHijriDateDisplay"></p>
                        <p id="todayDayDisplay"></p> <!-- আজকের দিনের জন্য নতুন সারি -->
                        <p id="todayTimeDisplay"></p>
                    </div>

                    <!-- আগামীকালের তারিখের জন্য -->
                    <div id="tomorrowResultSection" style="display: none;">
                        <p class="result-section-title">আগামীকালের তারিখ</p>
                        <p id="tomorrowGregorianDateDisplay"></p>
                        <p id="tomorrowBengaliDateDisplay"></p>
                        <p id="tomorrowHijriDateDisplay"></p>
                        <p id="tomorrowDayDisplay"></p> <!-- আগামীকালের দিনের জন্য নতুন সারি -->
                        <p id="tomorrowTimeDisplay"></p>
                    </div>
                </div>

                <!-- ইংরেজি থেকে বাংলা তারিখ রূপান্তর বৈশিষ্ট্য -->
                <div class="input-group mt-6">
                    <label for="englishDateInput" class="text-gray-700 font-semibold text-left block mb-2">ইংরেজি তারিখ লিখুন:</label>
                    <input type="date" id="englishDateInput" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full p-2 border border-gray-300">
                </div>
                <button id="convertEnglishToBengaliBtn" class="show-date-button rounded-xl mt-4">বাংলা তারিখে রূপান্তর করুন</button>
                <div id="bengaliConvertedDateDisplay" class="result-area mt-4">
                    <p class="result-section-title">রূপান্তরিত বাংলা তারিখ</p>
                    <p id="convertedBengaliDate"></p>
                    <p id="convertedDayDisplay"></p> <!-- রূপান্তরিত দিনের জন্য নতুন সারি -->
                </div>
                <!-- নতুন বোতাম এবং লিংক -->
                <a href="https://ajkertarikh.com" target="_blank" class="show-date-button rounded-xl mt-4 block mx-auto text-center">প্রয়োজনে এখানে তারিখ দেখুন</a>
            </div>
        </div>

        <!-- বৈজ্ঞানিক ক্যালকুলেটর বিভাগ -->
        <div id="scientificCalculatorContent" class="calculator-content">
            <div class="scientific-calculator-content">
                <div class="input-area">
                    <input type="text" id="scientificExpressionInput" class="expression-input rounded-lg" placeholder="এক্সপ্রেশন লিখুন (যেমন: sin(90) + 2*3)">
                </div>
                <div class="scientific-buttons-grid">
                    <!-- সারি 1 -->
                    <button class="scientific-button clear-btn rounded-lg" data-sci-input="C" style="grid-column: span 2;">C</button>
                    <button class="scientific-button rounded-lg" data-sci-input="DEL">DEL</button>
                    <button class="scientific-button rounded-lg" data-sci-input="(">(</button>
                    <button class="scientific-button rounded-lg" data-sci-input=")">)</button>

                    <!-- সারি 2 (সংখ্যা 1-2-3) -->
                    <button class="scientific-button rounded-lg" data-sci-input="1">1</button>
                    <button class="scientific-button rounded-lg" data-sci-input="2">2</button>
                    <button class="scientific-button rounded-lg" data-sci-input="3">3</button>
                    <button class="scientific-button rounded-lg" data-sci-input="sin">sin</button>
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="÷">÷</button> <!-- ভাগ -->

                    <!-- সারি 3 (সংখ্যা 4-5-6) -->
                    <button class="scientific-button rounded-lg" data-sci-input="4">4</button>
                    <button class="scientific-button rounded-lg" data-sci-input="5">5</button>
                    <button class="scientific-button rounded-lg" data-sci-input="6">6</button>
                    <button class="scientific-button rounded-lg" data-sci-input="cos">cos</button>
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="×">×</button> <!-- গুণ -->

                    <!-- সারি 4 (সংখ্যা 7-8-9, tan, -) - পরিবর্তিত -->
                    <button class="scientific-button rounded-lg" data-sci-input="7">7</button>
                    <button class="scientific-button rounded-lg" data-sci-input="8">8</button>
                    <button class="scientific-button rounded-lg" data-sci-input="9">9</button>
                    <button class="scientific-button rounded-lg" data-sci-input="tan">tan</button> <!-- '7' এর পরিবর্তে 'tan' -->
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="-">-</button> <!-- '-' এখানে সরানো হয়েছে -->

                    <!-- সারি 5 (সংখ্যা 0 এবং অন্যান্য) -->
                    <button class="scientific-button rounded-lg" data-sci-input="0" style="grid-column: span 2;">0</button>
                    <button class="scientific-button rounded-lg" data-sci-input=".">.</button>
                    <button class="scientific-button rounded-lg" data-sci-input="π">π</button>
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="+">+</button> <!-- যোগ -->

                    <!-- সারি 6 (log, ln, sqrt, ^, =) -->
                    <button class="scientific-button rounded-lg" data-sci-input="log">log</button>
                    <button class="scientific-button rounded-lg" data-sci-input="ln">ln</button>
                    <button class="scientific-button rounded-lg" data-sci-input="sqrt">√</button>
                    <button class="scientific-button rounded-lg" data-sci-input="^">^</button>
                    <button class="scientific-button equals-btn rounded-lg" data-sci-equals style="grid-column: span 1;">=</button> <!-- সমান -->

                </div>
            </div>
            <!-- scientific-calculator-content এর বাইরে সরানো হয়েছে -->
            <div id="scientificResult" class="scientific-result rounded-lg"></div>
            <div id="scientificErrorMessage" class="error-message"></div>
            <!-- LLM-চালিত ব্যাখ্যা বৈশিষ্ট্য -->
            <button id="explainScientificBtn" class="explain-button rounded-xl">ব্যাখ্যা করুন ✨</button>
            <div id="scientificExplanationLoading" class="loading-indicator">জেমিনি ব্যাখ্যা করছে</div>
            <div id="scientificExplanation" class="response-area rounded-lg mt-4" style="background-color: #e6f7ff; border: 1px solid #b3e0ff;"></div>
        </div>

<!-- পরিমাপ (ইউনিট কনভার্টার) বিভাগ শুরু -->
<div id="measurementContent" class="calculator-content">
    <div class="measurement-content">
        <div class="converter-grid">
            <!-- দৈর্ঘ্য রূপান্তরকারী -->
            <div class="converter-section">
                <h3>দৈর্ঘ্য রূপান্তরকারী</h3>
                <div class="input-row">
                    <div class="input-wrapper">
                        <label for="lengthFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="lengthFromValue" class="unit-input" data-converter="length" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="lengthFromUnit">একক</label>
                        <select id="lengthFromUnit" class="unit-select" data-converter="length">
                            <option value="meter">মিটার</option>
                            <option value="kilometer">কিলোমিটার</option>
                            <option value="centimeter">সেন্টিমিটার</option>
                            <option value="millimeter">মিলিমিটার</option>
                            <option value="mile">মাইল</option>
                            <option value="yard">গজ</option>
                            <option value="foot" selected>ফুট</option>
                            <option value="inch">ইঞ্চি</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="lengthToValue">ফলাফল (তে)</label>
                        <input type="number" id="lengthToValue" class="unit-input" data-converter="length_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="lengthToUnit">একক</label>
                        <select id="lengthToUnit" class="unit-select" data-converter="length">
                            <option value="meter">মিটার</option>
                            <option value="kilometer">কিলোমিটার</option>
                            <option value="centimeter">সেন্টিমিটার</option>
                            <option value="millimeter">মিলিমিটার</option>
                            <option value="mile">মাইল</option>
                            <option value="yard">গজ</option>
                            <option value="foot">ফুট</option>
                            <option value="inch" selected>ইঞ্চি</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ওজন রূপান্তরকারী -->
            <div class="converter-section">
                <h3>ওজন রূপান্তরকারী</h3>
                 <div class="input-row">
                    <div class="input-wrapper">
                        <label for="weightFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="weightFromValue" class="unit-input" data-converter="weight" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="weightFromUnit">একক</label>
                        <select id="weightFromUnit" class="unit-select" data-converter="weight">
                            <option value="gram">গ্রাম</option>
                            <option value="kilogram" selected>কিলোগ্রাম</option>
                            <option value="milligram">মিলিগ্রাম</option>
                            <option value="tonne">টন</option>
                            <option value="pound">পাউন্ড</option>
                            <option value="ounce">আউন্স</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="weightToValue">ফলাফল (তে)</label>
                        <input type="number" id="weightToValue" class="unit-input" data-converter="weight_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="weightToUnit">একক</label>
                        <select id="weightToUnit" class="unit-select" data-converter="weight">
                            <option value="gram" selected>গ্রাম</option>
                            <option value="kilogram">কিলোগ্রাম</option>
                            <option value="milligram">মিলিগ্রাম</option>
                            <option value="tonne">টন</option>
                            <option value="pound">পাউন্ড</option>
                            <option value="ounce">আউন্স</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ক্ষেত্রফল রূপান্তরকারী -->
            <div class="converter-section">
                <h3>ক্ষেত্রফল রূপান্তরকারী</h3>
                 <div class="input-row">
                    <div class="input-wrapper">
                        <label for="areaFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="areaFromValue" class="unit-input" data-converter="area" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="areaFromUnit">একক</label>
                        <select id="areaFromUnit" class="unit-select" data-converter="area">
                            <option value="sq_meter">বর্গ মিটার</option>
                            <option value="sq_kilometer">বর্গ কিলোমিটার</option>
                            <option value="sq_foot" selected>বর্গ ফুট</option>
                            <option value="sq_inch">বর্গ ইঞ্চি</option>
                            <option value="hectare">হেক্টর</option>
                            <option value="acre">একর</option>
                            <option value="bigha">বিঘা</option>
                            <option value="katha">কাঠা</option>
                            <option value="shotok">শতক</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="areaToValue">ফলাফল (তে)</label>
                        <input type="number" id="areaToValue" class="unit-input" data-converter="area_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="areaToUnit">একক</label>
                        <select id="areaToUnit" class="unit-select" data-converter="area">
                            <option value="sq_meter">বর্গ মিটার</option>
                            <option value="sq_kilometer">বর্গ কিলোমিটার</option>
                            <option value="sq_foot">বর্গ ফুট</option>
                            <option value="sq_inch">বর্গ ইঞ্চি</option>
                            <option value="hectare">হেক্টর</option>
                            <option value="acre">একর</option>
                            <option value="bigha">বিঘা</option>
                            <option value="katha" selected>কাঠা</option>
                            <option value="shotok">শতক</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- তাপমাত্রা রূপান্তরকারী -->
            <div class="converter-section">
                <h3>তাপমাত্রা রূপান্তরকারী</h3>
                 <div class="input-row">
                    <div class="input-wrapper">
                        <label for="tempFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="tempFromValue" class="unit-input" data-converter="temperature" value="0">
                    </div>
                    <div class="input-wrapper">
                        <label for="tempFromUnit">একক</label>
                        <select id="tempFromUnit" class="unit-select" data-converter="temperature">
                            <option value="celsius" selected>সেলসিয়াস</option>
                            <option value="fahrenheit">ফারেনহাইট</option>
                            <option value="kelvin">কেলভিন</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="tempToValue">ফলাফল (তে)</label>
                        <input type="number" id="tempToValue" class="unit-input" data-converter="temperature_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="tempToUnit">একক</label>
                        <select id="tempToUnit" class="unit-select" data-converter="temperature">
                            <option value="celsius">সেলসিয়াস</option>
                            <option value="fahrenheit" selected>ফারেনহাইট</option>
                            <option value="kelvin">কেলভিন</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- পরিমাপ (ইউনিট কনভার্টার) বিভাগ শেষ -->

        <!-- নতুন: টাইপিং টেস্ট বিভাগ (আপডেট করা হয়েছে) -->
        <div id="typingTestContent" class="calculator-content">
            <div class="typing-test-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">টাইপিং টেস্ট</h3>
                <div class="typing-settings">
                    <div>
                        <label for="textSelection">অনুচ্ছেদ নির্বাচন:</label>
                        <select id="textSelection">
                            <option value="bn_1">বাংলা অনুচ্ছেদ ১</option>
                            <option value="bn_2">বাংলা অনুচ্ছেদ ২</option>
                            <option value="bn_3">বাংলা অনুচ্ছেদ ৩</option>
                            <option value="en_1">English Paragraph 1</option>
                            <option value="en_2">English Paragraph 2</option>
                            <option value="en_3">English Paragraph 3</option>
                            <option value="custom">কাস্টম টেক্সট</option>
                        </select>
                    </div>
                    <div>
                        <label for="timeSelection">সময় নির্বাচন:</label>
                        <select id="timeSelection">
                            <option value="0">আনলিমিটেড</option>
                            <option value="60">১ মিনিট</option>
                            <option value="120">২ মিনিট</option>
                            <option value="180">৩ মিনিট</option>
                            <option value="300">৫ মিনিট</option>
                        </select>
                    </div>
                </div>
                <textarea id="custom-text-input" class="hidden" placeholder="এখানে আপনার কাস্টম টেক্সট লিখুন..."></textarea>
                <div id="typingTextDisplay" class="typing-text-display">
                    পুনরায় শুরু করুন বাটনে ক্লিক করে নিচের বক্সে টাইপ করুন...
                </div>
                <textarea id="typingInput" class="typing-input" placeholder="এখানে টাইপ করুন..." disabled></textarea>
                <div id="typingStats" class="typing-stats">
                    <div class="stat-item">
                        <h4>অতিবাহিত সময়</h4>
                        <p id="elapsedTimeDisplay">০০:০০</p>
                    </div>
                    <div class="stat-item">
                        <h4>অবশিষ্ট সময়</h4>
                        <p id="remainingTimeDisplay">০০:০০</p>
                    </div>
                    <div class="stat-item">
                        <h4>WPM</h4>
                        <p id="wpmDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>মোট শব্দ</h4>
                        <p id="totalWordsDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>সঠিক</h4>
                        <p id="correctWordsDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>ভুল</h4>
                        <p id="incorrectWordsDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>নির্ভুলতা</h4>
                        <p id="accuracyDisplay">100%</p>
                    </div>
                </div>
                <div class="typing-controls">
                    <button id="restartTypingBtn" class="typing-btn restart">পুনরায় শুরু করুন</button>
                    <!-- পরিবর্তন: নতুন পজ/রিজিউম বাটন যোগ করা হয়েছে -->
                    <button id="pauseResumeTypingBtn" class="typing-btn pause">থামান</button>
                    <button id="clearTypingBtn" class="typing-btn clear">মুছুন</button>
                </div>
            </div>
        </div>



        <!-- সাম্প্রতিক সংবাদ বিভাগ -->
        <div id="newsContent" class="calculator-content">
            <div class="news-content"> <!-- সাধারণ কন্টেন্ট প্রদর্শনের জন্য news-content স্টাইলিং পুনরায় ব্যবহার করা হচ্ছে -->
                <div id="newsDisplayArea" class="news-display-area rounded-lg">
                    <h3>বাংলাদেশের প্রধান দৈনিক পত্রিকা</h3>
                    <ul id="newsHeadlinesList">
                        <li><a href="https://www.bd-pratidin.com/" target="_blank">বাংলাদেশ প্রতিদিন</a></li>
                        <li><a href="https://www.dhakapost.com/" target="_blank">ঢাকাপোস্ট</a></li>
                        <li><a href="https://www.kalerkantho.com/" target="_blank">কালের কণ্ঠ</a></li>
                        <li><a href="https://www.ittefaq.com.bd/" target="_blank">দৈনিক ইত্তেফাক</a></li>
                        <li><a href="https://www.dailyamardesh.com/" target="_blank">আমার দেশ</a></li>
                    </ul>
                    <div class="bio-link-section">
                        <p>প্রয়োজনে ভিজিট করুন</p>
                        <a href="https://bio.link/mdsifatbiolink" target="_blank" class="text-blue-600 hover:underline font-semibold text-lg">bio.link/mdsifatbiolink</a>
                    </div>
                    <div id="newsErrorMessage" class="error-message"></div>
                </div>
            </div>
        </div>

        <!-- ফন্ট কনভার্টার বিভাগ (আনডু/রিডু সহ আপডেট করা হয়েছে) -->
<!-- ফন্ট কনভার্টার বিভাগ (প্রিসেট বাটনসহ আপডেট করা হয়েছে) -->
<div id="converterContent" class="calculator-content">
    <h1 style="color:green">যেকোনো ভাঙ্গা বিজয় লেখা বিজয় টেক্সট বক্সে রেখে ফিক্স করুন বাটনে ক্লিক করলে অথবা ইউনিকোড করে আবার বিজয় করলেও ঠিক হবে।</h1>
    <div class="font-converter-content">
        <div class="font-converter-sections-wrapper">
            <!-- বাম টেক্সটএরিয়া -->
            <div class="font-converter-section">
                <div class="font-section-header">
                    <h2>ইউনিকোড</h2>
                    <div class="flex items-center gap-2">
                        <!-- Preset Dropdown Left -->
                        <div class="relative inline-block text-left">
                            <div>
                                <button type="button" id="presetButtonLeft" class="font-copy-button rounded-lg inline-flex justify-center w-full px-4 py-2 text-sm font-medium" style="background-image: linear-gradient(to right, #fbbf24 0%, #f59e0b 100%);">
                                    প্রিসেট
                                    <svg class="-mr-1 ml-2 h-5 w-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div id="dropdownMenuLeft" class="origin-top-left absolute left-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                                <div class="py-1">
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="default">ডিফল্ট (কিছুই যুক্ত হবে না)</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-space">একটি স্পেসসহ</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-space">দুটি স্পেসসহ</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="four-space">চারটি স্পেস সহ</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-enter">একটি এন্টার কী</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter">দুটি এন্টার কী</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom">কাস্টম</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom-serial">সিরিয়ালসহ কাস্টম</a>
                                </div>
                            </div>
                        </div>
                        <button id="pasteButtonLeft" class="font-copy-button rounded-lg" style="background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);">পেস্ট</button>
                        <button class="font-copy-button rounded-lg" onclick="copyToClipboard('textAreaLeft')">কপি করুন</button>
                    </div>
                </div>
                <textarea id="textAreaLeft" placeholder="এখানে ইউনিকোড টেক্সট লিখুন"></textarea>
                <div class="font-button-group">
                    <button class="font-conversion-button rounded-lg" onclick="convertLeftToRight()">ইউনিকোড থেকে বিজয়</button>
                    <button id="undoButtonLeft" class="font-undo-redo-button rounded-lg" onclick="undoText('textAreaLeft')">আনডু</button>
                    <button id="redoButtonLeft" class="font-undo-redo-button rounded-lg" onclick="redoText('textAreaLeft')">রিডু</button>
                    <button class="font-clear-button rounded-lg" onclick="clearTextarea('textAreaLeft')">মুছুন</button>
                </div>
            </div>
            <!-- ডান টেক্সটএরিয়া -->
            <div class="font-converter-section">
                <div class="font-section-header">
                    <h2>বিজয়</h2>
                    <div class="flex items-center gap-2">
                         <!-- Preset Dropdown Right -->
                        <div class="relative inline-block text-left">
                            <div>
                                <button type="button" id="presetButtonRight" class="font-copy-button rounded-lg inline-flex justify-center w-full px-4 py-2 text-sm font-medium" style="background-image: linear-gradient(to right, #fbbf24 0%, #f59e0b 100%);">
                                    প্রিসেট
                                    <svg class="-mr-1 ml-2 h-5 w-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div id="dropdownMenuRight" class="origin-top-left absolute left-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                                <div class="py-1">
                                     <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="default">ডিফল্ট (কিছুই যুক্ত হবে না)</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-space">একটি স্পেসসহ</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-space">দুটি স্পেসসহ</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="four-space">চারটি স্পেস সহ</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-enter">একটি এন্টার কী</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter">দুটি এন্টার কী</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom">কাস্টম</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom-serial">সিরিয়ালসহ কাস্টম</a>
                                </div>
                            </div>
                        </div>
                        <button id="pasteButtonRight" class="font-copy-button rounded-lg" style="background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);">পেস্ট</button>
                        <button id="fixAnsiButton" class="font-copy-button rounded-lg" style="background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);">ফিক্স করুন</button>
                        <button class="font-copy-button rounded-lg" onclick="copyToClipboard('textAreaRight')">কপি করুন</button>
                    </div>
                </div>
                <textarea id="textAreaRight" placeholder="এখানে বিজয় টেক্সট লিখুন"></textarea>
                <div class="font-button-group">
                    <button class="font-conversion-button rounded-lg" onclick="convertRightToLeft()">বিজয় থেকে ইউনিকোড</button>
                    <button id="undoButtonRight" class="font-undo-redo-button rounded-lg" onclick="undoText('textAreaRight')">আনডু</button>
                    <button id="redoButtonRight" class="font-undo-redo-button rounded-lg" onclick="redoText('textAreaRight')">রিডু</button>
                    <button class="font-clear-button rounded-lg" onclick="clearTextarea('textAreaRight')">মুছুন</button>
                </div>
            </div>
        </div>
        <!-- নতুন "সব মুছুন" বোতাম -->
        <button class="font-clear-all-button rounded-lg" onclick="clearAllTextareas()">সব মুছুন</button>
        <a href="https://bio.link/mdsifatbiolink" target="_blank" class="external-converter-link rounded-xl">প্রয়োজনে এখানে যোগাযোগ করুন অথবা মতামত জানান</a>
    </div>
</div>

<!-- কাস্টম প্রিসেট ইনপুটের জন্য মোডাল -->
<div id="customPresetModal" class="api-key-modal-overlay hidden">
    <div class="api-key-modal-content">
        <h3 id="customModalTitle">কাস্টম প্রিসেট</h3>
        <p id="customModalDesc" class="mb-4 text-gray-600 dark:text-gray-300"></p>
        <input type="text" id="customPresetInput" placeholder="এখানে আপনার কাস্টম টেক্সট লিখুন..." class="rounded-lg">
        <div class="modal-buttons mt-4">
            <button id="saveCustomPresetBtn" class="modal-button save rounded-lg">সেভ করুন</button>
            <button id="cancelCustomPresetBtn" class="modal-button cancel rounded-lg">বাতিল করুন</button>
        </div>
    </div>
</div>

        <!-- নতুন: ট্রান্সলেটর বিভাগ -->
        <div id="translatorContent" class="calculator-content">
            <div class="translator-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">যেকোনো ভাষায় অনুবাদ করুন</h3>
                <div class="translator-grid">
                    <!-- Input Text Area -->
                    <div class="translator-section">
                        <textarea id="translatorInput" rows="8" placeholder="এখানে আপনার লেখাটি পেস্ট করুন..."></textarea>
                    </div>
                    <!-- Output Text Area -->
                    <div class="translator-section">
                        <textarea id="translatorOutput" rows="8" placeholder="অনুবাদিত লেখা এখানে দেখা যাবে..." readonly></textarea>
                    </div>
                </div>
                <div class="translator-controls mt-4">
                     <div class="language-selector-wrapper">
                        <label for="targetLanguage" class="font-semibold text-gray-700 dark:text-gray-200">কোন ভাষায় অনুবাদ করবেন:</label>
                        <select id="targetLanguage" class="rounded-lg p-2 border bg-gray-100 dark:bg-gray-600 dark:text-white">
                            <!-- Languages will be populated by JS -->
                        </select>
                    </div>
                    <button id="translateBtn" class="translate-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"></path></svg>
                        <span>অনুবাদ করুন</span>
                    </button>
                </div>
                 <div class="translator-actions mt-4">
                     <button id="copyTranslatedTextBtn" class="font-copy-button rounded-lg">ফলাফল কপি করুন</button>
                     <button id="clearTranslatorTextBtn" class="font-clear-button rounded-lg">সব মুছুন</button>
                </div>
                <div id="translatorLoading" class="loading-indicator mt-4" style="display: none;">অনুবাদ করা হচ্ছে...</div>
            </div>
        </div>

        <!-- নতুন: বাংলা বানান সংশোধন বিভাগ -->
        <div id="spellCheckerContent" class="calculator-content">
            <div class="spell-checker-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা বানান সংশোধন করুন</h3>
                <textarea id="spellCheckInput" rows="8" placeholder="এখানে আপনার বাংলা লেখাটি পেস্ট করুন..."></textarea>
                <div class="flex gap-4 mt-4">
                    <button id="checkSpellingBtn" class="spell-check-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg>
                        <span>বানান পরীক্ষা করুন</span>
                    </button>
                    <!-- নতুন 'মুছুন' বাটন -->
                    <button id="clearSpellCheckBtn" class="font-clear-button rounded-lg" style="width: auto; padding: 14px 25px;">মুছুন</button>
                </div>
                <div id="spellCheckLoading" class="loading-indicator mt-4" style="display: none;">পরীক্ষা করা হচ্ছে...</div>
                <div class="result-area mt-4">
                    <p class="result-section-title">সংশোধিত লেখা</p>
                    <div id="spellCheckResult" class="text-left p-2"></div>
                </div>
            </div>
        </div>

        <!-- নতুন: লেখা সাজানো বিভাগ -->
        <div id="textBeautifierContent" class="calculator-content">
            <div class="text-beautifier-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">আপনার লেখাকে সহজ ও সুন্দর করুন</h3>
                <textarea id="beautifyInput" rows="8" placeholder="এখানে আপনার এলোমেলো বা জটিল লেখাটি পেস্ট করুন..."></textarea>
                <button id="beautifyTextBtn" class="beautify-button mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"></path></svg>
                    <span>সাজিয়ে লেখো</span>
                </button>
                <div id="beautifyLoading" class="loading-indicator mt-4" style="display: none;">আপনার লেখা গোছানো হচ্ছে...</div>
                <div class="result-area mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <p class="result-section-title" style="text-align: left; margin: 0;">সাজানো লেখা</p>
                        <button id="copyBeautifiedTextBtn" class="font-copy-button rounded-lg">কপি করুন</button>
                    </div>
                    <div id="beautifyResult" class="text-left p-2"></div>
                </div>
                <button id="clearBeautifyTextBtn" class="font-clear-button rounded-lg mt-4 w-full">সব মুছে ফেলুন</button>
            </div>
        </div>

        <!-- নতুন: শব্দের অর্থ বিভাগ -->
        <div id="wordMeaningContent" class="calculator-content">
            <div class="word-meaning-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">শব্দের অর্থ ও ব্যাখ্যা খুঁজুন</h3>
                <input type="text" id="wordMeaningInput" placeholder="এখানে বাংলা বা ইংরেজি শব্দ লিখুন..." class="mb-4">
                <div class="flex gap-4">
                    <button id="findMeaningBtn" class="find-meaning-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <span>অর্থ খুঁজুন</span>
                    </button>
                     <!-- নতুন 'মুছুন' বাটন -->
                    <button id="clearWordMeaningBtn" class="font-clear-button rounded-lg" style="width: auto; padding: 14px 25px;">মুছুন</button>
                </div>
                <div id="wordMeaningLoading" class="loading-indicator mt-4" style="display: none;">অর্থ খোঁজা হচ্ছে...</div>
                <div class="result-area mt-4">
                    <p class="result-section-title">ফলাফল</p>
                    <div id="wordMeaningResult" class="text-left p-2"></div>
                </div>
            </div>
        </div>
        
        <!-- নতুন: টেক্সট টু স্পিচ বিভাগ -->
        <div id="textToSpeechContent" class="calculator-content">
            <div class="tts-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা টেক্সট টু স্পিচ</h3>
                <textarea id="ttsInput" rows="8" placeholder="এখানে আপনার বাংলা লেখাটি পেস্ট করুন..."></textarea>
                <div class="tts-controls">
                    <div class="control-group">
                        <label for="voiceSelect">ভয়েস নির্বাচন করুন:</label>
                        <select id="voiceSelect" class="rounded-lg"></select>
                    </div>
                    <div class="control-group">
                        <label for="rate">গতি:</label>
                        <input type="range" min="0.5" max="2" value="1" step="0.1" id="rate">
                        <span id="rate-value">1</span>
                    </div>
                    <div class="control-group">
                        <label for="pitch">পিচ:</label>
                        <input type="range" min="0" max="2" value="1" step="0.1" id="pitch">
                        <span id="pitch-value">1</span>
                    </div>
                </div>
                <div class="tts-buttons">
                    <button id="speakBtn" class="tts-button speak rounded-lg">লোড করুন</button>
                    <button id="resumeBtn" class="tts-button resume rounded-lg">শুনুন</button>
					<button id="pauseBtn" class="tts-button pause rounded-lg">থামান</button>
                    <button id="stopBtn" class="tts-button stop rounded-lg">শেষ করুন</button>
                    <button id="clearTtsBtn" class="tts-button clear-input rounded-lg">মুছুন</button> <!-- Added Clear button -->
					<button id="downloadTtsBtn" class="tts-button download rounded-lg" disabled>ডাউনলোড করুন</button>
                </div>
            </div>
        </div>

        <!-- নতুন: স্পিচ টু টেক্সট বিভাগ -->
<div id="speechToTextContent" class="calculator-content">
    <div class="stt-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা স্পিচ টু টেক্সট (Gemini API)</h3>
        <div id="sttStatus" class="stt-status mb-4">অবস্থা: নিষ্ক্রিয়</div>
        <textarea id="sttOutput" rows="8" class="rounded-lg" placeholder="রেকর্ড করুন বা অডিও আপলোড করে কথাকে লেখায় রূপান্তর করুন..."></textarea>
        <!-- অডিও আপলোডের জন্য লুকানো ফাইল ইনপুট -->
        <input type="file" id="audioFileInput" class="hidden" accept="audio/*">
        <div class="stt-buttons mt-4">
            <button id="startSttBtn" data-state="record" class="stt-button start rounded-lg">রেকর্ড করুন</button>
            <button id="uploadAudioBtn" class="stt-button copy rounded-lg">আপলোড করুন</button>
            <button id="copySttBtn" class="stt-button copy rounded-lg">কপি করুন</button>
            <button id="clearSttBtn" class="stt-button clear-input rounded-lg">মুছুন</button>
        </div>
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">দ্রষ্টব্য: রেকর্ডিং শেষ হলে 'পাঠান' বাটনে ক্লিক করে লেখাটি পেতে কিছুক্ষণ অপেক্ষা করুন।</p>
    </div>
</div>
<!-- নতুন: স্পিচ টু টেক্সট বিভাগ -->
<div id="speechToTextContent" class="calculator-content">
    <div class="stt-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা স্পিচ টু টেক্সট (Gemini API)</h3>
        <div id="sttStatus" class="stt-status mb-4">অবস্থা: নিষ্ক্রিয়</div>
        <textarea id="sttOutput" rows="8" class="rounded-lg" placeholder="রেকর্ড করুন বা অডিও আপলোড করে কথাকে লেখায় রূপান্তর করুন..."></textarea>
        <!-- অডিও আপলোডের জন্য লুকানো ফাইল ইনপুট -->
        <input type="file" id="audioFileInput" class="hidden" accept="audio/*">
        <div class="stt-buttons mt-4">
            <button id="startSttBtn" data-state="record" class="stt-button start rounded-lg">রেকর্ড করুন</button>
            <button id="uploadAudioBtn" class="stt-button copy rounded-lg">আপলোড করুন</button>
            <button id="copySttBtn" class="stt-button copy rounded-lg">কপি করুন</button>
            <button id="clearSttBtn" class="stt-button clear-input rounded-lg">মুছুন</button>
        </div>
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">দ্রষ্টব্য: রেকর্ডিং শেষ হলে 'পাঠান' বাটনে ক্লিক করে লেখাটি পেতে কিছুক্ষণ অপেক্ষা করুন।</p>
    </div>
</div>


        <!-- টেক্সট অ্যাসিস্ট্যান্ট (চ্যাট) বিভাগ -->
        <div id="textAssistantContent" class="calculator-content">
            <div class="text-assistant-content">
                <div class="chat-header">
                    <h3>জেমিনির সাথে চ্যাট করুন</h3>
                    <button id="clearChatBtn" class="clear-chat-button">চ্যাট মুছুন</button>
                </div>
                <div id="chatWindow" class="chat-window">
                    <!-- চ্যাট বার্তা এখানে যুক্ত করা হবে -->
                </div>
                <div id="assistantLoading" class="loading-indicator">জেমিনি চিন্তা করছে...</div>
                <!-- ফাইল প্রিভিউ কন্টেইনার -->
                <div id="filePreviewContainer" class="hidden mb-2 p-2 border rounded-lg relative">
                    <!-- প্রিভিউ এখানে JS দ্বারা যুক্ত করা হবে -->
                </div>
                <div class="input-container">
                    <!-- নতুন ফাইল আপলোড বাটন -->
                    <label for="fileUploadInput" class="flex items-center justify-center p-2.5 rounded-lg bg-gray-200 hover:bg-gray-300 cursor-pointer dark:bg-gray-600 dark:hover:bg-gray-500 transition-colors" title="ফাইল আপলোড করুন">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                    </label>
                    <input type="file" id="fileUploadInput" class="hidden" accept="image/png, image/jpeg, image/webp, text/*, audio/*, video/*">
                    <textarea id="assistantInput" placeholder="এখানে আপনার প্রশ্ন লিখুন..."></textarea>
                    <button id="askGeminiBtn" class="ask-button">পাঠান</button>
                </div>
            </div>
        </div>

       <!-- সকল ফিচার বিভাগ -->
        <div id="allFeaturesContent" class="calculator-content">
            <div class="news-content"> <!-- সাধারণ কন্টেন্ট প্রদর্শনের জন্য news-content স্টাইলিং পুনরায় ব্যবহার করা হচ্ছে -->
                <div id="featuresDisplayArea" class="news-display-area rounded-lg">
                    <h3>এই অ্যাপের সকল ফিচার</h3>
                    <ul class="list-disc pl-5 text-left">
                        <li class="mb-2">
                            <strong class="text-indigo-700 dark:text-indigo-400">সাধারণ ও সাইন্টিফিক ক্যালকুলেটর:</strong> মৌলিক এবং জটিল গাণিতিক গণনার সুবিধা। প্রতিটি গণনার জন্য জেমিনি দ্বারা সহজ ব্যাখ্যা পাওয়ার সুযোগ রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-indigo-700 dark:text-indigo-400">বয়স ও তারিখ ক্যালকুলেটর:</strong> সঠিক বয়স গণনা, নির্দিষ্ট বছর আগে বা পরের তারিখ অনুসন্ধান এবং গ্রেগরিয়ান, বাংলা ও হিজরি তারিখ দেখার সুবিধা।
                        </li>
                        <li class="mb-2">
                            <strong class="text-green-700 dark:text-green-400">পরিমাপ (ইউনিট কনভার্টার):</strong> দৈর্ঘ্য, ওজন, ক্ষেত্রফল এবং তাপমাত্রার বিভিন্ন এককের মধ্যে রূপান্তর করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-purple-700 dark:text-purple-400">টাইপিং টেস্ট:</strong> বাংলা ও ইংরেজি অনুচ্ছেদ টাইপ করে আপনার টাইপিং স্পিড (WPM) এবং নির্ভুলতা পরীক্ষা করুন। সময়সীমা নির্ধারণ ও কাস্টম টেক্সট ব্যবহারের সুবিধাও রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-sky-700 dark:text-sky-400">ফন্ট কনভার্টার:</strong> ইউনিকোড ও বিজয় ফন্টের মধ্যে লেখা রূপান্তর করুন। এতে ভাঙা বিজয় লেখা ফিক্স করার বিশেষ সুবিধা এবং আনডু/রিডু অপশন রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-cyan-700 dark:text-cyan-400">ট্রান্সলেটর (জেমিনি):</strong> যেকোনো ভাষাকে সহজেই অন্য ভাষায় অনুবাদ করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-pink-700 dark:text-pink-400">লেখা সম্পর্কিত টুলস (জেমিনি):</strong>
                            <ul class="list-circle pl-4 mt-1 text-gray-700 dark:text-gray-400">
                                <li><strong>বানান সংশোধন:</strong> বাংলা লেখার বানান ও ব্যাকরণগত ভুল সংশোধন করুন।</li>
                                <li><strong>লেখা সাজানো:</strong> এলোমেলো বা জটিল লেখাকে সহজ ও সুন্দর ভাষায় গুছিয়ে নিন।</li>
                                <li><strong>শব্দের অর্থ:</strong> যেকোনো বাংলা বা ইংরেজি শব্দের বিস্তারিত অর্থ, প্রতিশব্দ ও ব্যাখ্যা খুঁজুন।</li>
                            </ul>
                        </li>
                        <li class="mb-2">
                            <strong class="text-amber-700 dark:text-amber-400">স্পিচ টুলস:</strong>
                            <ul class="list-circle pl-4 mt-1 text-gray-700 dark:text-gray-400">
                                <li><strong>টেক্সট টু স্পিচ:</strong> আপনার লেখা টেক্সটকে বাংলা কণ্ঠে শুনুন।</li>
                                <li><strong>স্পিচ টু টেক্সট:</strong> আপনার কথাকে রিয়েল-টাইমে বাংলা বা ইংরেজি টেক্সটে রূপান্তর করুন।</li>
                            </ul>
                        </li>
                        <li class="mb-2">
                            <strong class="text-rose-700 dark:text-rose-400">ছবি থেকে লেখা (OCR - জেমিনি):</strong> যেকোনো ছবি থেকে বাংলা ও ইংরেজি লেখা বের করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-violet-700 dark:text-violet-400">টেক্সট অ্যাসিস্ট্যান্ট (জেমিনি):</strong> যেকোনো প্রশ্ন করুন, লেখা সারসংক্ষেপ করুন, এবং ছবিসহ বিভিন্ন ফাইল আপলোড করে চ্যাট করুন।
                        </li>
                         <li class="mb-2">
                            <strong class="text-emerald-700 dark:text-emerald-400">গুগল ম্যাপ:</strong> ম্যাপে যেকোনো স্থান খুঁজুন, নিজের অবস্থান দেখুন এবং এক স্থান থেকে অন্য স্থানে যাওয়ার দিকনির্দেশনা (Directions) পান।
                        </li>
                        <li class="mb-2">
                            <strong class="text-teal-700 dark:text-teal-400">নামাজের সময়সূচি:</strong> আপনার জেলা অনুযায়ী নামাজের স্বয়ংক্রিয় সময়সূচি দেখুন এবং প্রয়োজনে ম্যানুয়ালি সময় সেট করার সুবিধাও রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-slate-700 dark:text-slate-400">সাম্প্রতিক খবর:</strong> বাংলাদেশের প্রধান দৈনিক পত্রিকাগুলোর সরাসরি লিংক এখানে পাবেন।
                        </li>
						<li class="mb-2"><strong class="text-violet-700 dark:text-violet-400">ডেভেলোপার প্রোফাইল: </strong>প্রয়োজনীয় বিভিন্ন লিংক পেতে এবং ডেভেলোপার এর প্রোফাইল 👉 <a href="https://bio.link/mdsifatbiolink" target="_blank" class="text-blue-600 hover:underline">bio.link/mdsifatbiolink</a></li>
                    </ul>
                </div>
            </div>
        </div>
		
<!-- নতুন: গুগল ম্যাপ বিভাগ -->
<div id="mapContent" class="calculator-content">
    <div class="map-container">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">গুগল ম্যাপ - বাংলাদেশ</h3>
        <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3746118.913102029!2d88.10075841566833!3d23.49058226042993!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30adaaed80e18ba7%3A0xf2d28e0c4e1fc6b!2sBangladesh!5e0!3m2!1sen!2sbd!4v1675346780000!5m2!1sen!2sbd"
            width="100%"
            height="450"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
			
        </iframe>
		<!-- এই কোডটি mapContent div-এর ভেতরের iframe ট্যাগের পরে যোগ করুন -->
		<div class="map-features mt-4 p-4 bg-white dark:bg-gray-700 rounded-lg shadow-inner">
    <!-- স্থান খুঁজুন -->
    <div class="feature-section mb-4">
        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">স্থান খুঁজুন (Search Location)</h4>
        <div class="flex flex-col sm:flex-row gap-2">
            <input type="text" id="searchInput" placeholder="যেমন: ঢাকা বিশ্ববিদ্যালয়" class="flex-grow p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500">
            <button id="searchBtn" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors">খুঁজুন</button>
        </div>
    </div>

    <!-- আমার অবস্থান -->
    <div class="feature-section mb-4">
        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">আমার অবস্থান (My Location)</h4>
        <button id="myLocationBtn" class="w-full px-4 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors">আমার বর্তমান অবস্থান দেখুন</button>
    </div>

					<!-- দিকনির্দেশনা -->
			<div class="feature-section">
				<h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">দিকনির্দেশনা (Directions)</h4>
				<div class="flex flex-col sm:flex-row gap-2">
				<input type="text" id="directionsFrom" placeholder="শুরুর স্থান (From)" class="flex-grow p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-purple-500">
				<input type="text" id="directionsTo" placeholder="গন্তব্য স্থান (To)" class="flex-grow p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-purple-500">
				</div>
				<button id="directionsBtn" class="w-full mt-2 px-4 py-2 bg-purple-500 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors">দিকনির্দেশনা দেখুন</button>
			</div>
		</div>
	</div>
</div>
<!-- নতুন: নামাজের সময়সূচি বিভাগ -->
<div id="prayerTimeContent" class="calculator-content">
    <div class="prayer-time-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">নামাজের সময়সূচি</h3>
        <p id="prayerTimeDate" class="text-md font-semibold text-gray-600 dark:text-gray-300 mb-4"></p>
        
        <div class="district-selector-wrapper mb-6">
            <label for="district-select" class="block text-left mb-2 font-semibold text-gray-700 dark:text-gray-200">আপনার জেলা নির্বাচন করুন:</label>
            <select id="district-select" class="w-full p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500 transition-all"></select>
        </div>


<!-- prayerTimeContent div এর মধ্যে, district-selector-wrapper এর নিচে যোগ করুন -->
<div class="manual-time-control-wrapper mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-inner">
    <div class="flex items-center justify-between mb-4">
        <label for="manualTimeToggle" class="font-semibold text-gray-700 dark:text-gray-200">ম্যানুয়াল সময় সেট করুন:</label>
        <label class="switch">
            <input type="checkbox" id="manualTimeToggle">
            <span class="slider round"></span>
        </label>
    </div>
    <div id="manualTimeInputs" class="hidden grid grid-cols-2 sm:grid-cols-3 gap-4">
        <div>
            <label for="manualSehri" class="block text-sm font-medium text-gray-600 dark:text-gray-300">সাহরি:</label>
            <input type="time" id="manualSehri" value="04:00" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualFajr" class="block text-sm font-medium text-gray-600 dark:text-gray-300">ফজর:</label>
            <input type="time" id="manualFajr" value="04:10" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualDhuhr" class="block text-sm font-medium text-gray-600 dark:text-gray-300">যোহর:</label>
            <input type="time" id="manualDhuhr" value="12:00" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualAsr" class="block text-sm font-medium text-gray-600 dark:text-gray-300">আসর:</label>
            <input type="time" id="manualAsr" value="16:30" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualIftar" class="block text-sm font-medium text-gray-600 dark:text-gray-300">ইফতার ও মাগরিব:</label>
            <input type="time" id="manualIftar" value="18:45" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualIsha" class="block text-sm font-medium text-gray-600 dark:text-gray-300">ইশা:</label>
            <input type="time" id="manualIsha" value="20:00" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
    </div>
</div>


        <div id="prayer-times-display" class="prayer-times-grid">
            <div class="prayer-time-card">
                <h4>সাহরি</h4>
                <p id="sehri-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>ফজর</h4>
                <p id="fajr-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>যোহর</h4>
                <p id="dhuhr-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>আসর</h4>
                <p id="asr-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>ইফতার ও মাগরিব</h4>
                <p id="iftar-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>ইশা</h4>
                <p id="isha-time">--:--</p>
            </div>
        </div>
        <!-- আপডেট করা দ্রষ্টব্য -->
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">দ্রষ্টব্য: সময়সূচি aladhan.com API থেকে আনা হয়েছে (হিসাব পদ্ধতি: University of Islamic Sciences, Karachi)। এটি ইসলামিক ফাউন্ডেশনের সময়ের সাথে কিছুটা ভিন্ন হতে পারে।</p>
    </div>
</div>

<!-- নতুন: ছবি থেকে লেখা (OCR) বিভাগ -->
<div id="imageToTextContent" class="calculator-content">
    <div class="image-to-text-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">ছবি থেকে লেখা বের করুন (OCR)</h3>
        <div class="image-upload-area">
            <label for="ocrImageInput" class="image-upload-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 mb-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <span>একটি ছবি নির্বাচন করুন</span>
            </label>
            <input type="file" id="ocrImageInput" accept="image/png, image/jpeg, image/webp" class="hidden">
        </div>
        <div id="ocrImagePreview" class="image-preview hidden"></div>
        <div class="flex gap-4 mt-4">
            <button id="extractTextBtn" class="extract-text-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg>
                <span>লেখা বের করুন</span>
            </button>
        </div>
        <div id="ocrLoading" class="loading-indicator mt-4" style="display: none;">ছবি থেকে লেখা বের করা হচ্ছে...</div>
        <div class="result-area mt-4">
            <div class="flex justify-between items-center mb-2">
                <p class="result-section-title" style="text-align: left; margin: 0;">বের করা লেখা</p>
                <button id="copyOcrTextBtn" class="font-copy-button rounded-lg">কপি করুন</button>
            </div>
            <textarea id="ocrResultText" rows="10" placeholder="এখানে লেখা দেখা যাবে..."></textarea>
        </div>
        <button id="clearOcrBtn" class="font-clear-button rounded-lg mt-4 w-full">সব মুছে ফেলুন</button>
    </div>
</div>
<!-- নতুন: ওয়ার্ড কাউন্টার বিভাগ -->
<div id="wordCounterContent" class="calculator-content">
    <div class="word-counter-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">ওয়ার্ড ও ক্যারেক্টার কাউন্টার</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">নিচের টেক্সটবক্সে আপনার লেখা পেস্ট করুন অথবা টাইপ করুন। ফলাফল রিয়েল-টাইমে আপডেট হবে।</p>
        <textarea id="wordCounterInput" rows="10" class="w-full p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500 transition-all" placeholder="এখানে আপনার লেখা পেস্ট করুন অথবা টাইপ করুন..."></textarea>
        <div id="wordCounterStats" class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
            <div class="p-4 bg-blue-100 dark:bg-blue-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-blue-800 dark:text-blue-200">শব্দ</h4>
                <p id="wordCount" class="text-2xl font-bold text-blue-600 dark:text-blue-300">0</p>
            </div>
            <div class="p-4 bg-green-100 dark:bg-green-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-green-800 dark:text-green-200">অক্ষর</h4>
                <p id="charCount" class="text-2xl font-bold text-green-600 dark:text-green-300">0</p>
            </div>
            <div class="p-4 bg-purple-100 dark:bg-purple-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-purple-800 dark:text-purple-200">বাক্য</h4>
                <p id="sentenceCount" class="text-2xl font-bold text-purple-600 dark:text-purple-300">0</p>
            </div>
            <div class="p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200">অনুচ্ছেদ</h4>
                <p id="paragraphCount" class="text-2xl font-bold text-yellow-600 dark:text-yellow-300">0</p>
            </div>
        </div>
    </div>
</div>

<!-- নতুন: আবহাওয়া বিভাগ -->
<div id="weatherContent" class="calculator-content">
    <div class="weather-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">আবহাওয়ার পূর্বাভাস</h3>
        <div class="weather-search-box">
            <input type="text" id="cityInput" placeholder="আপনার শহরের নাম লিখুন..." class="city-input">
            <button id="searchWeatherBtn" class="search-weather-button">খুঁজুন</button>
        </div>
        <div id="weatherResult" class="weather-result-area">
            <!-- আবহাওয়ার তথ্য এখানে দেখানো হবে -->
            <p>একটি শহরের নাম লিখে 'খুঁজুন' বাটনে ক্লিক করুন।</p>
        </div>
        <div id="weatherLoading" class="loading-indicator mt-4" style="display: none;">আবহাওয়ার তথ্য আনা হচ্ছে...</div>
    </div>
<!-- আবহাওয়া সেকশন শুরু -->
<section id="weather-section" class="bg-gray-800 p-8 rounded-xl shadow-lg mt-8 hidden">
    <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-white mb-2">আবহাওয়ার পূর্বাভাস</h2>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-2 mb-4">
            <input type="text" id="location-search-input" placeholder="শহর বা জেলার নাম লিখুন..." class="p-2 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-80">
            <button id="search-weather-button" class="bg-blue-600 text-white p-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors w-full sm:w-auto">
                অনুসন্ধান করুন
            </button>
        </div>
        <p class="text-gray-400 text-lg" id="location-name"></p>
    </div>
    <div id="forecast-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8 gap-4">
        <!-- এখানে প্রতিটি দিনের আবহাওয়ার কার্ডগুলো JavaScript দ্বারা যুক্ত হবে -->
    </div>
</section>
<!-- আবহাওয়া সেকশন শেষ -->
</div>

<!-- নতুন: নোটপ্যাড / টু-ডু লিস্ট বিভাগ -->
<div id="notepadContent" class="calculator-content">
    <div class="notepad-container">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">নোটপ্যাড / টু-ডু লিস্ট</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">আপনার কাজ বা নোট যোগ করুন। ব্রাউজার বন্ধ করলেও আপনার ডেটা সেভ থাকবে। কাজ শেষ হলে লেখার ওপর ক্লিক করুন।</p>
        <div class="notepad-input-area">
            <input type="text" id="taskInput" placeholder="এখানে নতুন কাজ বা নোট লিখুন..." class="task-input">
            <button id="addTaskBtn" class="add-task-btn">যোগ করুন</button>
        </div>
        <ul id="taskList" class="task-list">
            <!-- কাজগুলো এখানে জাভাস্ক্রিপ্ট দ্বারা যুক্ত হবে -->
        </ul>
    </div>
</div>

<!-- এখান থেকে ওপরে নতুন ট্যাবের সি এস এস কোড লিখতে হবে -->
</div>

    <!-- API কী মডেল -->
    <div id="apiKeyModal" class="api-key-modal-overlay hidden">
        <div class="api-key-modal-content">
            <h3>জেমিনি API কী সেট করুন</h3>
            <input type="text" id="apiKeyInput" placeholder="আপনার API কী এখানে লিখুন..." class="rounded-lg">
            <div class="modal-buttons">
                <button id="saveApiKeyBtn" class="modal-button save rounded-lg">সেভ করুন</button>
                <button id="cancelApiKeyBtn" class="modal-button cancel rounded-lg">বাতিল করুন</button>
            </div>
            <div id="apiKeyMessage" class="message-area"></div>
        </div>
    </div>
	
<!--css style End-->

<!--Script started from here-->

    <script>
	
	// Paste Preset Functionality Variables
	let pastePresetLeft = 'default';
	let customPasteValueLeft = '';
	let customSerialCounterLeft = 1;
	let pastePresetRight = 'default';
	let customPasteValueRight = '';
	let customSerialCounterRight = 1;
	let currentModalSide = null; // কোন পাশের ('left' বা 'right') মোডাল খোলা হয়েছে তা ট্র্যাক করে
	let currentModalPreset = null; // কোন প্রিসেট ('custom' বা 'custom-serial') এর জন্য ইনপুট প্রয়োজন তা ট্র্যাক করে
	
document.addEventListener('DOMContentLoaded', () => {
    // Typing Test Tab এর জন্য প্রয়োজনীয় সকল DOM উপাদান নির্বাচন করা
    const typingTestTab = document.getElementById('typingTestTab');
    const typingTestContent = document.getElementById('typingTestContent');
    
	const notepadTab = document.getElementById('notepadTab');
	const notepadContent = document.getElementById('notepadContent');
	const imageToTextTab = document.getElementById('imageToTextTab');
	const imageToTextContent = document.getElementById('imageToTextContent');
	const wordCounterTab = document.getElementById('wordCounterTab');
	const wordCounterContent = document.getElementById('wordCounterContent');
    // নতুন যুক্ত করা উপাদান
    const textSelection = document.getElementById('textSelection');
    const timeSelection = document.getElementById('timeSelection');
    const customTextInputContainer = document.getElementById('custom-text-input');
    const clearTypingBtn = document.getElementById('clearTypingBtn');
    const totalWordsDisplay = document.getElementById('totalWordsDisplay');
	const weatherTab = document.getElementById('weatherTab');
	const weatherContent = document.getElementById('weatherContent');
    // আগের উপাদান
    const typingTextDisplay = document.getElementById('typingTextDisplay');
    const typingInput = document.getElementById('typingInput');
    const elapsedTimeDisplay = document.getElementById('elapsedTimeDisplay');
    const remainingTimeDisplay = document.getElementById('remainingTimeDisplay');
    const wpmDisplay = document.getElementById('wpmDisplay');
    const correctWordsDisplay = document.getElementById('correctWordsDisplay');
    const incorrectWordsDisplay = document.getElementById('incorrectWordsDisplay');
    const accuracyDisplay = document.getElementById('accuracyDisplay');
    const restartTypingBtn = document.getElementById('restartTypingBtn');
    const pauseResumeTypingBtn = document.getElementById('pauseResumeTypingBtn'); // পজ/রিজিউম বাটন

    // বাংলা এবং ইংরেজি অনুচ্ছেদের নমুনা
    const paragraphs = {
        bn_1: "বাংলা আমার মাতৃভাষা এবং আমি এই ভাষাকে অনেক ভালোবাসি। এই ভাষার জন্য আমাদের পূর্বপুরুষেরা রক্ত দিয়েছেন। একুশে ফেব্রুয়ারি আমাদের জন্য একটি গর্বের দিন।",
        bn_2: "বাংলাদেশ একটি সুন্দর দেশ। এখানে ছয়টি ঋতু পর্যায়ক্রমে আসে। প্রতিটি ঋতুরই নিজস্ব সৌন্দর্য ও বৈশিষ্ট্য রয়েছে। বর্ষাকালে প্রচুর বৃষ্টিপাত হয় এবং নদনদী পানিতে ভরে যায়।",
        bn_3: "তথ্যপ্রযুক্তি আমাদের জীবনকে অনেক সহজ করে দিয়েছে। ইন্টারনেট ব্যবহার করে আমরা বিশ্বের যেকোনো প্রান্তের মানুষের সাথে যোগাযোগ করতে পারি। শিক্ষা, স্বাস্থ্য, এবং বিনোদনের ক্ষেত্রেও এর ব্যাপক প্রভাব রয়েছে।",
        en_1: "The quick brown fox jumps over the lazy dog. This sentence contains all the letters of the English alphabet. It is often used for practicing typing.",
        en_2: "Technology has revolutionized the way we live and work. The internet connects billions of people worldwide, providing access to information and endless opportunities.",
        en_3: "To be successful in life, one needs dedication, hard work, and perseverance. Challenges are a part of the journey, but they make us stronger and more resilient."
    };

    let timer;
    let timeElapsed = 0;
    let totalTestTime = 0;
    let isTestActive = false;
    let isPaused = false; // টেস্ট পজ করা হয়েছে কিনা তা ট্র্যাক করতে
    let correctChars = 0;
    let incorrectChars = 0;
    
    // টেস্ট শুরু বা রিসেট করার ফাংশন
    function initializeTest() {
        clearInterval(timer);
        isTestActive = false;
        isPaused = false; // পজ স্টেট রিসেট
        timeElapsed = 0;

        totalTestTime = parseInt(timeSelection.value, 10);

        typingInput.value = '';
        typingInput.disabled = false;
        correctChars = 0;
        incorrectChars = 0;

        const selection = textSelection.value;
        let selectedParagraph = '';

        if (selection === 'custom') {
            selectedParagraph = customTextInputContainer.value.trim();
            if (!selectedParagraph) {
                showCustomAlert('অনুগ্রহ করে কাস্টম টেক্সট ইনপুট করুন। ডিফল্ট অনুচ্ছেদ লোড করা হচ্ছে।');
                selectedParagraph = paragraphs['bn_1'];
            }
        } else {
            selectedParagraph = paragraphs[selection];
        }

        typingTextDisplay.innerHTML = selectedParagraph.split('').map(char => `<span>${char}</span>`).join('');
        const spans = typingTextDisplay.querySelectorAll('span');
        if (spans.length > 0) {
            spans[0].classList.add('current');
        }

        updateTimeDisplays();
        wpmDisplay.innerText = '0';
        correctWordsDisplay.innerText = '0';
        incorrectWordsDisplay.innerText = '0';
        accuracyDisplay.innerText = '100%';
        totalWordsDisplay.innerText = '0';

        // পজ/রিজিউম বাটন রিসেট করা
        if (pauseResumeTypingBtn) {
            pauseResumeTypingBtn.innerText = 'থামান';
            pauseResumeTypingBtn.disabled = true; // টেস্ট শুরু না হওয়া পর্যন্ত নিষ্ক্রিয়
        }
    }

    // টাইমার প্রদর্শন আপডেট করার ফাংশন
    function updateTimeDisplays() {
        const elapsedMinutes = Math.floor(timeElapsed / 60);
        const elapsedSeconds = timeElapsed % 60;
        elapsedTimeDisplay.innerText = `${elapsedMinutes.toString().padStart(2, '0')}:${elapsedSeconds.toString().padStart(2, '0')}`;

        if (totalTestTime > 0) {
            const remainingTime = totalTestTime - timeElapsed;
            if (remainingTime <= 0) {
                remainingTimeDisplay.innerText = '০০:০০';
                if (isTestActive) endTest();
                return;
            }
            const remainingMinutes = Math.floor(remainingTime / 60);
            const remainingSeconds = remainingTime % 60;
            remainingTimeDisplay.innerText = `${remainingMinutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        } else {
            remainingTimeDisplay.innerText = 'আনলিমিটেড';
        }
    }

    // *** সংশোধিত ফাংশন: handleTypingInput ***
    // এই ফাংশনটি প্রতিটি ইনপুটের পরে পুরো লেখাটি পুনরায় যাচাই করে,
    // যা ভুল সংশোধন এবং অক্ষর বাদ পড়ার সমস্যা সমাধান করে।
    function handleTypingInput() {
        if (isPaused) return;

        // প্রথম অক্ষর টাইপ করার সাথে সাথে টাইমার শুরু করুন
        if (!isTestActive && typingInput.value.length > 0) {
            startTimer();
            isTestActive = true;
            if (pauseResumeTypingBtn) pauseResumeTypingBtn.disabled = false;
        }

        const spans = Array.from(typingTextDisplay.querySelectorAll('span'));
        const typedValue = typingInput.value;
        const typedLength = typedValue.length;

        let localCorrectChars = 0;
        let localIncorrectChars = 0;

        // টাইপ করা সমস্ত অক্ষর পুনরায় মূল্যায়ন করুন
        spans.forEach((charSpan, index) => {
            // পূর্ববর্তী অবস্থা পরিষ্কার করুন
            charSpan.classList.remove('correct', 'incorrect', 'current');

            if (index < typedLength) {
                const originalChar = charSpan.innerText;
                const typedChar = typedValue[index];
                
                // *** সমাধান: তুলনার আগে অক্ষর নরম্যালাইজ করা ***
                // এটি ইউনিকোডের গঠনগত ভিন্নতার (precomposed vs. decomposed) সমস্যা সমাধান করে।
                // যেমন: 'ড়' এবং 'ড' + '়' এখন একই হিসাবে বিবেচিত হবে।
                if (originalChar.normalize('NFC') === typedChar.normalize('NFC')) {
                    charSpan.classList.add('correct');
                    localCorrectChars++;
                } else {
                    charSpan.classList.add('incorrect');
                    localIncorrectChars++;
                }
            }
        });

        // পরিসংখ্যান গণনার জন্য গ্লোবাল অক্ষরের সংখ্যা আপডেট করুন
        correctChars = localCorrectChars;
        incorrectChars = localIncorrectChars;

        // কার্সার (বর্তমান অক্ষর) সেট করুন
        if (typedLength < spans.length) {
            spans[typedLength].classList.add('current');
        } 
        
        // টেস্ট শেষ হয়েছে কিনা তা পরীক্ষা করুন
        if (typedLength >= spans.length) {
            endTest();
        }
        
        updateStats(); // প্রতিটি ইনপুটের পরে পরিসংখ্যান আপডেট করুন
    }

    // টাইমার শুরু করার ফাংশন
    function startTimer() {
        timer = setInterval(() => {
            timeElapsed++;
            updateTimeDisplays();
            updateStats();
            
            if (totalTestTime > 0 && timeElapsed >= totalTestTime) {
                endTest();
            }
        }, 1000);
    }

    // পজ এবং রিজিউম ফাংশন
    function togglePauseResume() {
        if (!isTestActive) return; // টেস্ট শুরু না হলে পজ করা যাবে না

        isPaused = !isPaused;

        if (isPaused) {
            clearInterval(timer);
            typingInput.disabled = true;
            pauseResumeTypingBtn.innerText = 'চালু করুন';
            showCustomAlert('টেস্ট থামানো হয়েছে।');
        } else {
            startTimer(); // টাইমার পুনরায় শুরু করুন
            typingInput.disabled = false;
            typingInput.focus(); // ইনপুটে ফোকাস ফিরিয়ে আনুন
            pauseResumeTypingBtn.innerText = 'থামান';
            showCustomAlert('টেস্ট পুনরায় শুরু হয়েছে।');
        }
    }
    
    // *** সংশোধিত ফাংশন: updateStats ***
    // এই ফাংশনটি পরিসংখ্যান গণনার জন্য সঠিক পদ্ধতি ব্যবহার করে।
    function updateStats() {
        const totalTypedChars = correctChars + incorrectChars;

        // Accuracy Calculation
        const accuracy = (totalTypedChars > 0) ? (correctChars / totalTypedChars) * 100 : 100;
        accuracyDisplay.innerText = `${Math.round(accuracy)}%`;

        // WPM Calculation
        const timeElapsedInMinutes = timeElapsed / 60;
        if (timeElapsedInMinutes > 0) {
            // WPM সঠিকভাবে টাইপ করা অক্ষরের উপর ভিত্তি করে গণনা করা হয়
            const netWPM = (correctChars / 5) / timeElapsedInMinutes;
            wpmDisplay.innerText = Math.round(netWPM > 0 ? netWPM : 0);
        } else {
            wpmDisplay.innerText = '0';
        }
        
        // Word Count Calculation
        const allOriginalWords = typingTextDisplay.innerText.split(/\s+/).filter(Boolean);
        const typedWordsArray = typingInput.value.trim().split(/\s+/).filter(Boolean);
        
        let correctWordsCount = 0;
        // ব্যবহারকারী যতগুলো শব্দ টাইপ করেছে, ততগুলো শব্দের তুলনা করুন
        typedWordsArray.forEach((typedWord, index) => {
            // *** সমাধান: তুলনার আগে শব্দ নরম্যালাইজ করা ***
            if (index < allOriginalWords.length && typedWord.normalize('NFC') === allOriginalWords[index].normalize('NFC')) {
                correctWordsCount++;
            }
        });

        // যদি ইনপুট খালি থাকে, তাহলে ভুল শব্দ ০ দেখান
        const incorrectWordsCount = typedWordsArray.length > 0 ? typedWordsArray.length - correctWordsCount : 0;

        totalWordsDisplay.innerText = typedWordsArray.length;
        correctWordsDisplay.innerText = correctWordsCount;
        incorrectWordsDisplay.innerText = incorrectWordsCount;
    }


    // টেস্ট শেষ করার ফাংশন
    function endTest() {
        clearInterval(timer);
        isTestActive = false;
        typingInput.disabled = true;
        if (pauseResumeTypingBtn) pauseResumeTypingBtn.disabled = true; // টেস্ট শেষে বাটন নিষ্ক্রিয় করুন
        showCustomAlert('টাইপিং টেস্ট শেষ হয়েছে!');
        updateStats(); // চূড়ান্ত পরিসংখ্যান আপডেট করুন
    }

    // ইভেন্ট লিসেনার যোগ করা
    if (typingTestTab) {
        typingTestTab.addEventListener('click', () => {
             showTab('typingTest');
             initializeTest();
        });
    }
    
    if (restartTypingBtn) {
        restartTypingBtn.addEventListener('click', initializeTest);
    }
    
    if (pauseResumeTypingBtn) {
        pauseResumeTypingBtn.addEventListener('click', togglePauseResume);
    }

    if (clearTypingBtn) {
        clearTypingBtn.addEventListener('click', () => {
            initializeTest();
            typingInput.value = '';
            typingInput.disabled = true;
            showCustomAlert('টেস্ট রিসেট করা হয়েছে।');
        });
    }
    
    if (typingInput) {
        typingInput.addEventListener('input', handleTypingInput);
    }
    
    if (textSelection) {
        textSelection.addEventListener('change', (e) => {
            if (e.target.value === 'custom') {
                customTextInputContainer.classList.remove('hidden');
            } else {
                customTextInputContainer.classList.add('hidden');
            }
            initializeTest();
        });
    }

    if (timeSelection) {
        timeSelection.addEventListener('change', initializeTest);
    }
    
    // যদি টাইপিং টেস্ট ট্যাবটি ডিফল্টভাবে সক্রিয় থাকে, তবে টেস্ট শুরু করুন
    if (typingTestContent && typingTestContent.classList.contains('active')) {
        initializeTest();
    }
 });
	
	
        // ====================================================================
        // START: DATE AND TIME BANNER SCRIPT (নতুন যুক্ত করা হয়েছে)
        // ====================================================================

        // গ্রেগরিয়ান তারিখকে বাংলা তারিখে রূপান্তর করার ফাংশন (বাংলাদেশ স্ট্যান্ডার্ড)
        function getBengaliDate(gregorianDate) {
            const year = gregorianDate.getFullYear();
            const month = gregorianDate.getMonth(); // 0-11
            const day = gregorianDate.getDate();

            let bengaliYear;
            const bengaliMonthNames = [
                "বৈশাখ", "জ্যৈষ্ঠ", "আষাঢ়", "শ্রাবণ", "ভাদ্র", "আশ্বিন",
                "কার্তিক", "অগ্রহায়ণ", "পৌষ", "মাঘ", "ফাল্গুন", "চৈত্র"
            ];

            // বাংলা বছর গণনা করুন (বাংলাদেশ স্ট্যান্ডার্ড: পহেলা বৈশাখ 14 এপ্রিল)
            if (month < 3 || (month === 3 && day < 14)) { // 14 এপ্রিলের আগে
                bengaliYear = year - 594;
            } else { // 14 এপ্রিল বা তার পরে
                bengaliYear = year - 593;
            }

            // বাংলা মাসের দিন সংখ্যা (বাংলাদেশ স্ট্যান্ডার্ড)
            // বৈশাখ থেকে ভাদ্র (5 মাস): 31 দিন
            // আশ্বিন থেকে চৈত্র (7 মাস): সাধারণত 30 দিন, অধিবর্ষে ফাল্গুন 31 দিন
            const bengaliMonthLengths = [31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 30, 30];

            // বাংলা বছরের সাথে সম্পর্কিত গ্রেগরিয়ান বছরটি অধিবর্ষ কিনা তা নির্ধারণ করুন
            // এটি ফাল্গুনকে প্রভাবিত করে (11তম মাস, সূচক 10)
            const gregorianYearForBengaliLeapCheck = bengaliYear + 593;
            const isGregorianLeapYear = (gregorianYearForBengaliLeapCheck % 4 === 0 && gregorianYearForBengaliLeapCheck % 100 !== 0) || gregorianYearForBengaliLeapCheck % 400 === 0;

            if (isGregorianLeapYear) {
                bengaliMonthLengths[10] = 31; // অধিবর্ষে ফাল্গুন 31 দিন
            }

            // বর্তমান বাংলা বছরের শুরু থেকে অতিবাহিত দিন গণনা করুন (14 এপ্রিল)
            const startOfCurrentBengaliYearGregorian = new Date(year, 3, 14); // বর্তমান গ্রেগরিয়ান বছরের 14 এপ্রিল
            if (gregorianDate < startOfCurrentBengaliYearGregorian) {
                // যদি বর্তমান তারিখ 14 এপ্রিলের আগে হয়, তবে পূর্ববর্তী গ্রেগরিয়ান বছরের 14 এপ্রিলকে রেফারেন্স হিসাবে সামঞ্জস্য করুন
                startOfCurrentBengaliYearGregorian.setFullYear(year - 1);
            }

            const diffTime = gregorianDate.getTime() - startOfCurrentBengaliYearGregorian.getTime();
            let daysPassedSinceBengaliYearStart = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            let currentBengaliMonthIndex = 0;
            let currentBengaliDay = 0;

            // সঠিক মাস এবং দিন খুঁজে বের করতে বাংলা মাসগুলির মধ্যে পুনরাবৃত্তি করুন
            for (let i = 0; i < bengaliMonthNames.length; i++) {
                if (daysPassedSinceBengaliYearStart < bengaliMonthLengths[i]) {
                    currentBengaliMonthIndex = i;
                    currentBengaliDay = daysPassedSinceBengaliYearStart + 1; // দিন 1-ইনডেক্সড
                    break;
                }
                daysPassedSinceBengaliYearStart -= bengaliMonthLengths[i];
            }

            // সংখ্যাগুলিকে বাংলা সংখ্যায় রূপান্তর করুন
            const toBengaliNumber = (num) => {
                const numbers = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
                return num.toString().split('').map(digit => numbers[parseInt(digit)]).join('');
            };

            // বাংলা মাসের মোট দিন
            const totalDaysInBengaliMonth = bengaliMonthLengths[currentBengaliMonthIndex];

            return {
                day: currentBengaliDay,
                month: bengaliMonthNames[currentBengaliMonthIndex],
                year: bengaliYear,
                totalDays: totalDaysInBengaliMonth,
                formatted: `${toBengaliNumber(currentBengaliDay)} ${bengaliMonthNames[currentBengaliMonthIndex]} ${toBengaliNumber(bengaliYear)} বঙ্গাব্দ`
            };
        }

        // আরবি সংখ্যাকে বাংলা সংখ্যায় রূপান্তর করার ফাংশন
        const arabicToBengaliNumbers = (text) => {
            const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
            let converted = text;
            for (let i = 0; i < arabicDigits.length; i++) {
                converted = converted.replace(new RegExp(arabicDigits[i], 'g'), bengaliDigits[i]);
            }
            return converted;
        };

        // আরবি হিজরি মাসের নামগুলিকে বাংলা নামে ম্যাপ করুন
        const hijriMonthArabicToBengali = {
            'محرم': 'মুহাররম',
            'صفر': 'সফর',
            'ربيع الأول': 'রবিউল আউয়াল',
            'ربيع الآخر': 'রবিউস সানি',
            'جمادى الأولى': 'জমাদিউল আউয়াল',
            'جمادى الآخرة': 'জমাদিউস সানি',
            'رجب': 'রজব',
            'شعبان': 'শাবান',
            'رمضان': 'রমজান',
            'شوال': 'শাওয়াল',
            'ذو القعدة': 'জিলকদ',
            'ذو الحجة': 'জিলহজ'
        };

        function updateDateTimeBanner() {
            const bannerElement = document.getElementById('currentDateTimeBanner');
            if (!bannerElement) return;

            const now = new Date();

            // Gregorian Date
            const gregorianDay = now.getDate();
            const gregorianMonth = now.toLocaleDateString('bn-BD', { month: 'long' });
            const gregorianYear = now.getFullYear();
            const gregorianDateString = `${gregorianDay} ${gregorianMonth} ${gregorianYear}`;
            const dayOfWeekBengali = now.toLocaleDateString('bn-BD', { weekday: 'long' }); // সপ্তাহের দিন বাংলাতে

            // Bengali Date (using existing getBengaliDate function)
            const bengaliDateInfo = getBengaliDate(now);
            const bengaliDateString = bengaliDateInfo.formatted;

            // Hijri Date (using existing logic)
            let hijriCalculationDate = new Date(now);
            hijriCalculationDate.setDate(hijriCalculationDate.getDate() - 2); // Adjust as in displayDates for local convention এখানে 1 দিন
																			//বা দুই দিন কমবেশি করে সেট করতে হবে প্রতিমাসে আরবি তারিখের ক্ষেত্রে।
            const hijriDateFormatter = new Intl.DateTimeFormat('ar-SA', {
                calendar: 'islamic',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                timeZone: 'Asia/Dhaka'
            });
            const hijriParts = hijriDateFormatter.formatToParts(hijriCalculationDate);

            let hijriDay = '';
            let hijriMonthArabic = '';
            let hijriYear = '';
            for (const part of hijriParts) {
                if (part.type === 'day') {
                    hijriDay = arabicToBengaliNumbers(part.value);
                } else if (part.type === 'month') {
                    hijriMonthArabic = part.value;
                } else if (part.type === 'year') {
                    hijriYear = arabicToBengaliNumbers(part.value);
                }
            }
            const hijriMonthBengali = hijriMonthArabicToBengali[hijriMonthArabic] || hijriMonthArabic;
            const hijriDateString = `${hijriDay} ${hijriMonthBengali} ${hijriYear} হিজরি`;

            // Time
            const timeString = now.toLocaleTimeString('bn-BD', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
                timeZone: 'Asia/Dhaka'
            });

            // ব্যানার আপডেট করুন
            bannerElement.innerHTML = `<span class="text-green-700 dark:text-green-300">আজ</span> <span class="text-green-700 dark:text-green-300">${dayOfWeekBengali}</span>, <span class="text-blue-700 dark:text-blue-300">${gregorianDateString} ইং</span>, <span class="text-green-700 dark:text-green-300">${bengaliDateString.replace('বঙ্গাব্দ', '')} বঙ্গাব্দ</span>, <span class="text-purple-700 dark:text-purple-300">${hijriDateString}</span>, <span class="text-green-700 dark:text-green-300">এখন সময়</span><span class="text-green-700 dark:text-green-300">${timeString}</span>`;
        }

        // প্রতি সেকেন্ডে ব্যানার আপডেট করুন
        setInterval(updateDateTimeBanner, 1000);

        // ====================================================================
        // END: DATE AND TIME BANNER SCRIPT
        // ====================================================================


        // ====================================================================
        // START: DARK MODE / LIGHT MODE TOGGLE SCRIPT
        // ====================================================================
        const themeToggleBtn = document.getElementById('theme-toggle');

        // পৃষ্ঠা লোড হওয়ার সাথে সাথে থিম পরীক্ষা করুন
        if (localStorage.getItem('color-theme') === 'dark' || 
           (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        themeToggleBtn.addEventListener('click', function() {
            // 'dark' ক্লাস টগল করুন
            document.documentElement.classList.toggle('dark');

            // লোকাল স্টোরেজে পছন্দ সেভ করুন
            if (document.documentElement.classList.contains('dark')) {
                localStorage.setItem('color-theme', 'dark');
            } else {
                localStorage.setItem('color-theme', 'light');
            }
        });
        // ====================================================================
        // END: DARK MODE / LIGHT MODE TOGGLE SCRIPT
        // ====================================================================


        // ইউনিকোড থেকে বিজয় রূপান্তরের জন্য ম্যাপিং
        const unicodeToBijoyMap = {
            // স্বরবর্ণ সেকশন
            "অ": "A",        "আ": "Av",       "ই": "B",        "ঈ": "C",        "উ": "D",        "ঊ": "E",        "ঋ": "F",        "এ": "G",        "ঐ": "H",        "ও": "I",
            "ঔ": "J",

            // ব্যাঞ্জনবর্ণ সেকশন
            "ক": "K",        "খ": "L",        "গ": "M",        "ঘ": "N",        "ঙ": "O",        "চ": "P",        "ছ": "Q",        "জ": "R",        "ঝ": "S",        "ঞ": "T",
            "ট": "U",        "ঠ": "V",        "ড": "W",        "ঢ": "X",        "ণ": "Y",        "ত": "Z",        "থ": "_",        "দ": "`",        "ধ": "a",        "ন": "b",
            "প": "c",        "ফ": "d",        "ব": "e",        "ভ": "f",        "ম": "g",        "য": "h",        "র": "i",        "ল": "j",        "শ": "k",        "ষ": "l",
            "স": "m",        "হ": "n",        "ড়": "o",        "ঢ়": "p",        "য়": "q",        "ৎ": "r",        "ং": "s",        "ঃ": "t",        "ঁ": "u",        "ৰ": "v", "ড়": "o",        "ঢ়": "p",        "য়": "q",
             "র্বৃ": "e„©",       "ৱ": "w",     "ড়ে": "‡o",        "ঢ়ে": "‡p",        "য়ে": "‡q",   "ড়ৈ": "‰o",        "ঢ়ৈ": "‰p",        "য়ৈ": "‰q",    "ড়ি": "wo",   "ড়ো" :"‡ov",     "ঢ়ি": "wp",  	"য়ো": "‡qv",      "য়ি": "wq",

            // নম্বর সেকশন
            "০": "0",        "১": "1",        "২": "2",        "৩": "3",        "৪": "4",        "৫": "5",        "৬": "6",        "৭": "7",        "৮": "8",        "৯": "9",
            "৳": "৳",        "₹": "₹",

            // কার চিহ্ন সেকশন
            "া": "v",        "ি": "w",        "ী": "x",        "ু": "y",        "ূ": "~",        "ৃ": "„",

            // ফলা সেকশন
            "্র": "ª",        "্য": "¨",        "র্": "©",	

            // ওকার ঔকার সেকশন
            "ে": "‡",        "ৈ": "‰",        "ো": "‡v",       "ৌ": "‡Š",       "ৗ": "Š",

            // জয়েনার সেকশন
            "্": "&",

            // বিবিধ
            "।": "|",        "॥": "||",       "‘": "Ô",        "’": "Õ",        "“": "Ò",        "”": "Ó",        "৷": "৷",        "৥": "৥",


			
            // যুক্তবর্ণ সেকশন
            "ক্ক": "°",      "ক্ট": "±",      "ক্ত": "³",      "ক্ব": "K¡",     "ক্র": "µ",   "ক্লি": "wK¬",    "ক্ল": "K¬",     "ক্ষ": "¶",      "ক্স": "·",      "খ্র": "Lª",     "গ্দ": "M&`", 
            "গ্ধ": "»",      "গ্ন": "Mœ",     "গ্ম": "M¥",     "গ্র": "MÖ",     "গ্ল": "Mø",     "ঙ্ক": "¼",      "ঙ্খ": "•L",     "ঙ্গ": "½",      "ঙ্ঘ": "•N",     "চ্চ": "”P",
            "চ্ছ": "”Q",     "জ্জ": "¾",      "জ্ঝ": "À",      "জ্ঞ": "Á",      "জ্ব": "R¡",     "জ্র": "Rª",     "ঞ্চ": "Â",      "ঞ্ছ": "Ã",      "ঞ্জ": "Ä",	"ন্ব": "š^",
            "ঞ্ঝ": "Å",      "ট্ট": "Æ",      "ট্ব": "U¡",     "ট্ম": "U¥",     "ট্র": "Uª",     "ড্ড": "Ç",      "ড্র": "Wª",     "ঢ্র": "Xª",     "ণ্ট": "È",		"ত্ব": "Z¡",
            "ণ্ঠ": "É",      "ণ্ড": "Ð",      "ণ্ণ": "Yœ",     "ত্ত": "Ë",      "ত্থ": "Ì",      "ত্ন": "Zœ",     "ত্ম": "Z¥",     "ত্র": "Î",      "দ্দ": "Ï",		"ঙ্ম": "•g",	
            "দ্ধ": "×",      "দ্ব": "Ø",      "দ্ভ": "™¢",     "দ্ম": "Ù",      "দ্র": "`ª",     "ধ্ব": "aŸ",     "ধ্ম": "a¥",     "ন্ত": "šÍ",     "ন্থ": "š’",	"ক্ম": "´",
            "ন্দ": "›`",     "ন্ধ": "Ü",      "ন্ন": "bœ",     "ন্ম": "b¥",     "প্ট": "Þ",      "প্ত": "ß",      "প্ন": "cœ",     "প্প": "à",      "প্র": "cÖ",		"ক্ষ্ণ": "ÿè",
            "প্ল": "cø",     "প্স": "á",      "ফ্র": "d«",     "ফ্ল": "d¬",     "ব্জ": "â",      "ব্দ": "ã",      "ব্ধ": "ä",      "ব্ব": "eŸ",     "ব্র": "eª",	"গ্গ": "¹",
            "ব্ল": "eø",     "ভ্র": "å",      "ম্ন": "gœ",     "ম্ফ": "ç",      "ম্ব": "¤^",     "ম্ভ": "¤¢",     "ম্ম": "¤§",     "ম্র": "gª",     "ম্ল": "¤ø",	 "থ্ব": "_¡",
            "ল্ক": "é",      "ল্গ": "ê",      "ল্ট": "ë",      "ল্ড": "ì",      "ল্প": "í",      "ল্ব": "j¦",     "ল্ম": "j¥",     "ল্ল": "jø",     "শ্চ": "ð",	 "দ্দ্ব": "Ï¡",
            "শ্ন": "kœ",     "শ্ব": "k¦",     "শ্ম": "k¥",     "শ্ল": "kø",     "ষ্ক": "®‹",     "ষ্ট": "ó",      "ষ্ঠ": "ô",      "ষ্ণ": "ò",      "ষ্প": "®ú",	 "ন্ত্ব": "šÍ¡",
            "ষ্ফ": "õ",      "ষ্ম": "®§",     "স্ক": "¯‹",     "স্খ": "ö",      "স্ট": "÷",      "স্ত": "¯Í",     "স্থ": "¯’",     "স্ন": "mœ",     "স্প": "¯ú",	 "স্রূ": "¯ªƒ",
            "স্ফ": "ù",      "স্ব": "¯^",     "স্ম": "¯§",     "স্ল": "¯ø",     "হ্ণ": "nè",     "হ্ন": "ý",      "হ্ম": "þ",      "হ্ল": "n¬",     "হু": "û",		"ড়ু": "o–", 
            "হৃ": "ü",      "গু": "¸",      "শু": "ï",      "ক্ত্র": "³ª",     "ক্ন": "Kè",     "ক্ষ্ণ": "òœ",     "ক্ষ্ম": "²",      "ক্ষ্র": "ÿ«",     "গ্ব": "M&e",	"য়ু": "qy", 
            "ঘ্ন": "Nœ",     "ঘ্র": "Nª",     "ঙ্গু": "½y",     "জ্জ্ব": "¾¡",   "ত্ত্ব": "Ë¡",     "ত্রু": "Îæ",     "দ্রু": "`ªæ",    "ভ্রু": "åæ",     "শ্রু": "kÖæ",	"য়ূ": "q~",
            "ম্প": "¤ú",     "্র্য": "ª‍¨",    "র‌্য": "i¨",     "ক্য": "K¨",     "ল্যু": "j¨y",    "ক্লু": "K¬z",    "ত্র্য": "Î¨",     "স্থ্য": "¯’¨",    "দ্য": "`¨", 
            "ক্য": "K¨",     "ভ্য": "f¨",     "ল্য": "j¨", 	"দ্যু": "`y¨",     "ম্য": "g¨",     "ন্য": "b¨",     "ণ্য": "Y¨",     "কার্য": "Kvh©",   "র্ষ": "l©",       "র্য": "h©",		
		"ব্যু": "ey¨",   "ত্ব": "Z¡",	"হ্ব": "nŸ",	"গ্নু": "Mœy",	"র্ু": "z©",       "৳": "$",      "র্ষূ": "l~©",        "র্ষু": "ly©",    "–": "-","৷": "|",	"ড়ূ": "o~",  "“ছ": "ÒQ",
       

		
		};

        // বিজয় থেকে ইউনিকোড রূপান্তরের জন্য ম্যাপিং
        const bijoyToUnicodeMap = {
            // স্বরবর্ণ সেকশন
            "A": "অ",        "Av": "আ",       "B": "ই",        "C": "ঈ",        "D": "উ",        "E": "ঊ",        "F": "ঋ",        "G": "এ",        "H": "ঐ",        "I": "ও",
            "J": "ঔ",

            // *** সংশোধিত অংশ শুরু ***
            "†": "ে", // 'এ' এর পরিবর্তে 'ে' (e-kar)
            "ˆ": "ৈ", // 'ঐ' এর পরিবর্তে 'ৈ' (oi-kar)
            // *** সংশোধিত অংশ শেষ ***
			"‡": "ে", // 'এ' এর পরিবর্তে 'ে' (e-kar)
            "‰": "ৈ",
            // ব্যাঞ্জনবর্ণ সেকশন
            "K": "ক",        "L": "খ",        "M": "গ",        "N": "ঘ",        "O": "ঙ",        "P": "চ",        "Q": "ছ",        "R": "জ",        "S": "ঝ",        "T": "ঞ",
            "U": "ট",        "V": "ঠ",        "W": "ড",        "X": "ঢ",        "Y": "ণ",        "Z": "ত",        "_": "থ",        "`": "দ",        "a": "ধ",        "b": "ন",
            "c": "প",        "d": "ফ",        "e": "ব",        "f": "ভ",        "g": "ম",        "h": "য",        "i": "র",        "j": "ল",        "k": "শ",        "l": "ষ",
            "m": "স",        "n": "হ",        "o": "ড়",        "p": "ঢ়",        "q": "য়",        "r": "ৎ",        "s": "ং",        "t": "ঃ",        "u": "ঁ",

            // নম্বর সেকশন
            "0": "০",        "1": "১",        "2": "২",        "3": "৩",        "4": "৪",        "5": "৫",        "6": "৬",        "7": "৭",        "8": "৮",        "9": "৯",
            "৳": "৳",

            // কার চিহ্ন সেকশন
            "v": "া",        "w": "ি",        "x": "ী",        "y": "ু",        "~": "ূ",        "„": "ৃ",		"‡v": "ো", 	"z": "ু", 	"†v": "ো",		"†Š": "ৌ", 	"‡Š": "ৌ",

            // ফলা সেকশন
            "ª": "্র",        "¨": "্য",        "©": "র্", 	"Ö": "্র",

            // ওকার ঔকার সেকশন
            "‡": "ে",        "‰": "ৈ",        "Š": "ৗ",

            // জয়েনার সেকশন
            "&": "্",

            // বিবিধ
           	"¯’": "¯’",		"”Q": "”Q",		 "|": "।",        "||": "॥",       "Ô": "‘",        "Õ": "’",        "Ò": "“",        "Ó": "”",        " ": " ",        ".": ".",        ",": ",",        "-": "-",
            "?": "?",        "!": "!",        "'": "'",        "(": "(",        ")": ")",	"iæ": "রু",	"eªæ": "ব্রু", 	"Zz": "তু",	"nŸ": "হ্ব",

            // যুক্তবর্ণ সেকশন
            "°": "ক্ক",      "±": "ক্ট",      "³": "ক্ত",      "K¡": "ক্ব",     "µ": "ক্র",  "wK¬": "ক্লি",     "K¬": "ক্ল",     "¶": "ক্ষ",      "·": "ক্স",      "Lª": "খ্র",     "M&`": "গ্দ",
            "»": "গ্ধ",      "Mœ": "গ্ন",     "M¥": "গ্ম",     "MÖ": "গ্র",     "Mø": "গ্ল",     "¼": "ঙ্ক",      "•L": "ঙ্খ",     "½": "ঙ্গ",      "•N": "ঙ্ঘ",     "”P": "চ্চ",
            "”Q": "চ্ছ",     "¾": "জ্জ",      "À": "জ্ঝ",      "Á": "জ্ঞ",      "R¡": "জ্ব",     "Rª": "জ্র",     "Â": "ঞ্চ",      "Ã": "ঞ্ছ",      "Ä": "ঞ্জ",	"cÖæ": "প্রু",
            "Å": "ঞ্ঝ",      "Æ": "ট্ট",      "U¡": "ট্ব",     "U¥": "ট্ম",     "Uª": "ট্র",     "Ç": "ড্ড",      "Wª": "ড্র",     "Xª": "ঢ্র",     "È": "ণ্ট",	"MÖæ": "গ্রু",
            "É": "ণ্ঠ",      "Ð": "ণ্ড",      "Yœ": "ণ্ণ",     "Ë": "ত্ত",      "Ì": "ত্থ",      "Zœ": "ত্ন",     "Z¥": "ত্ম",     "Î": "ত্র",      "Ï": "দ্দ",	"¯ª": "স্র",
            "×": "দ্ধ",      "Ø": "দ্ব",      "™¢": "দ্ভ",     "Ù": "দ্ম",      "`ª": "দ্র",     "aŸ": "ধ্ব",     "a¥": "ধ্ম",     "šÍ": "ন্ত",     "š’": "ন্থ",   "e„©": "র্বৃ",
            "›`": "ন্দ",     "Ü": "ন্ধ",      "bœ": "ন্ন",     "b¥": "ন্ম",     "Þ": "প্ট",      "ß": "প্ত",      "cœ": "প্ন",     "à": "প্প",      "cÖ": "প্র", 	"¤œ": "ম্ন",
            "cø": "প্ল",     "á": "প্স",      "d«": "ফ্র",     "d¬": "ফ্ল",     "â": "ব্জ",      "ã": "ব্দ",      "ä": "ব্ধ",      "eŸ": "ব্ব",     "eª": "ব্র",	 "´": "ক্ম",
            "eø": "ব্ল",     "å": "ভ্র",      "gœ": "ম্ন",     "ç": "ম্ফ",      "¤^": "ম্ব",     "¤¢": "ম্ভ",     "¤§": "ম্ম",     "gª": "ম্র",     "¤ø": "ম্ল",		"ÿè": "ক্ষ্ন",
            "é": "ল্ক",      "ê": "ল্গ",      "ë": "ল্ট",      "ì": "ল্ড",      "í": "ল্প",      "j¦": "ল্ব",     "j¥": "ল্ম",     "jø": "ল্ল",     "ð": "শ্চ",		"ÿ&Y": "ক্ষ্ণ",
            "kœ": "শ্ন",     "k¦": "শ্ব",     "k¥": "শ্ম",     "kø": "শ্ল",     "®‹": "ষ্ক",     "ó": "ষ্ট",      "ô": "ষ্ঠ",      "ò": "ষ্ণ",      "®ú": "ষ্প",		"¹": "গ্গ",
            "õ": "ষ্ফ",      "®§": "ষ্ম",     "¯‹": "স্ক",     "ö": "স্খ",      "÷": "স্ট",      "¯Í": "স্ত",     "¯’": "স্থ",     "mœ": "স্ন",     "¯ú": "স্প",	"M&M": "গ্গ",
            "ù": "স্ফ",      "¯^": "স্ব",     "¯§": "স্ম",     "¯ø": "স্ল",     "nè": "হ্ণ",     "ý": "হ্ন",      "þ": "হ্ম",      "n¬": "হ্ল",     "û": "হু",	"_¡": "থ্ব",
            "ü": "হৃ",      "¸": "গু",      "ï": "শু",      "³ª": "ক্ত্র",     "Kè": "ক্ন",     "òœ": "ক্ষ্ণ",     "²": "ক্ষ্ম",      "ÿ«": "ক্ষ্র",     "M&e": "গ্ব",	"Ï¡": "দ্দ্ব",
            "Nœ": "ঘ্ন",     "Nª": "ঘ্র",     "½y": "ঙ্গু",     "¾¡": "জ্জ্ব",   "Ë¡": "ত্ত্ব",     "Îæ": "ত্রু",     "`ªæ": "দ্রু",     "åæ": "ভ্রু",     "kÖæ": "শ্রু",	"šÍ¡": "ন্ত্ব",
            "¤ú": "ম্প",     "ª‍¨": "্র্য",    "i¨": "র‌্য",     "K¨": "ক্য",     "j¨y": "ল্যু",    "K¬z": "ক্লু",    "Î¨": "ত্র্য",     "¯’¨": "স্থ্য",    "`¨": "দ্য",	"gø": "ম্ল",
            "f¨": "ভ্য",     "j¨": "ল্য",     "g¨": "ম্য",     "b¨": "ন্য",     "Y¨": "ণ্য",     "Kv¨": "ক্যা",      	"ÿ": "ক্ষ",		"åƒ": "ভ্রূ",	"¯ªƒ": "স্রূ",
		"Z¡": "ত্ব",	"Û": "ন্ড",	"š¿": "ন্ত্র",    "z©": "র্ু", 	"y¨": "্যু",      "©…": "র্ৃ",     "z©": "র্ু",   "z©": "র্ু",    "‚©": "র্ূ",  "•ÿ": "ঙ্ক্ষ", "b¦": "ন্ব",	"¯cø": "স্প্ল",
		"~¨": "্যূ",   "z¨": "্যু",        "‚¨": "্যূ",  	"Kz©¨": "র্ক্যু",   "K‚©¨": "র্ক্যূ",  "³": "ক্ত",       "¯‘": "স্তু", 	"¯¿": "স্ত্র", 	"vu": "াঁ", 	"œ": "্ন",	"¼Í": "ঙ্ক্ত",
		"uv": "াঁ",	 "›Uª": "ন্ট্র",     "n«": "হ্র",	    "š‘": "ন্তু",	    "Z…": "তৃ",	    "K…": "কৃ",	    "P‚": "চূ",	    "f‚": "ভূ",	    "iƒ": "রূ",	  "¦": "্ব",
		"›U": "ন্ট",	    "«": "্র",	    "…": "ৃ",	    "‚": "ূ", 	     "æ": "ু",      "Ý": "ন্স",      "š^": "ন্ব",    "MÖƒ": "গ্রূ", "cÖƒ": "প্রূ", 
			"eªƒ": "ব্রূ", "kÖƒ": "শ্রূ",	"_¦": "থ্ব", "˜M": "দ্গ", "˜N": "দ্ঘ", "Ï": "দ্দ", "$": "৳", "K¥": "ক্ম", "òœ": "ক্ষ্ণ", "M&M": "গ্গ", "º": "গ্দ", "˜M": "দ্গ", "O¥": "ঙ্ম", "”T": "চ্ঞ", 
"Y&X": "ণ্ঢ", "Y¥": "ণ্ম", "Zø": "ত্ল", "Îƒ": "ত্রূ", "_¦": "থ্ব", "_ø": "থ্ল", "™£": "দ্ভ্র", "`ªƒ": "দ্রূ", "Ú": "ন্ঠ", "šÍ¦": "ন্ত্ব", "š’": "ন্থ", "åƒ": "ভ্রূ", "fø": "ভ্ল", "¤£": "ম্ভ্র", "¤ø": "ম্ল",
"î": "ল্ফ", "ñ": "শ্ছ", "®Œ": "ষ্ক্র", "¯Œ": "স্ক্র", "¯’": "স্থ", "¯ª~": "স্রূ", "¯ø": "স্ল", "—M": "ড়্গ", "aªƒ": "ধ্রূ", "¯úø": "স্প্ল", "¤úø": "ম্প্ল", "•g": "ঙ্ম", 	"mø": "স্ল", "¯": "্স",  "Zz¨": "ত্যু",	"¨~": "্যূ",	"o–": "ড়ু",
				
		};
        // ====================================================================
        // ম্যানুয়াল আনসি (বিজয়) রিপ্লেসমেন্ট ম্যাপ
        // ইউনিকোড থেকে বিজয় কনভার্সনের পর নির্দিষ্ট ভুল সংশোধনের জন্য ব্যবহৃত হয়।
        // ফরম্যাট: "ভুল স্ট্রিং": "সঠিক স্ট্রিং"
        const manualAnsiReplacements = {
            // নিচেরগুলোর মতো ম্যানুয়ালী বসাতে হবে সিকুয়েন্স, যদি আন্সিতে কোনো ভুল আউটপুট আসে।
            // ভবিষ্যতে আরও রিপ্লেসমেন্ট নিয়ম এখানে যোগ করুন
            "GZ‡": "G‡Z", // "এতে" GZ‡ কে G‡Z দিয়ে প্রতিস্থাপন করা হয়েছে, আন্সিতে ভুল আউটপুট এখানে এভাবে অ্যাড করতে হবে, আন্সি ভুল টু আন্সি সঠিক
			"‡ga¨": "g‡a¨",        "P&P": "”P",      "¨y": "y¨",       "©„": "©…",        "—": "-",        	"¯’": "¯’",		"”Q": "”Q",
			"+‡": "+†",        "+‰": "+ˆ",       "vu": "uv",       "xu": "ux",       "Šu": "uŠ",      "`¨y": "`y¨",           "Ô‡": "Ô†",       "Ò‡": "Ò†",      "-‡": "-†",       "(‡": "(†",       "Ô‰": "Ôˆ", // Corrected from "ˆ"
			"Ò‰": "Òˆ",        "-‰": "-ˆ",       "(‰": "ˆ",       "¶y": "ÿz",       "ww¯’Z": "w¯’wZ",      "cz©": "c©y",     "‡‡": "‡",        "††": "†",	"©z": "z©",
			"‰‰": "‰",         "ˆˆ": "ˆ",        "yy": "y",        "~~": "~",        "©©": "©",       "„„": "„",        "&&": "&",        "ªª": "ª",        "ŠŠ": "Š",
			"/‡": "/†",        "/‰": "(ˆ",       "=‡": "=†",       "=‰": "=ˆ",       "[‡": "[†",      "[‰": "[ˆ",      "{‡": "{†",       "{‰": "{ˆ",       " ‡": " †",
			" ‰": " ˆ",         "&;": "Ê",        "&|": "\\",      "&~": "E",        "&„": "F",        "&‡": "G",        "&‰": "H",
			"&b": "œ",         "&e": "¦",        "&g": "¥",        "&I": "I",        "&I&h": "I¨",    "&I&i": "Iª",     "&j": "ø",        "&Ô": "“",        "&Š": "J",
			"&v": "Av",        "&w": "B",        "&x": "C",        "&y": "D",        "&Z": "Í",        "(A)i": "(A)i",  "_&_": "Ì",       "_&e": "_¡",       "_&h": "_¨",
			"_&i": "_ª",        "_ª": "_ª",        "_u_": "Ì",       "`&`": "Ï",       "`&a": "×",       "`&e": "Ø",        "`&f": "™¢",      "`&g": "Ù",        "`&h": "`¨",
			"`&i": "`ª",        "`&M": "˜M",       "`&N": "˜N",       "`ª": "`ª",       "`ª~": "`ªƒ",      "`ªy": "`ªæ",      "¯’~": "¯’‚",      "¯’„": "¯’…",      "¯’y": "¯’z",
			"¯‹&i": "¯Œ",       "¯‹&iæ": "¯Œz",   "¯‹&j": "¯‹¬",    "¯‹~": "¯‹‚",      "¯‹„": "¯‹…",      "¯‹¬y": "¯‹¬z",   "¯‹ª": "¯Œ",      "¯‹y": "¯‹z",      "¯Í&e": "¯Í¡",
			"¯Í&i": "¯¿",       "¯Í~": "¯Í‚",      "¯Í„": "¯Í…",      "¯Íª": "¯¿",       "¯Íy": "¯‘",      "¯Œ~": "¯Œ‚",      "¯Œ„": "¯Œ…",      "¯Œy": "¯Œz",      "¯ú&j": "¯úø",
			"˜M&y": "`&¸",      "”P~": "”P‚",      "”P„": "”P…",      "”Py": "”Pz",      "”Q&e": "”Q¡",    "”Q~": "”Q‚",      "”Q„": "”Q…",      "”Qª": "”Q«",      "”Qy": "”Qz",
			"”T~": "”T‚",      "”T„": "”T…",      "”Ty": "”Tz",      "›`&e": "›Ø",     "›`ª~": "›`ªƒ",   "›`ªy": "›`ªæ",   "›U~": "›U‚",      "›U„": "›U…",      "›Uy": "›Uz",
			"¤¢&i": "¤£",      "¤¢ª": "¤£",      "¤ú&i": "¤úª",    "¤ú&j": "¤úø",    "±~": "±‚",       "±„": "±…",       "±y": "±z",       "»~": "»‚",       "»„": "»…",
			"»y": "»z",        "×~": "×‚",       "×„": "×…",       "×y": "×z",       "÷~": "÷‚",      "÷„": "÷…",       "÷y": "÷z",       "®‹~": "®‹‚",      "®‹„": "®‹…",
			"®‹ª": "®Œ",       "®‹y": "®‹z",      "®Œ~": "®Œ‚",      "®Œ„": "®Œ„",      "®Œy": "®Œz",      "®úª": "®úÖ",    "®úª~": "®úÖƒ",   "®úªy": "®úÖæ",   "°~": "°‚",
			"°„": "°…",        "°y": "°z",        "µ~": "µ‚",       "µ„": "µ…",       "µy": "µz",       "•ÿ~": "•ÿ‚",      "•ÿ„": "•ÿ…",      "•ÿy": "•ÿz",      "¼&l": "•ÿ",
			"¼~": "¼‚",        "¼„": "¼…",       "¼«~": "¼«‚",      "¼«„": "¼«…",      "¼«y": "¼«z",      "¼ª": "¼«",       "¼y": "¼z",       "¾&e": "¾¡",      "³~": "³‚",
			"³„": "³…",        "³ª": "³«",       "³y": "³z",       "a&e": "aŸ",       "a&g": "a¥",       "a&h": "a¨",       "A&h": "A¨",       "a&i": "aª",       "A&i": "Aª",
			"Á~": "Á‚",        "À~": "À‚",       "ä~": "ä‚",       "Ã~": "Ã‚",       "å~": "åƒ",       "Â‚": "Â‚",       "Á„": "Á…",       "À„": "À…",       "ä„": "ä…",
			"Ã„": "Ã…",        "Â…": "Â…",       "aª": "aª",       "Aª": "Aª",       "aª~": "aªƒ",      "aªy": "aªæ",      "Æ~": "Æ‚",       "Æ„": "Æ…",       "Æy": "Æz",
			"Av&h": "Av¨",     "Av&i": "Avª",    "Avª": "Avª",      "Áy": "Áz",       "Ây": "Âz",       "äy": "äz",       "Ãy": "Ãz",       "åy": "åæ",       "Àz": "Àz",
			"b&_": "š’",       "b&`": "›`",      "b&a": "Ü",       "b&b": "bœ",       "b&e": "š^",       "b&g": "b¥",       "b&h": "b¨",       "B&h": "B¨",       "b&i": "bª",
			"B&i": "Bª",        "b&m": "Ý",        "b&U": "›U",      "b&V": "Ú",       "b&W": "Û",       "b&Z": "šÍ",      "b&Z&i": "š¿",    "b&Zª": "š¿",      "bª": "bª",
			"Bª": "Bª",         "c&b": "cœ",       "c&c": "à",       "c&h": "c¨",       "C&h": "C¨",       "c&i": "cÖ",       "C&i": "Cª",       "c&j": "cø",       "c&m": "á",
			"c&U": "Þ",        "c&Z": "ß",       "ç~": "ç‚",       "Ç~": "Ç‚",       "ç„": "ç…",       "Ç„": "Ç…",       "cª": "cÖ",       "Cª": "Cª",       "cª~": "cÖƒ",
			"cªy": "cÖæ",      "cÖ~": "cÖƒ",      "cÖy": "cÖæ",      "çy": "çz",       "Çy": "Çz",       "d&h": "d¨",       "d&i": "d«",       "D&i": "Dª",       "d&j": "d¬",
			"d~": "d‚",        "ð~": "ð‚",       "Ð~": "Ð‚",       "d„": "d…",       "ð„": "ð…",       "Ð„": "Ð…",       "d«~": "d«‚",      "d«„": "d«…",      "d«y": "d«z",
			"d¬~": "d¬‚",      "d¬„": "d¬„",      "d¬y": "d¬z",      "dª": "d«",       "dy": "dz",       "ðy": "ðz",       "Ðy": "Ðz",       "e&`": "ã",       "e&a": "ä",
			"e&e": "eŸ",       "Ë&e": "Ë¡",      "e&h": "e¨",       "e&i": "eª",       "E&i": "Eª",       "e&j": "eø",       "e&R": "â",       "é~": "é‚",       "É~": "É‚",
			"È~": "È‚",        "ë~": "ë‚",      "Ë~": "Ë‚",       "é„": "é…",       "É„": "É…",       "È„": "È…",       "ë„": "ë…",       "Ë„": "Ë…",       "eª": "eª",
			"eª~": "eªƒ",      "eªy": "eªæ",      "éy": "éz",       "Éy": "Éz",       "Èy": "Èz",       "ëy": "ëz",       "Ëy": "Ëz",       "f&h": "f¨",       "F&h": "F¨",
			"f&i": "å",        "F&i": "Fª",       "f&j": "fø",      "f~": "f‚",       "f„": "f…",       "fª": "å",        "Fª": "Fª",       "fª~": "åƒ",      "fªy": "åæ",
			"fy": "fz",        "g&b": "¤œ",       "g&c": "¤ú",      "g&d": "ç",       "g&e": "¤^",       "g&f": "¤¢",       "g&f&i": "¤£",    "g&fª": "¤£",      "g&g": "¤§",
			"g&h": "g¨",       "G&h": "G¨",       "g&i": "¤ª",      "G&i": "Î",       "g&j": "¤ø",       "gª": "¤ª",       "Gª": "Gª",       "h&h": "h¨",       "H&h": "H¨",
			"h&i": "hª",       "H&i": "Hª",       "hª": "hª",       "Hª": "Hª",       "i&&I": "I©",     "i&_": "_©",       "i&`": "`©",      "i&a": "a©",       "i&A": "A©",
			"i&Av": "Av©",     "i&b": "b©",       "i&B": "B©",       "i&c": "c©",       "i&C": "C©",       "i&d": "d©",       "i&D": "D©",       "i&e": "e©",       "i&E": "E©",
			"i&f": "f©",       "i&F": "F©",       "i&g": "g©",       "i&G": "G©",       "i&h": "h©",       "i&H": "H©",       "i&i": "iª",       "i&I": "I©",       "I&i": "Iª",
			"i&j": "j©",       "i&J": "J©",       "i&k": "k©",       "i&K": "K©",       "i&l": "l©",       "i&L": "L©",       "i&m": "m©",       "i&M": "M©",       "i&n": "n©",
			"i&N": "N©",       "i&o": "o©",       "i&O": "O©",       "i&p": "p©",       "i&P": "P©",       "i&q": "q©",       "i&Q": "Q©",       "i&R": "R©",       "i&S": "S©",
			"i&T": "T©",       "i&U": "U©",       "i&V": "V©",       "i&W": "W©",       "i&X": "X©",       "i&Y": "Y©",       "i&Z": "Z©",       "i~": "iƒ",        "î~": "î~",
			"Î~": "Îƒ",       "î„": "î…",       "iª": "iª",        "Iª": "Iª",        "îª": "î«",       "iy": "iæ",        "îy": "îz",        "Îy": "Îæ",       "j&c": "í",
			"j&d": "î",        "j&d&i": "î«",     "j&dª": "î«",      "j&e": "j¦",       "j&g": "j¥",       "j&h": "j¨",       "J&h": "J¨",       "j&i": "jª",       "j&j": "jø",
			"j&K": "é",        "j&M": "ê",        "j&U": "ë",       "j&W": "ì",        "jª": "jª",        "Jª": "Jª",        "k&b": "kœ",       "K&b": "Kè",       "k&e": "k¦",
			"K&e": "K¡",       "k&g": "k¥",       "K&g": "´",        "k&h": "k¨",       "K&h": "K¨",       "k&i": "kÖ",       "K&i": "µ",        "K&j": "K¬",       "K&K": "°",
			"K&l": "ÿ",        "K&m": "·",        "k&P": "ð",       "k&Q": "ñ",        "K&U": "±",       "K&Z": "³",       "K&Zª": "³«",      "K~": "K‚",        "K„": "K…",
			"K¬~": "K¬‚",      "K¬„": "K¬…",      "K¬y": "K¬z",      "kª": "kÖ",       "Kª": "µ",        "kª~": "kÖƒ",      "Kª~": "µ’",      "kªy": "kÖæ",      "Kªy": "µ",
			"Kè~": "Kè‚",      "Kè„": "Kè…",      "Kèy": "Kèz",      "kÖ~": "kÖƒ",      "kÖy": "kÖæ",      "ky": "ï",        "Ky": "Kz",        "l&c": "®ú",      "l&d": "õ",
			"l&g": "®§",       "l&h": "l¨",       "L&h": "L¨",       "l&i": "lª",       "L&i": "Lª",       "l&K": "®‹",       "l&U": "ó",       "l&V": "ô",       "l&Y": "ò",
			"lª": "lª",        "Lª": "Lª",        "Lª~": "Lªƒ",      "Lªy": "Lªæ",      "m&_": "¯’",       "M&`": "º",       "M&a": "»",       "m&b": "¯œ",       "M&b": "Mœ",
			"m&c": "¯ú",       "m&d": "ù",        "m&e": "¯^",       "M&e": "M¦",       "m&g": "¯§",       "M&g": "M¥",       "m&h": "m¨",       "M&h": "M¨",       "m&i": "¯ª",
			"M&i": "MÖ",       "m&j": "¯ø",       "M&j": "Mø",       "m&K": "¯‹",       "m&K&i": "¯Œ",     "m&K&iy": "¯Œz",  "m&Kª": "¯Œ",      "m&Kªy": "¯Œz",    "m&L": "ö",
			"m&U": "÷",        "m&Z": "¯Í",      "mª": "¯ª",       "Mª": "MÖ",       "Mª~": "MÖƒ",      "Mªy": "MÖæ",      "MÖ~": "MÖƒ",      "MÖy": "MÖæ",      "My": "¸",
			"n&b": "ý",        "N&b": "Nœ",       "n&e": "nŸ",       "n&e2": "n¡",     "n&g": "þ",        "n&h": "n¨",       "N&h": "N¨",       "n&i": "n«",       "N&i": "Nª",
			"n&j": "n¬",       "n&Y": "nè",       "ñ~": "ñ‚",       "n„": "ü",        "ñ„": "ñ…",       "nª": "n«",       "Nª": "Nª",       "Nª~": "Nªƒ",      "Nªy": "Nªæ",
			"ny": "û",         "ñy": "ñz",        "O&g": "•g",       "o&h": "o¨",       "O&h": "O¨",       "o&i": "oª",       "O&i": "Oª",       "O&K": "¼",       "O&L": "•L",
			"o&M": "—M",       "O&M": "½",        "O&N": "•N",       "O~": "O‚",        "ó~": "ó‚",       "ò~": "ò‚",       "ô~": "ô‚",       "õ~": "õ‚",       "O„": "O…",
			"ó„": "ó…",        "ò„": "ò…",       "ô„": "ô…",       "õ„": "õ…",       "oª": "oª",       "Oª": "Oª",       "oy": "o–",       "Oy": "Oz",        "óy": "óz",
			"òy": "òz",        "ôy": "ôz",       "õy": "õz",       "p&h": "p¨",       "P&h": "P¨",       "p&i": "pª",       "P&i": "Pª",       "P&P": "”P",       "P&Q": "”Q",
			"P&T": "”T",       "P~": "P‚",        "P„": "P…",       "pª": "pª",       "Pª": "Pª",       "Puv": "Pvu",      "Py": "Pz",        "q&h": "q¨",       "Q&h": "Q¨",
			"q&i": "qª",       "Q&i": "Q«",       "Q~": "Q‚",        "Q„": "Q…",       "qª": "qª",       "Qª": "Q«",       "Qy": "Qz",        "R&e": "R¡",       "R&h": "R¨",
			"R&i": "Rª",       "R&R": "¾",        "R&S": "À",        "R&T": "Á",       "Rª": "Rª",       "rª\t": "rª",     "S&h": "S¨",       "S&i": "Sª",       "S~": "S‚",
			"š’~": "š’‚",      "š’„": "š’…",      "š’y": "š’z",      "S„": "S…",       "sª": "sª",       "Sª": "Sª",       "šÍ&i": "š¿",     "šÍ~": "šÍ‚",      "šÍ„": "šÍ…",
			"šÍª": "š¿",       "šÍy": "š‘",       "ß~": "ß‚",       "ß„": "ß…",       "ßy": "ßz",       "Sy": "Sz",        "T&h": "T¨",       "T&i": "Tª",       "T&P": "Â",
			"T&Q": "Ã",        "T&R": "Ä",        "T&S": "Å",        "T~": "T‚",        "T„": "T…",       "tª": "tª",       "Tª": "Tª",       "þ~": "þ~",        "Þ~": "Þ‚",
			"þ„": "þ„",        "Þ„": "Þ…",       "þy": "þz",       "Þy": "Þz",       "Ty": "Tz",        "™¢~": "™¢‚",      "™¢„": "™¢…",      "™¢ª": "™£",      "™¢y": "™¢z",
			"™£~": "™£ƒ",      "™£y": "™£æ",      "U&e": "U¡",       "U&g": "U¥",       "U&h": "U¨",       "U&i": "Uª",       "U&U": "Æ",       "U~": "U‚",        "Ú~": "Ú‚",
			"ù~": "ù‚",        "Û~": "Û‚",       "Ü~": "Ü‚",       "U„": "U…",       "Ú„": "Ú…",       "ù„": "ù…",       "Û„": "Û…",       "Ü„": "Ü…",       "ù«~": "ù«‚",
			"Ü«~": "Ü«‚",      "Ü«„": "Ü«…",      "ù«y": "ù«z",      "Ü«y": "Ü«z",      "Uª": "Uª",       "ùª": "ù«",       "Üª": "Ü«",       "uŠ": "Šu",        "ux": "xu",
			"uy": "yu",        "Uy": "Uz",        "Úy": "Úz",       "ùy": "ùz",       "Ûy": "Ûz",       "Üy": "Üz",       "V&h": "V¨",       "V&i": "Vª",       "V~": "V‚",
			"V„": "V…",        "Vª": "Vª",        "Vy": "Vz",        "W&h": "W¨",       "W&i": "Wª",       "W&W": "Ç",       "W~": "W‚",        "W„": "W…",       "Wª": "Wª",
			"Wy": "Wz",        "X&h": "X¨",       "X&i": "Xª",       "X~": "X‚",        "X„": "X…",       "Xª": "Xª",       "Xy": "Xz",        "Y&b": "Yœ",       "ÿ&b": "ÿè",
			"Y&e": "Y¦",       "ÿ&g": "²",        "Y&h": "Y¨",       "Y&i": "Yª",       "Y&U": "È",       "Y&V": "É",       "Y&W": "Ð",       "ÿ~": "ÿ‚",         "ÿ„": "ÿ…",
			"Yª": "Yª",        "ÿè~": "ÿè‚",      "ÿè„": "ÿè…",      "ÿèy": "ÿèz",      "ÿy": "ÿz",       "Z&_": "Ì",       "Z&b": "Zœ",       "Z&e": "Z¡",          "Z&g": "Z¥",
			"Z&h": "Z¨",       "Z&i": "Î",        "Z&Z": "Ë",       "Z~": "Z‚",        "Z„": "Z…",       "Zª": "Î",        "Zª~": "Îƒ",          "Zªy": "Îæ",           "Zy": "Zz",
			"|‡": "|†",			",‡": ",†",			".‡": ".†",			"-‡": "-†",			"?‡": "?†",		":‡": ":†",			"=‡": "=†",			"|‰": "|ˆ",	     "K©~": "K‚©",	
			",‰": ",ˆ",		"f¨~": "f‚¨",				"f©~": "f‚©",		".‰": ".ˆ",		"-‰": "-ˆ",			"?‰": "?ˆ",			":‰": ":ˆ",		"=‰": "=ˆ",   "wwK¬": "wK¬w",
			"e©…": "e„©",	   "e¨~": "e~¨",    	  "P©~": "P‚©Ó",   		 "P©y": "Pz©",     "K©y" :"Kz©", 			"f©y": "fz©",		 "Ky": "Kz",	"v©": "©v",		"x©": "©x",
			"Š©": "©Š", 		"¯Õ": "¯’",			"ÓQ": "”Q", 		"ÒQ": "”Q",	"wwó": "wów",	"šÔ": "š‘",	"dÖ": "d«",  "f’": "f‚",	"šÕ": "š’", "¯Ô": "¯‘",	"ÓP": "”P", "ÓT": "”T", "e«": "eª", 	"g…": "g„",	"e…" : "e„",	"U«" : "Uª",	"d«" : "d«",	"k«" : "kÖ",	"'‡" : "'†",	
			"'‰" : "'ˆ",		"gœ": "¤œ",		"Auv": "Avu",		"iÒ": "iæ",		"M«": "MÖ",	"KÍ¡": "³¦", "¯-":"¯Í", 	"U©y": "Uz©",	"¨~": "‚¨", 		"©¨y": "y©¨", "©¨~": "~¨",	"¨©": "©¨",	"©¨z": "z©¨", "©¨‚": "‚©¨",	"©z": "z©",	"©‚": "‚©",	"©y": "y©", "©~": "~©", "P‚©Ó": "P‚©",	"MÖÒ": "MÖæ",	"Ê": "æ",	"­": "ø",
			"b‚": "b~",
			"ÎÒ": "Îæ", "_ªÒ": "_ªæ", "×Ÿ": "×¦", "`ªÒ": "`ªæ", "š-": "šÍ", "š-¡": "šÍ¦", "c&Î": "ßª", "cÖÒ": "cÖæ", "eªÒ": "eªæ", "åÒ": "åæ", "kÖÒ": "kÖæ", "¯ªÒ": "¯ªæ", "c«": "cÖ",	"÷«": "÷ª",	"U«": "Uª",

        };

        // ম্যানুয়াল ইউনিকোড রিপ্লেসমেন্ট ম্যাপ (নতুন সেকশন)
        // বিজয় থেকে ইউনিকোড কনভার্সনের পর নির্দিষ্ট ভুল সংশোধনের জন্য ব্যবহৃত হয়।
        // ফরম্যাট: "ভুল স্ট্রিং": "সঠিক স্ট্রিং"
        const manualUnicodeReplacements = {
            // "ভুল ইউনিকোড": "সঠিক ইউনিকোড",
            // উদাহরণ: "উদাহরণ": "উদাহরণ", 
			
			"র্তু্য": "র্ত্যু",
			"র্তূ্য": "র্ত্যূ",
			"র্ভূ্য": "র্ভ্যূ",
			"র্ভু্য": "র্ভ্যু",
        };
        // ====================================================================


        // দীর্ঘতম থেকে ছোট ক্রমে কীগুলি সাজান যাতে দীর্ঘ ক্রমগুলি প্রথমে হ্যান্ডেল করা যায়
        const sortedUnicodeKeys = Object.keys(unicodeToBijoyMap).sort((a, b) => b.length - a.length);
        const sortedBijoyKeys = Object.keys(bijoyToUnicodeMap).sort((a, b) => b.length - a.length);

        function convertLeftToRight() {
            const textAreaLeft = document.getElementById('textAreaLeft');
            const textAreaRight = document.getElementById('textAreaRight');
            let unicodeInput = textAreaLeft ? textAreaLeft.value : '';

            // --- ক্যারেক্টার ডেফিনিশন ---
            const bengaliConsonants = 'কখগঘঙচছজঝঞটঠডঢণতথদধনপফবভমযরলশষসহড়ঢ়য়';
            const unicodeIkar = '\u09BF'; // ি
            const unicodeEkar = '\u09C7'; // ে
            const unicodeOikar = '\u09C8'; // ৈ
            const unicodeOkar = '\u09CB'; // ো
            const unicodeOukar = '\u09CC'; // ৌ
            const unicodeAkar = '\u09BE'; // া
            const unicodeOuKarPart2 = '\u09D7'; // ৗ
            const unicodeHasanta = '\u09CD'; // ্
            const unicodeRefChar = '\u09B0\u09CD'; // র্ (র + হসন্ত)
            const unicodeJaPhala = '\u09CD\u09AF'; // ্য (হসন্ত + য)
            const unicodeRaPhala = '\u09CD\u09B0'; // ্র (হসন্ত + র)

            // --- প্রি-প্রসেসিং ধাপ ---

            // ধাপ ১: ও-কার এবং ঔ-কারকে তাদের উপাদান অংশে বিভক্ত করুন
            // এটি করা হয় যাতে 'ে' কারকে সঠিকভাবে আগে আনা যায়।
            // যেমন: কো -> ক + ে + া
            const consonantOrConjunct = `(?:(?:[${bengaliConsonants}]${unicodeHasanta})+[${bengaliConsonants}]|[${bengaliConsonants}])`;
            const o_ou_kar_regex = new RegExp(`(${consonantOrConjunct})(${unicodeOkar}|${unicodeOukar})`, 'g');
            unicodeInput = unicodeInput.replace(o_ou_kar_regex, (match, base, vowelSign) => {
                if (vowelSign === unicodeOkar) return base + unicodeEkar + unicodeAkar;
                if (vowelSign === unicodeOukar) return base + unicodeEkar + unicodeOuKarPart2;
                return match;
            });

            // ধাপ ২: বিজয় লেআউটের জন্য কার-চিহ্ন (ি, ে, ৈ) আগে আনুন
            // এই অংশটি রেফ, র-ফলা, য-ফলা সহ সকল যুক্তবর্ণের জন্য কাজ করবে।
            // যেমন: ক + ি -> ি + ক
            // যেমন: র্ + ক + ি -> ি + র্ + ক
            // যেমন: ক + ্র + ি -> ি + ক + ্র
            const precedingVowelRegex = new RegExp(`(${unicodeRefChar})?(${consonantOrConjunct})((?:${unicodeJaPhala}|${unicodeRaPhala})?)(${unicodeIkar}|${unicodeEkar}|${unicodeOikar})`, 'g');
            unicodeInput = unicodeInput.replace(precedingVowelRegex, (match, reph, base, phala, vowel) => {
                return vowel + (reph || '') + base + (phala || '');
            });
            
            // ধাপ ৩: মূল কনভার্সন লুপ
            let bijoyOutput = '';
            let k = 0;
            while (k < unicodeInput.length) {
                let foundMatch = false;

                // রেফ ('র্') এর জন্য বিশেষ হ্যান্ডলিং (যাতে © চিহ্নটি সঠিক জায়গায় বসে)
                if (unicodeInput.substring(k, k + 2) === unicodeRefChar) {
                    let baseCluster = '';
                    let clusterLen = 0;
                    // রেফের পরে দীর্ঘতম যুক্তবর্ণটি খুঁজুন
                    for (const key of sortedUnicodeKeys) {
                        if (key.length > 0 && unicodeInput.substring(k + 2, k + 2 + key.length) === key) {
                            baseCluster = key;
                            clusterLen = key.length;
                            break;
                        }
                    }
                    
                    if (clusterLen > 0) {
                        bijoyOutput += unicodeToBijoyMap[baseCluster] + '©';
                        k += 2 + clusterLen;
                        foundMatch = true;
                    }
                }

                // সাধারণ ম্যাপিং
                if (!foundMatch) {
                    for (const key of sortedUnicodeKeys) {
                        if (key.length > 0 && unicodeInput.substring(k, k + key.length) === key) {
                            bijoyOutput += unicodeToBijoyMap[key];
                            k += key.length;
                            foundMatch = true;
                            break;
                        }
                    }
                }

                // যদি কোনো ম্যাচ না পাওয়া যায়
                if (!foundMatch) {
                    bijoyOutput += unicodeInput[k];
                    k++;
                }
            }

            // ধাপ ৪: ম্যানুয়াল আনসি রিপ্লেসমেন্ট প্রয়োগ
            for (const [wrong, correct] of Object.entries(manualAnsiReplacements)) {
                if (wrong) { // খালি কী এড়িয়ে চলুন
                    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    bijoyOutput = bijoyOutput.replace(regex, correct);
                }
            }

            // ধাপ ৫: ব্যবহারকারীর অনুরোধ অনুযায়ী অতিরিক্ত রিপ্লেসমেন্ট (লাইনের শুরু এবং দাড়ির পর)
            // এটি শব্দের শুরুতে ভুল কার-চিহ্নকে সঠিক স্বরবর্ণে পরিবর্তন করে।
            // যেমন, একটি লাইন 'ে' (‡) দিয়ে শুরু হতে পারে না, এটি 'এ' (†) হওয়া উচিত।
            bijoyOutput = bijoyOutput.replace(/^‡/gm, '†'); // লাইনের শুরুতে
            bijoyOutput = bijoyOutput.replace(/\|‡/g, '|†');   // দাড়ির পরে

            // একই নিয়ম 'ৈ' (‰) এর ক্ষেত্রেও প্রযোজ্য, যা 'ঐ' (ˆ) হওয়া উচিত।
            bijoyOutput = bijoyOutput.replace(/^‰/gm, 'ˆ'); // লাইনের শুরুতে
            bijoyOutput = bijoyOutput.replace(/\|‰/g, '|ˆ');   // দাড়ির পরে

            if (textAreaRight) {
                textAreaRight.value = bijoyOutput;
                addState('textAreaRight');
            }
            
            // *** নতুন সংযোজন: স্বয়ংক্রিয়ভাবে ফিক্স ফাংশন কল করুন ***
            // showAlert প্যারামিটার false পাঠানো হয়েছে যাতে কোনো পপ-আপ বার্তা না আসে।
            fixAnsiText(false);
        }

// ====================================================================
        // START: UPDATED FUNCTION (বিজয় থেকে ইউনিকোড)
        // ====================================================================
        function convertRightToLeft() {
            const textAreaLeft = document.getElementById('textAreaLeft');
            const textAreaRight = document.getElementById('textAreaRight');
            let bijoyInput = textAreaRight ? textAreaRight.value : '';

            // ধাপ ০: প্রথমে fixAnsiText ফাংশন কল করুন
            // showAlert প্যারামিটার false পাঠানো হয়েছে যাতে কোনো পপ-আপ বার্তা না আসে।
            fixAnsiText(false); 
            bijoyInput = textAreaRight ? textAreaRight.value : ''; // ফিক্সড টেক্সট পুনরায় লোড করুন

            // --- ধাপ ১: বিজয় থেকে ইউনিকোড ম্যাপিং ---
            let unicodeOutput = '';
            let i = 0;
            while (i < bijoyInput.length) {
                let foundMatch = false;
                for (const key of sortedBijoyKeys) {
                    if (bijoyInput.substring(i, i + key.length) === key) {
                        unicodeOutput += bijoyToUnicodeMap[key];
                        i += key.length;
                        foundMatch = true;
                        break;
                    }
                }
                if (!foundMatch) {
                    unicodeOutput += bijoyInput[i];
                    i++;
                }
            }

            // --- ধাপ ২: ইউনিকোড ডোমেইনে পুনঃক্রম এবং সংমিশ্রণ ---

            // ধ্রুবকগুলি সংজ্ঞায়িত করুন
            const unicodeIkar = '\u09BF'; // ি
            const unicodeEkar = '\u09C7'; // ে
            const unicodeOikar = '\u09C8'; // ৈ
            const unicodeConsonants = '\\u0995-\\u09B9\\u09DC-\\u09DF';
            const unicodeHasanta = '\\u09CD';
            const unicodeRef = '\\u09B0' + unicodeHasanta;

            // ধাপ ২.১: রেফ (র্) পুনঃক্রম করুন
            const unicodeVowelSigns = '[\\u09BE-\\u09C4\\u09C7-\\u09C8\\u09CB-\\u09CC\\u09D7]'; // সকল কার-চিহ্ন
            const consonantCluster = `(?:[${unicodeConsonants}](?:${unicodeHasanta}[${unicodeConsonants}])*)`;
            const fullClusterWithVowel = `(${consonantCluster}(?:${unicodeVowelSigns})?)`;
            const robustRephReorder = new RegExp(`${fullClusterWithVowel}(${unicodeRef})`, 'g');
            unicodeOutput = unicodeOutput.replace(robustRephReorder, '$2$1');

            // ধাপ ২.২: প্রি-সিডিং কার-চিহ্ন (ি, ে, ৈ) সঠিক স্থানে আনুন 
            const consonantClusterPattern = `(?:${unicodeRef})?(?:[${unicodeConsonants}](?:${unicodeHasanta}[${unicodeConsonants}])*)`;
            const reorderRegex = new RegExp(`([${unicodeIkar}${unicodeEkar}${unicodeOikar}])(${consonantClusterPattern})`, 'g');
            unicodeOutput = unicodeOutput.replace(reorderRegex, '$2$1');

            // ধাপ ২.৩: ও-কার এবং ঔ-কার গঠন করুন
            const unicodeAkar = '\u09BE'; // া
            const unicodeOkar = '\u09CB'; // ো
            unicodeOutput = unicodeOutput.replace(new RegExp(`(${unicodeEkar})(${unicodeAkar})`, 'g'), unicodeOkar);

            const unicodeOuKarPart2 = '\u09D7'; // ৗ
            const unicodeOukar = '\u09CC'; // ৌ
            unicodeOutput = unicodeOutput.replace(new RegExp(`(${unicodeEkar})(${unicodeOuKarPart2})`, 'g'), unicodeOukar);


            // ধাপ ৩: ম্যানুয়াল ইউনিকোড রিপ্লেসমেন্ট প্রয়োগ (যদি প্রয়োজন হয়)
            for (const [wrong, correct] of Object.entries(manualUnicodeReplacements)) {
                if (wrong) {
                    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    unicodeOutput = unicodeOutput.replace(regex, correct);
                }
            }

            if (textAreaLeft) {
                textAreaLeft.value = unicodeOutput;
                addState('textAreaLeft');
            }
        }
        // ====================================================================
        // END: UPDATED FUNCTION
        // ====================================================================

        // ====================================================================
        // START: ANSI TEXT FIX FUNCTION (UPDATED FOR WORD LIST & SILENT MODE)
        // ====================================================================

        // এই লিস্টে যে শব্দগুলো যোগ করবেন, "ফিক্স করুন" বাটন সেগুলোকে পরিবর্তন করবে না।
        const wordsToIgnore = [
            '—M',
			"”P",
			"”T",
			"¯‘",
			"o–",
			"ÒQÓ",
			"ÒQ",
            // এখানে কমা দিয়ে আরও শব্দ যোগ করুন, যেমন: 'كلمة', 'word'
        ];

        // *** পরিবর্তিত ফাংশন: showAlert প্যারামিটার যোগ করা হয়েছে ***
        function fixAnsiText(showAlert = true) {
            const textAreaRight = document.getElementById('textAreaRight');
            if (!textAreaRight) return;

            let textToFix = textAreaRight.value;
            const placeholders = {};

            // ধাপ ০: লিস্টে থাকা শব্দগুলোকে সাময়িকভাবে প্লেসহোল্ডার দিয়ে প্রতিস্থাপন করুন
            wordsToIgnore.forEach((word, index) => {
                const placeholder = `___IGNORE_WORD_${index}___`;
                placeholders[placeholder] = word;
                const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                textToFix = textToFix.replace(regex, placeholder);
            });

            // ধাপ ১: বিজয় টেক্সটবক্সে ভুলবশত থাকা ইউনিকোড অক্ষরগুলিকে তাদের আনসি সমতুল্য দিয়ে প্রতিস্থাপন করুন।
            for (const key of sortedUnicodeKeys) {
                if (key.length > 0 && textToFix.includes(key)) {
                    const regex = new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    textToFix = textToFix.replace(regex, unicodeToBijoyMap[key]);
                }
            }

            // ধাপ ২: ম্যানুয়াল আনসি রিপ্লেসমেন্ট ম্যাপ প্রয়োগ করুন
            for (const [wrong, correct] of Object.entries(manualAnsiReplacements)) {
                if (wrong) {
                    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    textToFix = textToFix.replace(regex, correct);
                }
            }
            
            // ধাপ ৩: বিশেষ কেস হ্যান্ডলিং
            textToFix = textToFix.replace(/(^|\s|\|)‡/gm, '$1†');
            textToFix = textToFix.replace(/(^|\s|\|)‰/gm, '$1ˆ');

            // ধাপ ৪: প্লেসহোল্ডারগুলোকে আবার আসল শব্দ দিয়ে প্রতিস্থাপন করুন
            for (const placeholder in placeholders) {
                if (Object.hasOwnProperty.call(placeholders, placeholder)) {
                    const originalWord = placeholders[placeholder];
                    const regex = new RegExp(placeholder, 'g');
                    textToFix = textToFix.replace(regex, originalWord);
                }
            }

            textAreaRight.value = textToFix;
            addState('textAreaRight');
            
            // *** নতুন সংযোজন: শর্তসাপেক্ষে বার্তা দেখানো ***
            if (showAlert) {
                showCustomAlert('লেখা ফিক্স করা হয়েছে!');
            }
        }
        // ====================================================================
        // END: ANSI TEXT FIX FUNCTION
        // ====================================================================

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.select();
                element.setSelectionRange(0, 99999); // মোবাইল ডিভাইসের জন্য

                try {
                    document.execCommand('copy');
                    // অ্যালার্টের পরিবর্তে কাস্টম মেসেজ বক্স
                    showCustomAlert('আউটপুট কপি করা হয়েছে!');
                } catch (err) {
                    console.error('কপি করতে ব্যর্থ:', err);
                    showCustomAlert('কপি করতে ব্যর্থ হয়েছে। অনুগ্রহ করে ম্যানুয়ালি কপি করুন।');
                }
            }
        }
        // ====================================================================
        // START: NEW FILE UPLOAD SCRIPT FOR TEXT ASSISTANT
        // ====================================================================

        const fileUploadInput = document.getElementById('fileUploadInput');
        const filePreviewContainer = document.getElementById('filePreviewContainer');
        let uploadedFile = null; // আপলোড করা ফাইলের তথ্য সংরক্ষণ করতে

        if (fileUploadInput) {
            fileUploadInput.addEventListener('change', handleFileSelect);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // ফাইলের ধরন এবং আকার যাচাই করুন
            const allowedTypes = ['image/png', 'image/jpeg', 'image/webp', 'text/plain', 'audio/mpeg', 'audio/wav', 'video/mp4', 'video/webm'];
            if (!allowedTypes.includes(file.type)) {
                showCustomAlert('শুধুমাত্র ছবি, টেক্সট, অডিও, এবং ভিডিও ফাইল আপলোড করা যাবে।');
                fileUploadInput.value = ''; // ইনপুট রিসেট করুন
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedFile = {
                    name: file.name,
                    type: file.type,
                    base64: e.target.result.split(',')[1], // Base64 ডেটা পান
                    dataUrl: e.target.result // প্রিভিউ এর জন্য ডেটা URL
                };
                displayFilePreview();
            };
            reader.onerror = function() {
                showCustomAlert('ফাইলটি পড়তে একটি ত্রুটি হয়েছে।');
                uploadedFile = null;
            };
            reader.readAsDataURL(file);
        }

        function displayFilePreview() {
            if (!uploadedFile || !filePreviewContainer) return;

            filePreviewContainer.innerHTML = ''; // আগের প্রিভিউ পরিষ্কার করুন
            filePreviewContainer.classList.remove('hidden');

            const previewWrapper = document.createElement('div');
            previewWrapper.className = 'relative flex items-center gap-3 p-2';

            let previewElement;
            if (uploadedFile.type.startsWith('image/')) {
                previewElement = document.createElement('img');
                previewElement.src = uploadedFile.dataUrl;
            } else if (uploadedFile.type.startsWith('video/')) {
                previewElement = document.createElement('video');
                previewElement.src = uploadedFile.dataUrl;
                previewElement.controls = false; // কন্ট্রোল দেখাবেন না
            } else if (uploadedFile.type.startsWith('audio/')) {
                previewElement = document.createElement('div');
                previewElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`;
            } else { // টেক্সট বা অন্যান্য ফাইলের জন্য
                previewElement = document.createElement('div');
                previewElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>`;
            }

            if (previewElement.tagName === 'IMG' || previewElement.tagName === 'VIDEO') {
                previewElement.className = 'w-16 h-16 object-cover rounded-lg';
            }


            const fileInfo = document.createElement('div');
            fileInfo.className = 'file-info';
            fileInfo.textContent = uploadedFile.name;

            const removeBtn = document.createElement('button');
            removeBtn.id = 'removeFileBtn';
            removeBtn.innerHTML = '&times;';
            removeBtn.title = 'ফাইল সরান';
            removeBtn.onclick = removeFile;

            previewWrapper.appendChild(removeBtn);
            previewWrapper.appendChild(previewElement);
            previewWrapper.appendChild(fileInfo);
            filePreviewContainer.appendChild(previewWrapper);
        }

        function removeFile() {
            uploadedFile = null;
            fileUploadInput.value = ''; // ফাইল ইনপুট রিসেট করুন
            filePreviewContainer.innerHTML = '';
            filePreviewContainer.classList.add('hidden');
        }

        // চ্যাট উইন্ডোতে ফাইলসহ বার্তা যোগ করার জন্য ফাংশন আপডেট করুন
        function addMessageToChat(text, sender, file = null) {
            const chatWindow = document.getElementById('chatWindow');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);

            const textElement = document.createElement('p');
            textElement.innerText = text;
            messageElement.appendChild(textElement);

            if (file && file.type.startsWith('image/')) {
                const imgElement = document.createElement('img');
                imgElement.src = file.dataUrl;
                messageElement.appendChild(imgElement);
            }

            if (chatWindow) {
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
        }
		
        // --- গুগল ম্যাপ ফিচার ---
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const myLocationBtn = document.getElementById('myLocationBtn');
        const directionsFrom = document.getElementById('directionsFrom');
        const directionsTo = document.getElementById('directionsTo');
        const directionsBtn = document.getElementById('directionsBtn');

        // 1. স্থান খোঁজার জন্য ইভেন্ট লিসেনার
        if (searchBtn) {
            searchBtn.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
                    window.open(url, '_blank');
                } else {
                    showCustomAlert('অনুগ্রহ করে খোঁজার জন্য একটি স্থানের নাম লিখুন।');
                }
            });
             // Enter চেপে সার্চ করার সুবিধা
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });
        }

        // 2. আমার অবস্থানের জন্য ইভেন্ট লিসেনার
        if (myLocationBtn) {
            myLocationBtn.addEventListener('click', () => {
                // এই URLটি গুগল ম্যাপকে ব্যবহারকারীর বর্তমান অবস্থান খুঁজতে বলবে
                const url = 'https://www.google.com/maps/search/My+Location';
                window.open(url, '_blank');
            });
        }

        // 3. দিকনির্দেশনার জন্য ইভেন্ট লিসেনার
        if (directionsBtn) {
            directionsBtn.addEventListener('click', () => {
                const origin = directionsFrom.value.trim();
                const destination = directionsTo.value.trim();
                if (origin && destination) {
                    const url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}`;
                    window.open(url, '_blank');
                } else {
                    showCustomAlert('অনুগ্রহ করে শুরু এবং গন্তব্য উভয় স্থান লিখুন।');
                }
            });
            // Enter চেপে দিকনির্দেশনা খোঁজার সুবিধা
            directionsTo.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    directionsBtn.click();
                }
            });
             directionsFrom.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    directionsBtn.click();
                }
            });
        }
    });

// নতুন: নামাজের সময়সূচি ট্যাব এর জন্য ফাংশন (API ইন্টিগ্রেশন এবং লোকাল স্টোরেজ সহ)
function initializePrayerTimeTab() {
    const districtSelect = document.getElementById('district-select');
    const prayerTimeDate = document.getElementById('prayerTimeDate');
    const manualTimeToggle = document.getElementById('manualTimeToggle');
    const manualTimeInputsContainer = document.getElementById('manualTimeInputs');

    // ম্যানুয়াল ইনপুট ক্ষেত্র
    const manualInputs = {
        sehri: document.getElementById('manualSehri'),
        fajr: document.getElementById('manualFajr'),
        dhuhr: document.getElementById('manualDhuhr'),
        asr: document.getElementById('manualAsr'),
        iftar: document.getElementById('manualIftar'),
        isha: document.getElementById('manualIsha')
    };

    if (!districtSelect || !manualTimeToggle || !manualTimeInputsContainer) return;

    // API কলের জন্য বাংলা জেলার নামের সাথে ইংরেজি নামের ম্যাপিং
    const districtMap = {
        "ঢাকা": "Dhaka", "গাইবান্ধা": "Gaibandha", "বরগুনা": "Barguna", "বরিশাল": "Barisal", "ভোলা": "Bhola", "ঝালকাঠি": "Jhalokati", "পটুয়াখালী": "Patuakhali", "পিরোজপুর": "Pirojpur",
        "বান্দরবান": "Bandarban", "ব্রাহ্মণবাড়িয়া": "Brahmanbaria", "চাঁদপুর": "Chandpur", "চট্টগ্রাম": "Chattogram", "কুমিল্লা": "Cumilla", "কক্সবাজার": "Cox's Bazar", "ফেনী": "Feni", "খাগড়াছড়ি": "Khagrachhari", "লক্ষ্মীপুর": "Lakshmipur", "নোয়াখালী": "Noakhali", "রাঙ্গামাটি": "Rangamati",
        "ফরিদপুর": "Faridpur", "গাজীপুর": "Gazipur", "গোপালগঞ্জ": "Gopalganj", "কিশোরগঞ্জ": "Kishoreganj", "মাদারীপুর": "Madaripur", "মানিকগঞ্জ": "Manikganj", "মুন্সিগঞ্জ": "Munshiganj", "নারায়ণগঞ্জ": "Narayanganj", "নরসিংদী": "Narsingdi", "রাজবাড়ী": "Rajbari", "শরীয়তপুর": "Shariatpur", "টাঙ্গাইল": "Tangail",
        "বাগেরহাট": "Bagerhat", "চুয়াডাঙ্গা": "Chuadanga", "যশোর": "Jashore", "ঝিনাইদহ": "Jhenaidah", "খুলনা": "Khulna", "কুষ্টিয়া": "Kushtia", "মাগুরা": "Magura", "মেহেরপুর": "Meherpur", "নড়াইল": "Narail", "সাতক্ষীরা": "Satkhira",
        "জামালপুর": "Jamalpur", "ময়মনসিংহ": "Mymensingh", "নেত্রকোনা": "Netrokona", "শেরপুর": "Sherpur",
        "বগুড়া": "Bogura", "জয়পুরহাট": "Joypurhat", "নওগাঁ": "Naogaon", "নাটোর": "Natore", "চাঁপাইনবাবগঞ্জ": "Chapainawabganj", "পাবনা": "Pabna", "রাজশাহী": "Rajshahi", "সিরাজগঞ্জ": "Sirajganj",
        "দিনাজপুর": "Dinajpur", "কুড়িগ্রাম": "Kurigram", "লালমনিরহাট": "Lalmonirhat", "নীলফামারী": "Nilphamari", "পঞ্চগড়": "Panchagarh", "রংপুর": "Rangpur", "ঠাকুরগাঁও": "Thakurgaon",
        "হবিগঞ্জ": "Habiganj", "মৌলভীবাজার": "Moulvibazar", "সুনামগঞ্জ": "Sunamganj", "সিলেট": "Sylhet"
    };

    // ====================================================================
    // START: সেটিংস সেভ এবং লোড করার ফাংশন
    // ====================================================================

    // সকল সেটিংস লোকাল স্টোরেজে সেভ করার ফাংশন
    const saveSettings = () => {
        const settings = {
            isManual: manualTimeToggle.checked,
            district: districtSelect.value,
            manualTimes: {
                sehri: manualInputs.sehri.value,
                fajr: manualInputs.fajr.value,
                dhuhr: manualInputs.dhuhr.value,
                asr: manualInputs.asr.value,
                iftar: manualInputs.iftar.value,
                isha: manualInputs.isha.value,
            }
        };
        localStorage.setItem('prayerTimeSettings', JSON.stringify(settings));
        console.log('সেটিংস সেভ করা হয়েছে:', settings);
    };

    // লোকাল স্টোরেজ থেকে সেটিংস লোড করার ফাংশন
    const loadSettings = () => {
        const savedSettings = localStorage.getItem('prayerTimeSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            console.log('সেটিংস লোড করা হয়েছে:', settings);

            // টগল অবস্থা পুনরুদ্ধার করুন
            manualTimeToggle.checked = settings.isManual;

            // জেলা নির্বাচন পুনরুদ্ধার করুন
            if (settings.district) {
                // জেলা ড্রপডাউন লোড হওয়ার জন্য একটু অপেক্ষা করুন
                setTimeout(() => {
                    districtSelect.value = settings.district;
                }, 100);
            }

            // ম্যানুয়াল সময় পুনরুদ্ধার করুন
            if (settings.manualTimes) {
                manualInputs.sehri.value = settings.manualTimes.sehri || '04:00';
                manualInputs.fajr.value = settings.manualTimes.fajr || '04:10';
                manualInputs.dhuhr.value = settings.manualTimes.dhuhr || '12:00';
                manualInputs.asr.value = settings.manualTimes.asr || '16:30';
                manualInputs.iftar.value = settings.manualTimes.iftar || '18:45';
                manualInputs.isha.value = settings.manualTimes.isha || '20:00';
            }
        }
    };

    // ====================================================================
    // END: সেটিংস সেভ এবং লোড করার ফাংশন
    // ====================================================================

    // 24-ঘণ্টার সময়কে 12-ঘণ্টার ফরম্যাটে রূপান্তর করার ফাংশন
    function formatTo12Hour(time24) {
        if (!time24 || typeof time24 !== 'string') return '--:--';
        const [hour, minute] = time24.split(':').map(Number);
        const period = hour >= 12 ? 'PM' : 'AM';
        const hour12 = hour % 12 || 12;
        return `${hour12.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')} ${period}`;
    }

    // ম্যানুয়াল সময় প্রদর্শন করার ফাংশন
    function displayManualTimes() {
        document.getElementById('sehri-time').textContent = formatTo12Hour(manualInputs.sehri.value);
        document.getElementById('fajr-time').textContent = formatTo12Hour(manualInputs.fajr.value);
        document.getElementById('dhuhr-time').textContent = formatTo12Hour(manualInputs.dhuhr.value);
        document.getElementById('asr-time').textContent = formatTo12Hour(manualInputs.asr.value);
        document.getElementById('iftar-time').textContent = formatTo12Hour(manualInputs.iftar.value);
        document.getElementById('isha-time').textContent = formatTo12Hour(manualInputs.isha.value);
        districtSelect.disabled = true;
    }

    // API থেকে ডেটা নিয়ে আসার এবং প্রদর্শনের ফাংশন
    async function fetchAndDisplayPrayerTimes(district) {
        const prayerTimesP = document.querySelectorAll('.prayer-times-grid p');
        prayerTimesP.forEach(p => p.textContent = 'লোড হচ্ছে...');
        districtSelect.disabled = false;

        const englishDistrict = districtMap[district];
        if (!englishDistrict) {
            prayerTimesP.forEach(p => p.textContent = 'ত্রুটি');
            showCustomAlert('জেলা খুঁজে পাওয়া যায়নি।');
            return;
        }

        const today = new Date();
        const dateString = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
        const url = `https://api.aladhan.com/v1/timingsByCity/${dateString}?city=${englishDistrict}&country=Bangladesh&method=1`;

        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`API থেকে সাড়া পাওয়া যায়নি (স্ট্যাটাস: ${response.status})`);
            const data = await response.json();

            if (data.code === 200) {
                const times = data.data.timings;
                const [fajrHour, fajrMinute] = times.Fajr.split(':').map(Number);
                const fajrDate = new Date();
                fajrDate.setHours(fajrHour, fajrMinute, 0, 0);
                fajrDate.setMinutes(fajrDate.getMinutes() - 10);
                const sehriTime24 = `${fajrDate.getHours().toString().padStart(2, '0')}:${fajrDate.getMinutes().toString().padStart(2, '0')}`;

                document.getElementById('sehri-time').textContent = formatTo12Hour(sehriTime24);
                document.getElementById('fajr-time').textContent = formatTo12Hour(times.Fajr);
                document.getElementById('dhuhr-time').textContent = formatTo12Hour(times.Dhuhr);
                document.getElementById('asr-time').textContent = formatTo12Hour(times.Asr);
                document.getElementById('iftar-time').textContent = formatTo12Hour(times.Maghrib);
                document.getElementById('isha-time').textContent = formatTo12Hour(times.Isha);
            } else {
                throw new Error('API থেকে ডেটা সঠিকভাবে আসেনি।');
            }
        } catch (error) {
            console.error('Prayer Times Error:', error);
            prayerTimesP.forEach(p => p.textContent = 'ব্যর্থ');
            showCustomAlert(`সময় আনতে সমস্যা হয়েছে: ${error.message}`);
        }
    }

    // টগল সুইচের পরিবর্তন হ্যান্ডেল করুন
    manualTimeToggle.addEventListener('change', () => {
        if (manualTimeToggle.checked) {
            manualTimeInputsContainer.classList.remove('hidden');
            displayManualTimes();
        } else {
            manualTimeInputsContainer.classList.add('hidden');
            fetchAndDisplayPrayerTimes(districtSelect.value);
        }
        saveSettings(); // পরিবর্তন সেভ করুন
    });

    // ম্যানুয়াল ইনপুট পরিবর্তন হলে সময় আপডেট এবং সেভ করুন
    Object.values(manualInputs).forEach(input => {
        input.addEventListener('input', () => {
            if (manualTimeToggle.checked) {
                displayManualTimes();
            }
            saveSettings(); // পরিবর্তন সেভ করুন
        });
    });

    // জেলা পরিবর্তন হলে সময় আপডেট এবং সেভ করুন
    districtSelect.addEventListener('change', (e) => {
        if (!manualTimeToggle.checked) {
            fetchAndDisplayPrayerTimes(e.target.value);
        }
        saveSettings(); // পরিবর্তন সেভ করুন
    });

    // ড্রপডাউন এ জেলার নাম যোগ করা
    if (districtSelect.options.length <= 1) {
        Object.keys(districtMap).forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
        });
    }

    // --- মূল التنفيذ লজিক ---
    loadSettings(); // প্রথমে সেভ করা সেটিংস লোড করুন

    // লোড করা সেটিংসের উপর ভিত্তি করে প্রাথমিক অবস্থা নির্ধারণ করুন
    if (manualTimeToggle.checked) {
        manualTimeInputsContainer.classList.remove('hidden');
        displayManualTimes();
    } else {
        manualTimeInputsContainer.classList.add('hidden');
        fetchAndDisplayPrayerTimes(districtSelect.value || "ঢাকা");
    }

    // আজকের তারিখ প্রদর্শন
    const today = new Date();
    prayerTimeDate.textContent = today.toLocaleDateString('bn-BD', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

    // যখন নামাজের সময়সূচি ট্যাব ক্লিক করা হবে, তখন এই ফাংশনটি চালু হবে
    document.getElementById('prayerTimeTab')?.addEventListener('click', initializePrayerTimeTab);
    
    // 페이지 로드 시 기도 시간 탭이 활성화되어 있으면 초기화
    if (document.getElementById('prayerTimeContent')?.classList.contains('active')) {
        initializePrayerTimeTab();
    }

        // জেমিনিকে জিজ্ঞাসা করার ফাংশন আপডেট করুন
        async function handleAskGemini() {
            const assistantInput = document.getElementById('assistantInput');
            const assistantLoading = document.getElementById('assistantLoading');
            const askGeminiBtn = document.getElementById('askGeminiBtn');
            const chatWindow = document.getElementById('chatWindow');
            let chatHistory = window.chatHistory || [];

            const promptText = assistantInput.value.trim();
            if (!promptText && !uploadedFile) return;

            // ব্যবহারকারীর বার্তা প্রদর্শন করুন
            addMessageToChat(promptText, 'user', uploadedFile);
            assistantInput.value = '';

            let userParts = [];
            if (promptText) {
                userParts.push({
                    text: promptText
                });
            }
            if (uploadedFile) {
                userParts.push({
                    inlineData: {
                        mimeType: uploadedFile.type,
                        data: uploadedFile.base64
                    }
                });
            }

            chatHistory.push({
                role: "user",
                parts: userParts
            });
            window.chatHistory = chatHistory;

            // ফাইল পাঠানোর পর প্রিভিউ সরিয়ে ফেলুন
            removeFile();

            if (assistantLoading) assistantLoading.style.display = 'block';
            if (askGeminiBtn) askGeminiBtn.disabled = true;

            try {
                const apiKey = localStorage.getItem('geminiApiKey');
                if (!apiKey) {
                    addMessageToChat('জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।', 'gemini-error');
                    return;
                }

                const payload = {
                    contents: chatHistory
                };
                const model = "gemini-2.5-flash-preview-05-20";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                let geminiText;

                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                    geminiText = result.candidates[0].content.parts[0].text;
                    chatHistory.push({
                        role: "model",
                        parts: [{
                            text: geminiText
                        }]
                    });
                    window.chatHistory = chatHistory;
                } else {
                    geminiText = 'দুঃখিত, আমি কোনো উত্তর খুঁজে পাইনি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                    console.error('API Response Error:', result);
                }
                addMessageToChat(geminiText, 'gemini');

            } catch (error) {
                const errorMessage = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                addMessageToChat(errorMessage, 'gemini-error');
                console.error('API Call Error:', error);
            } finally {
                if (assistantLoading) assistantLoading.style.display = 'none';
                if (askGeminiBtn) askGeminiBtn.disabled = false;
            }
        }
        // ====================================================================
        // END: NEW FILE UPLOAD SCRIPT
        // ====================================================================

// ====================================================================
// START: UNIT CONVERTER (MEASUREMENT) SCRIPT (CORRECTED)
// ====================================================================
function initializeUnitConverters() {
    // শুধুমাত্র পরিমাপ সেকশনের ভেতরের ইনপুট ও সিলেক্ট এলিমেন্টগুলোই ধরবে
    const unitInputs = document.querySelectorAll('#measurementContent .unit-input');
    const unitSelects = document.querySelectorAll('#measurementContent .unit-select');

    const factors = {
        length: { // base: meter
            meter: 1,
            kilometer: 1000,
            centimeter: 0.01,
            millimeter: 0.001,
            mile: 1609.34,
            yard: 0.9144,
            foot: 0.3048,
            inch: 0.0254
        },
        weight: { // base: gram
            gram: 1,
            kilogram: 1000,
            milligram: 0.001,
            tonne: 1000000,
            pound: 453.592,
            ounce: 28.3495
        },
        area: { // base: square meter
            sq_meter: 1,
            sq_kilometer: 1000000,
            sq_foot: 0.092903,
            sq_inch: 0.00064516,
            hectare: 10000,
            acre: 4046.86,
            bigha: 1337.8, // Approximate value for Bangladesh
            katha: 66.89, // 1 Bigha = 20 Katha
            shotok: 40.4686 // 1 Acre = 100 Shotok
        }
    };

    function performConversion(sourceElement) {
        if (!sourceElement) return;

        const converterType = sourceElement.dataset.converter.replace('_rev', '');
        const isReverse = sourceElement.dataset.converter.includes('_rev');

        // সোর্স এবং টার্গেট এলিমেন্টগুলো শনাক্ত করুন
        const fromValueEl = document.getElementById(`${converterType}FromValue`);
        const fromUnitEl = document.getElementById(`${converterType}FromUnit`);
        const toValueEl = document.getElementById(`${converterType}ToValue`);
        const toUnitEl = document.getElementById(`${converterType}ToUnit`);

        const sourceValueEl = isReverse ? toValueEl : fromValueEl;
        const sourceUnitEl = isReverse ? toUnitEl : fromUnitEl;
        const targetValueEl = isReverse ? fromValueEl : toValueEl;
        const targetUnitEl = isReverse ? fromUnitEl : toUnitEl;

        const sourceValue = parseFloat(sourceValueEl.value);
        
        if (isNaN(sourceValue)) {
            targetValueEl.value = '';
            return;
        }

        const fromUnit = sourceUnitEl.value;
        const toUnit = targetUnitEl.value;
        let result;

        if (converterType === 'temperature') {
            // তাপমাত্রা রূপান্তরের লজিক
            if (fromUnit === toUnit) {
                result = sourceValue;
            } else if (fromUnit === 'celsius') {
                result = toUnit === 'fahrenheit' ? (sourceValue * 9 / 5) + 32 : sourceValue + 273.15;
            } else if (fromUnit === 'fahrenheit') {
                result = toUnit === 'celsius' ? (sourceValue - 32) * 5 / 9 : ((sourceValue - 32) * 5 / 9) + 273.15;
            } else if (fromUnit === 'kelvin') {
                result = toUnit === 'celsius' ? sourceValue - 273.15 : ((sourceValue - 273.15) * 9 / 5) + 32;
            }
        } else {
            // ফ্যাক্টর-ভিত্তিক রূপান্তরের লজিক
            const conversionFactors = factors[converterType];
            const valueInBaseUnit = sourceValue * conversionFactors[fromUnit];
            result = valueInBaseUnit / conversionFactors[toUnit];
        }

        // একটি নির্দিষ্ট দশমিক স্থান পর্যন্ত ফলাফল প্রদর্শন করুন
        targetValueEl.value = Number(result.toFixed(6));
    }

    unitInputs.forEach(input => {
        input.addEventListener('input', (e) => {
            performConversion(e.target);
        });
    });

    unitSelects.forEach(select => {
        select.addEventListener('change', (e) => {
            // কোন ইনপুটটি সোর্স হিসেবে ব্যবহৃত হবে তা নির্ধারণ করুন
            const converterType = e.target.dataset.converter;
            const fromValueEl = document.getElementById(`${converterType}FromValue`);
            // যখন ইউনিট পরিবর্তন হয়, তখন সবসময় 'From' ফিল্ড থেকে গণনা শুরু করুন
            performConversion(fromValueEl);
        });
    });

    // পেজ লোড হওয়ার সাথে সাথে সকল কনভার্টার চালু করুন
    ['length', 'weight', 'area', 'temperature'].forEach(type => {
        const fromValueEl = document.getElementById(`${type}FromValue`);
        if(fromValueEl) {
             performConversion(fromValueEl);
        }
    });
}
// ====================================================================
// END: UNIT CONVERTER (MEASUREMENT) SCRIPT (CORRECTED)
// ====================================================================

		// কাস্টম অ্যালার্ট বক্স বাস্তবায়ন New
		function showCustomAlert(message) {
		const alertBox = document.createElement('div');
		alertBox.classList.add(
        'fixed', 'top-1/2', 'left-1/2', 'transform', '-translate-x-1/2', '-translate-y-1/2',
        'bg-gray-800', 'text-white', 'p-4', 'rounded-lg', 'shadow-2xl',
        'z-50', 'text-lg', 'transition-all', 'duration-100', 'ease-in-out',
        'scale-75', 'opacity-0'
    );
		alertBox.textContent = message;
		document.body.appendChild(alertBox);

    // ফেড-ইন এবং স্কেল-ইন
		setTimeout(() => {
        alertBox.classList.remove('scale-75', 'opacity-0');
        alertBox.classList.add('scale-100', 'opacity-100');
		}, 10);

    // 3 সেকেন্ড পর ফেড-আউট এবং সরান
		setTimeout(() => {
        alertBox.classList.remove('scale-100', 'opacity-100');
        setTimeout(() => alertBox.remove(), 100);
		}, 2000);
	}

        // টেক্সটএরিয়াগুলির জন্য আনডু/রিডু ইতিহাস
        let historyLeft = [];
        let historyIndexLeft = -1;
        let historyRight = [];
        let historyIndexRight = -1;

        function addState(textareaId) {
            const textarea = document.getElementById(textareaId);
            let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
            let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

            // যদি আমরা ইতিহাসের শেষে না থাকি, তবে পরবর্তী স্টেটগুলি পরিষ্কার করুন
            if (historyIndex < history.length - 1) {
                history.splice(historyIndex + 1);
            }

            history.push(textarea.value);
            historyIndex = history.length - 1;

            if (textareaId === 'textAreaLeft') {
                historyLeft = history;
                historyIndexLeft = historyIndex;
            } else {
                historyRight = history;
                historyIndexRight = historyIndex;
            }
            updateButtonStates(textareaId);
        }

        function undoText(textareaId) {
            const textarea = document.getElementById(textareaId);
            let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
            let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

            if (historyIndex > 0) {
                historyIndex--;
                textarea.value = history[historyIndex];
            }

            if (textareaId === 'textAreaLeft') {
                historyIndexLeft = historyIndex;
            } else {
                historyIndexRight = historyIndex;
            }
            updateButtonStates(textareaId);
        }

        function redoText(textareaId) {
            const textarea = document.getElementById(textareaId);
            let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
            let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

            if (historyIndex < history.length - 1) {
                historyIndex++;
                textarea.value = history[historyIndex];
            }

            if (textareaId === 'textAreaLeft') {
                historyIndexLeft = historyIndex;
            } else {
                historyIndexRight = historyIndex;
            }
            updateButtonStates(textareaId);
        }

        function clearTextarea(textareaId) {
            const textarea = document.getElementById(textareaId);
            if (textarea) {
                textarea.value = '';
                addState(textareaId); // এই ক্লিয়ার অ্যাকশনটি ইতিহাসে যোগ করুন
            }
        }

        function clearAllTextareas() {
            clearTextarea('textAreaLeft');
            clearTextarea('textAreaRight');
        }

        function updateButtonStates(textareaId) {
            let undoBtn = document.getElementById(textareaId === 'textAreaLeft' ? 'undoButtonLeft' : 'undoButtonRight');
            let redoBtn = document.getElementById(textareaId === 'textAreaLeft' ? 'redoButtonLeft' : 'redoButtonRight');
            let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
            let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

            if (undoBtn) undoBtn.disabled = historyIndex <= 0;
            if (redoBtn) redoBtn.disabled = historyIndex >= history.length - 1;
        }


        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded ইভেন্ট চালু হয়েছে। স্ক্রিপ্ট চলছে।');
            try {
                // --- ট্যাব পরিবর্তন লজিক ---
				//এখানে নতুন ট্যাবের নামটি যুক্ত করতে হয়। এখানে ট্যাব যুক্ত করা অনুযায়ী ট্যাব সাজানো থাকবে।
                const basicCalcTab = document.getElementById('basicCalcTab');
                const ageCalcTab = document.getElementById('ageCalcTab');
                const dateCalcTab = document.getElementById('dateCalcTab');
                const scientificCalcTab = document.getElementById('scientificCalcTab');
                const newsTab = document.getElementById('newsTab');
                const converterTab = document.getElementById('converterTab');
                const measurementTab = document.getElementById('measurementTab'); // Add this line
                const textAssistantTab = document.getElementById('textAssistantTab');
                const allFeaturesTab = document.getElementById('allFeaturesTab');
                const setApiKeyBtn = document.getElementById('setApiKeyBtn');
                const spellCheckTab = document.getElementById('spellCheckTab');
                const textBeautifierTab = document.getElementById('textBeautifierTab');
                const wordMeaningTab = document.getElementById('wordMeaningTab');
                const ttsTab = document.getElementById('ttsTab'); // TTS ট্যাব
                const sttTab = document.getElementById('sttTab'); // STT ট্যাব
				const typingTestTab = document.getElementById('typingTestTab'); // এই লাইনটি যোগ করুন
                const basicCalculatorContent = document.getElementById('basicCalculatorContent');
                const ageCalculatorContent = document.getElementById('ageCalculatorContent');
                const dateCalculatorContent = document.getElementById('dateCalculatorContent');
                const scientificCalculatorContent = document.getElementById('scientificCalculatorContent');
                const newsContent = document.getElementById('newsContent');
                const converterContent = document.getElementById('converterContent');
                const measurementContent = document.getElementById('measurementContent'); // Add this line
                const textAssistantContent = document.getElementById('textAssistantContent');
                const allFeaturesContent = document.getElementById('allFeaturesContent');
                const spellCheckerContent = document.getElementById('spellCheckerContent');
                const textBeautifierContent = document.getElementById('textBeautifierContent');
                const wordMeaningContent = document.getElementById('wordMeaningContent');
                const textToSpeechContent = document.getElementById('textToSpeechContent'); // TTS কন্টেন্ট
                const speechToTextContent = document.getElementById('speechToTextContent'); // STT কন্টেন্ট
				const mapTab = document.getElementById('mapTab');
				const mapContent = document.getElementById('mapContent');
				const prayerTimeTab = document.getElementById('prayerTimeTab'); // এই লাইনটি যুক্ত করুন
				const prayerTimeContent = document.getElementById('prayerTimeContent'); // এই লাইনটি যুক্ত করুন


//pest button code start
// প্রিসেট ড্রপডাউন এবং মোডাল এর উপাদানগুলো সিলেক্ট করুন
const presetButtonLeft = document.getElementById('presetButtonLeft');
const dropdownMenuLeft = document.getElementById('dropdownMenuLeft');
const presetButtonRight = document.getElementById('presetButtonRight');
const dropdownMenuRight = document.getElementById('dropdownMenuRight');
const customPresetModal = document.getElementById('customPresetModal');
const customModalTitle = document.getElementById('customModalTitle');
const customModalDesc = document.getElementById('customModalDesc');
const customPresetInput = document.getElementById('customPresetInput');
const saveCustomPresetBtn = document.getElementById('saveCustomPresetBtn');
const cancelCustomPresetBtn = document.getElementById('cancelCustomPresetBtn');

// ড্রপডাউন খোলা এবং বন্ধ করার জন্য ফাংশন
const toggleDropdown = (button, menu) => {
    menu.classList.toggle('hidden');
    button.classList.toggle('open');
};

if (presetButtonLeft) {
    presetButtonLeft.addEventListener('click', (e) => {
        e.stopPropagation(); // পেজ-জুড়ে ক্লিক ইভেন্ট প্রতিরোধ করতে
        toggleDropdown(presetButtonLeft, dropdownMenuLeft);
        dropdownMenuRight.classList.add('hidden'); // অন্য ড্রপডাউন বন্ধ করুন
        presetButtonRight.classList.remove('open');
    });
}

if (presetButtonRight) {
    presetButtonRight.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleDropdown(presetButtonRight, dropdownMenuRight);
        dropdownMenuLeft.classList.add('hidden'); // অন্য ড্রপডাউন বন্ধ করুন
        presetButtonLeft.classList.remove('open');
    });
}

// প্রিসেট নির্বাচন হ্যান্ডেল করার জন্য ফাংশন
const handlePresetSelection = (event, side) => {
    event.preventDefault();
    const presetValue = event.target.dataset.preset;
    const presetText = event.target.textContent.trim();

    if (presetValue === 'custom' || presetValue === 'custom-serial') {
        currentModalSide = side;
        currentModalPreset = presetValue;
        
        // মোডাল কনফিগার করুন এবং দেখান
        customModalTitle.textContent = presetValue === 'custom' ? 'কাস্টম প্রিসেট' : 'সিরিয়ালসহ কাস্টম প্রিসেট';
        customModalDesc.textContent = presetValue === 'custom' 
            ? 'প্রতিবার পেস্ট করার আগে যে টেক্সট যুক্ত করতে চান তা লিখুন।'
            : 'এখানে আপনার টেক্সট লিখুন। সিরিয়াল নম্বরের জন্য {serial} ব্যবহার করুন (যেমন: Step {serial}:)।';
        
        const currentCustomValue = (side === 'left') ? customPasteValueLeft : customPasteValueRight;
        customPresetInput.value = currentCustomValue;
        
        customPresetModal.classList.remove('hidden');
    } else {
        // নির্বাচিত প্রিসেট অনুযায়ী ভেরিয়েবল এবং বাটনের লেখা আপডেট করুন
        if (side === 'left') {
            pastePresetLeft = presetValue;
            presetButtonLeft.childNodes[0].nodeValue = `${presetText} `;
        } else {
            pastePresetRight = presetValue;
            presetButtonRight.childNodes[0].nodeValue = `${presetText} `;
        }
    }
    
    // ড্রপডাউন বন্ধ করুন
    const dropdown = (side === 'left') ? dropdownMenuLeft : dropdownMenuRight;
    const button = (side === 'left') ? presetButtonLeft : presetButtonRight;
    dropdown.classList.add('hidden');
    button.classList.remove('open');
};

// সমস্ত ড্রপডাউন আইটেমের জন্য ইভেন্ট লিসেনার যুক্ত করুন
document.querySelectorAll('#dropdownMenuLeft a').forEach(item => {
    item.addEventListener('click', (e) => handlePresetSelection(e, 'left'));
});
document.querySelectorAll('#dropdownMenuRight a').forEach(item => {
    item.addEventListener('click', (e) => handlePresetSelection(e, 'right'));
});

// মোডাল বাটনের জন্য লিসেনার
if (saveCustomPresetBtn) {
    saveCustomPresetBtn.addEventListener('click', () => {
        const customValue = customPresetInput.value;
        if (currentModalSide === 'left') {
            pastePresetLeft = currentModalPreset;
            customPasteValueLeft = customValue;
            presetButtonLeft.childNodes[0].nodeValue = 'কাস্টম প্রিসেট ';
        } else {
            pastePresetRight = currentModalPreset;
            customPasteValueRight = customValue;
            presetButtonRight.childNodes[0].nodeValue = 'কাস্টম প্রিসেট ';
        }
        customPresetModal.classList.add('hidden');
    });
}

if (cancelCustomPresetBtn) {
    cancelCustomPresetBtn.addEventListener('click', () => {
        customPresetModal.classList.add('hidden');
    });
}

// বাইরে ক্লিক করলে ড্রপডাউন বন্ধ করার জন্য
window.addEventListener('click', () => {
    if (!dropdownMenuLeft.classList.contains('hidden')) {
        dropdownMenuLeft.classList.add('hidden');
        presetButtonLeft.classList.remove('open');
    }
    if (!dropdownMenuRight.classList.contains('hidden')) {
        dropdownMenuRight.classList.add('hidden');
        presetButtonRight.classList.remove('open');
    }
});

//paste button code end


                // API কী মডেল উপাদান
                const apiKeyModal = document.getElementById('apiKeyModal');
                const apiKeyInput = document.getElementById('apiKeyInput');
                const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
                const cancelApiKeyBtn = document.getElementById('cancelApiKeyBtn');
                const apiKeyMessage = document.getElementById('apiKeyMessage');

                // নিশ্চিত করুন যে সমস্ত DOM উপাদান সঠিকভাবে নির্বাচিত হয়েছে
                console.log('basicCalcTab:', basicCalcTab);
                console.log('setApiKeyBtn:', setApiKeyBtn);
                console.log('apiKeyModal:', apiKeyModal);

                // প্রাথমিক ট্যাব প্রদর্শন
                showTab('converter'); // লোডে মৌলিক ক্যালকুলেটরকে সক্রিয় হিসাবে সেট করুন

                // API কী বোতামের স্টাইল আপডেট করার ফাংশন
                function updateApiKeyButton() {
                    if (setApiKeyBtn) {
                        const apiKey = localStorage.getItem('geminiApiKey');
                        if (apiKey) {
                            setApiKeyBtn.style.backgroundColor = '#28a745'; // সবুজ
                            setApiKeyBtn.style.color = 'white';
                            setApiKeyBtn.innerText = 'API কী সেট করা আছে';
                        } else {
                            setApiKeyBtn.style.backgroundColor = '#ef5350'; // লাল
                            setApiKeyBtn.style.color = 'white';
                            setApiKeyBtn.innerText = 'API কী সেট করুন';
                        }
                    }
                }

                // লোডে কল করুন
                updateApiKeyButton();


function showTab(tabId) {
    // সমস্ত ট্যাব বোতাম এবং কন্টেন্ট বিভাগ নির্বাচন করুন, এই দুটি সেকশনে নতুন ট্যাবের নাম এবং কনটেন্ট নাম যুক্ত করতে হয়।
    const tabs = [
        basicCalcTab, ageCalcTab, dateCalcTab, scientificCalcTab, newsTab,
        converterTab, measurementTab, typingTestTab, translatorTab, mapTab, prayerTimeTab, imageToTextTab, wordCounterTab, weatherTab, notepadTab,
        spellCheckTab, textBeautifierTab, wordMeaningTab, ttsTab, sttTab, 
        textAssistantTab, allFeaturesTab
    ];
    const contents = [
        basicCalculatorContent, ageCalculatorContent, dateCalculatorContent,
        scientificCalculatorContent, newsContent, converterContent,
        measurementContent, typingTestContent, translatorContent, mapContent,  prayerTimeContent, imageToTextContent, wordCounterContent, weatherContent, notepadContent,
        spellCheckerContent, textBeautifierContent, wordMeaningContent, 
        textToSpeechContent, speechToTextContent, textAssistantContent,
        allFeaturesContent
    ];

    // সমস্ত ট্যাব বোতাম থেকে 'active' ক্লাস সরিয়ে দিন
    tabs.forEach(tab => {
        if (tab) tab.classList.remove('active');
    });

    // সমস্ত কন্টেন্ট বিভাগ লুকান
    contents.forEach(content => {
        if (content) content.classList.remove('active');
    });

    // নির্বাচিত ট্যাব সক্রিয় করুন এবং এর কন্টেন্ট দেখান
    let activeTab, activeContent;
	
//নিচের অংশে নতুন ট্যাবের কেস যুক্ত করতে হয়।
    switch (tabId) {
        case 'basic':
            activeTab = basicCalcTab;
            activeContent = basicCalculatorContent;
            break;
        case 'age':
            activeTab = ageCalcTab;
            activeContent = ageCalculatorContent;
            break;
        case 'date':
            activeTab = dateCalcTab;
            activeContent = dateCalculatorContent;
            break;
        case 'scientific':
            activeTab = scientificCalcTab;
            activeContent = scientificCalculatorContent;
            break;
        case 'news':
            activeTab = newsTab;
            activeContent = newsContent;
            break;
        case 'converter':
            activeTab = converterTab;
            activeContent = converterContent;
            break;
        case 'measurement':
            activeTab = measurementTab;
            activeContent = measurementContent;
            break;
        case 'typingTest':
            activeTab = typingTestTab;
            activeContent = typingTestContent;
            break;
        case 'translator':
            activeTab = translatorTab;
            activeContent = translatorContent;
            break;
        case 'map':
            activeTab = mapTab;
            activeContent = mapContent;
            break;
		case 'prayerTime':
            activeTab = prayerTimeTab;
            activeContent = prayerTimeContent;
            initializePrayerTimeTab();
            break;
        case 'imageToText':
            activeTab = imageToTextTab;
            activeContent = imageToTextContent;
            break;
		case 'wordCounter':
			activeTab = wordCounterTab;
			activeContent = wordCounterContent;
		break;
		case 'weather': // নতুন এই case টি যোগ করুন
            activeTab = weatherTab;
            activeContent = weatherContent;
            break;
		case 'notepad':
			activeTab = notepadTab;
			activeContent = notepadContent;
		break;
        case 'spellCheck':
            activeTab = spellCheckTab;
            activeContent = spellCheckerContent;
            break;
        case 'beautify':
            activeTab = textBeautifierTab;
            activeContent = textBeautifierContent;
            break;
        case 'meaning':
            activeTab = wordMeaningTab;
            activeContent = wordMeaningContent;
            break;
        case 'tts':
            activeTab = ttsTab;
            activeContent = textToSpeechContent;
            break;
        case 'stt':
            activeTab = sttTab;
            activeContent = speechToTextContent;
            break;
        case 'textAssistant':
            activeTab = textAssistantTab;
            activeContent = textAssistantContent;
            break;
        case 'allFeatures':
            activeTab = allFeaturesTab;
            activeContent = allFeaturesContent;
            break;
    }

    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');

    console.log(`ট্যাব পরিবর্তন করা হয়েছে: ${tabId}`);
}

//নিচের এই সেকশনে নতুন ট্যাবের ইফ লাইনটি যুক্ত করতে হয়।

                if (basicCalcTab) basicCalcTab.addEventListener('click', () => showTab('basic'));
                if (ageCalcTab) ageCalcTab.addEventListener('click', () => showTab('age'));
                if (dateCalcTab) dateCalcTab.addEventListener('click', () => showTab('date'));
                if (scientificCalcTab) scientificCalcTab.addEventListener('click', () => showTab('scientific'));
                if (newsTab) newsTab.addEventListener('click', () => showTab('news'));
                if (converterTab) converterTab.addEventListener('click', () => showTab('converter'));
                if (measurementTab) measurementTab.addEventListener('click', () => showTab('measurement')); // Add this line
                if (spellCheckTab) spellCheckTab.addEventListener('click', () => showTab('spellCheck'));
                if (textBeautifierTab) textBeautifierTab.addEventListener('click', () => showTab('beautify'));
                if (wordMeaningTab) wordMeaningTab.addEventListener('click', () => showTab('meaning'));
                if (ttsTab) ttsTab.addEventListener('click', () => showTab('tts')); // TTS ট্যাব ইভেন্ট
                if (sttTab) sttTab.addEventListener('click', () => showTab('stt')); // STT ট্যাব ইভেন্ট
				if (typingTestTab) typingTestTab.addEventListener('click', () => showTab('typingTest')); // এই লাইনটি যোগ করুন
				if (mapTab) mapTab.addEventListener('click', () => showTab('map'));
                if (prayerTimeTab) prayerTimeTab.addEventListener('click', () => showTab('prayerTime')); // এই লাইনটি যোগ করুন
				if (imageToTextTab) imageToTextTab.addEventListener('click', () => showTab('imageToText'));
				if (wordCounterTab) wordCounterTab.addEventListener('click', () => showTab('wordCounter'));
				if (weatherTab) weatherTab.addEventListener('click', () => showTab('weather'));
				if (notepadTab) notepadTab.addEventListener('click', () => {
					showTab('notepad');
					initializeNotepad(); // Notepad চালু করার জন্য এই ফাংশন কল করুন
					});
                if (textAssistantTab) textAssistantTab.addEventListener('click', () => showTab('textAssistant'));
                if (allFeaturesTab) allFeaturesTab.addEventListener('click', () => showTab('allFeatures'));

                // API কী সেটিং বোতাম এবং মডেল লজিক
                if (setApiKeyBtn) {
                    setApiKeyBtn.addEventListener('click', () => {
                        console.log('API কী সেট করুন বোতামে ক্লিক করা হয়েছে।');
                        if (apiKeyModal) {
                            apiKeyModal.classList.remove('hidden');
                            if (apiKeyInput) apiKeyInput.value = localStorage.getItem('geminiApiKey') || ''; // বর্তমান কী থাকলে দেখান
                            if (apiKeyMessage) apiKeyMessage.innerText = ''; // পূর্ববর্তী বার্তা পরিষ্কার করুন
                            console.log('API কী মডেল দেখানো হয়েছে।');
                        } else {
                            console.error('API কী মডেল উপাদান পাওয়া যায়নি।');
                        }
                    });
                } else {
                    console.error('API কী সেট করুন বোতাম পাওয়া যায়নি।');
                }

                if (saveApiKeyBtn) {
                    saveApiKeyBtn.addEventListener('click', () => {
                        console.log('API কী সেভ করুন বোতামে ক্লিক করা হয়েছে।');
                        const newApiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                        if (newApiKey) {
                            localStorage.setItem('geminiApiKey', newApiKey);
                            if (apiKeyMessage) {
                                apiKeyMessage.innerText = 'API কী সফলভাবে সেট করা হয়েছে!';
                                apiKeyMessage.classList.remove('error');
                                apiKeyMessage.classList.add('success');
                            }
                            console.log('API কী সফলভাবে সেভ করা হয়েছে।');
                            updateApiKeyButton(); // অবিলম্বে বোতামের স্টাইল আপডেট করুন
                            setTimeout(() => {
                                if (apiKeyModal) apiKeyModal.classList.add('hidden');
                            }, 1500); // 1.5 সেকেন্ড পর মডেল লুকান
                        } else {
                            if (apiKeyMessage) {
                                apiKeyMessage.innerText = 'অনুগ্রহ করে একটি বৈধ API কী লিখুন।';
                                apiKeyMessage.classList.remove('success');
                                apiKeyMessage.classList.add('error');
                            }
                            console.warn('অবৈধ API কী প্রবেশ করানো হয়েছে।');
                        }
                    });
                }

                if (cancelApiKeyBtn) {
                    cancelApiKeyBtn.addEventListener('click', () => {
                        console.log('API কী বাতিল করুন বোতামে ক্লিক করা হয়েছে।');
                        if (apiKeyModal) apiKeyModal.classList.add('hidden');
                    });
                }


                // --- মৌলিক ক্যালকুলেটর ক্লাস এবং লজিক ---
                class Calculator {
                    constructor(previousOperandTextElement, currentOperandTextElement) {
                        this.previousOperandTextElement = previousOperandTextElement;
                        this.currentOperandTextElement = currentOperandTextElement;
                        this.clear();
                    }

                    clear() {
                        this.currentOperand = '';
                        this.previousOperand = '';
                        this.operation = undefined;
                        this.updateDisplay();
                        // Clearing history is handled by the clearHistoryBtn
                    }

                    delete() {
                        this.currentOperand = this.currentOperand.toString().slice(0, -1);
                        this.updateDisplay();
                    }

                    appendNumber(number) {
                        if (number === '.' && this.currentOperand.includes('.')) return;
                        this.currentOperand = this.currentOperand.toString() + number.toString();
                        this.updateDisplay();
                    }

                    chooseOperation(operation) {
                        if (this.currentOperand === '') return;
                        if (this.previousOperand !== '') {
                            this.compute();
                        }
                        this.operation = operation;
                        this.previousOperand = this.currentOperand;
                        this.currentOperand = '';
                        this.updateDisplay();
                    }

                    compute() {
                        let computation;
                        const prev = parseFloat(this.previousOperand);
                        const current = parseFloat(this.currentOperand);
                        if (isNaN(prev) || isNaN(current)) return;
                        switch (this.operation) {
                            case '+':
                                computation = prev + current;
                                break;
                            case '-':
                                computation = prev - current;
                                break;
                            case '×':
                                computation = prev * current;
                                break;
                            case '÷':
                                if (current === 0) {
                                    computation = 'Error';
                                } else {
                                    computation = prev / current;
                                }
                                break;
                            default:
                                return;
                        }

                        // Add to history ONLY if computation is valid
                        if (computation !== 'Error') {
                            this.addHistoryEntry(`${this.getDisplayNumber(prev)} ${this.operation} ${this.getDisplayNumber(current)} = ${this.getDisplayNumber(computation)}`);
                        }

                        this.currentOperand = computation;
                        this.operation = undefined;
                        this.previousOperand = '';
                        this.updateDisplay();
                    }

                    getDisplayNumber(number) {
                        const stringNumber = number.toString();
                        const integerDigits = parseFloat(stringNumber.split('.')[0]);
                        const decimalDigits = stringNumber.split('.')[1];
                        let integerDisplay;
                        if (isNaN(integerDigits)) {
                            integerDisplay = '';
                        } else {
                            integerDisplay = integerDigits.toLocaleString('en', {
                                maximumFractionDigits: 0
                            });
                        }
                        if (decimalDigits != null) {
                            return `${integerDisplay}.${decimalDigits}`;
                        } else {
                            return integerDisplay;
                        }
                    }

                    updateDisplay() {
                        if (this.currentOperandTextElement) {
                            this.currentOperandTextElement.innerText = this.getDisplayNumber(this.currentOperand);
                        }
                        if (this.previousOperandTextElement) {
                            if (this.operation != null) {
                                this.previousOperandTextElement.innerText =
                                    `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
                            } else {
                                this.previousOperandTextElement.innerText = '';
                            }
                        }
                    }

                    // Basic Calculator History function
                    addHistoryEntry(entry) {
                        const historyList = document.getElementById('history-list');
                        if (historyList) {
                            const listItem = document.createElement('li');
                            listItem.innerText = entry;
                            historyList.prepend(listItem); // Add to top of list
                            // Keep history clean, maybe limit items
                            while (historyList.children.length > 20) { // Keep last 20 entries
                                historyList.removeChild(historyList.lastChild);
                            }
                        }
                    }
                }

                // মৌলিক ক্যালকুলেটর DOM উপাদান এবং ইনিশিয়ালাইজেশন
                const numberButtons = document.querySelectorAll('[data-number]');
                const operatorButtons = document.querySelectorAll('[data-operator]');
                const equalsButton = document.querySelector('[data-equals]');
                const deleteButton = document.querySelector('[data-delete]');
                const allClearButton = document.querySelector('[data-all-clear]');
                const previousOperandTextElement = document.querySelector('[data-previous-operand]');
                const currentOperandTextElement = document.querySelector('[data-current-operand]');
                // Basic Calculator History elements
                const historyList = document.getElementById('history-list');
                const clearHistoryBtn = document.getElementById('clearHistoryBtn');

                if (previousOperandTextElement && currentOperandTextElement) {
                    const basicCalculator = new Calculator(previousOperandTextElement, currentOperandTextElement);

                    // মৌলিক ক্যালকুলেটর বোতামগুলির জন্য ইভেন্ট লিসেনার
                    numberButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            console.log('সংখ্যা বোতামে ক্লিক করা হয়েছে:', button.innerText);
                            basicCalculator.appendNumber(button.innerText);
                        });
                    });

                    operatorButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            console.log('অপারেটর বোতামে ক্লিক করা হয়েছে:', button.innerText);
                            basicCalculator.chooseOperation(button.innerText);
                        });
                    });

                    if (equalsButton) {
                        equalsButton.addEventListener('click', () => {
                            console.log('সমান বোতামে ক্লিক করা হয়েছে।');
                            basicCalculator.compute();
                        });
                    }

                    if (allClearButton) {
                        allClearButton.addEventListener('click', () => {
                            console.log('সব পরিষ্কার বোতামে ক্লিক করা হয়েছে।');
                            basicCalculator.clear();
                        });
                    }

                    if (deleteButton) {
                        deleteButton.addEventListener('click', () => {
                            console.log('মুছুন বোতামে ক্লিক করা হয়েছে।');
                            basicCalculator.delete();
                        });
                    }

                    // Basic Calculator History Clear Button
                    if (clearHistoryBtn) {
                        clearHistoryBtn.addEventListener('click', () => {
                            if (historyList) {
                                historyList.innerHTML = '';
                                showCustomAlert('হিস্টোরি পরিষ্কার করা হয়েছে!');
                            }
                        });
                    }

                    // মৌলিক ক্যালকুলেটরের জন্য কীবোর্ড ইনপুট সমর্থন
                    document.addEventListener('keydown', e => {
                        if (!basicCalculatorContent || !basicCalculatorContent.classList.contains('active')) return;

                        if (e.key >= '0' && e.key <= '9' || e.key === '.') {
                            basicCalculator.appendNumber(e.key);
                        } else if (e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/') {
                            let operatorKey = e.key;
                            if (operatorKey === '*') operatorKey = '×';
                            if (operatorKey === '/') operatorKey = '÷';
                            basicCalculator.chooseOperation(operatorKey);
                        } else if (e.key === 'Enter' || e.key === '=') {
                            e.preventDefault();
                            basicCalculator.compute();
                        } else if (e.key === 'Backspace') {
                            basicCalculator.delete();
                        } else if (e.key === 'Escape' || e.key === 'Delete') { // <-- এই লাইনটি পরিবর্তন করুন
                            basicCalculator.clear();
                        }
                    });

                    // বৈজ্ঞানিক ক্যালকুলেটরের জন্য কীবোর্ড ডিলিট বাটনের ইভেন্ট লিসেনার
                    document.addEventListener('keydown', (e) => {
                        // "C" (ক্লিয়ার) বাটনের কাজ অনুকরণ করুন
                        if (e.key === 'Delete') {
                            if (scientificExpressionInput) scientificExpressionInput.value = '';
                            if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                            if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                            if (scientificExplanation) scientificExplanation.innerText = '';
                        }
                    });
                } else {
                    console.error('মৌলিক ক্যালকুলেটর ডিসপ্লে উপাদান পাওয়া যায়নি।');
                }


                // মৌলিক ক্যালকুলেটর ব্যাখ্যা বৈশিষ্ট্য
                const explainBasicBtn = document.getElementById('explainBasicBtn');
                const basicExplanation = document.getElementById('basicExplanation');
                const basicExplanationLoading = document.getElementById('basicExplanationLoading');

                if (explainBasicBtn && basicExplanation && basicExplanationLoading) {
                    explainBasicBtn.addEventListener('click', async () => {
                        console.log('মৌলিক ব্যাখ্যা বোতামে ক্লিক করা হয়েছে।');
                        const currentExpression = previousOperandTextElement.innerText + currentOperandTextElement.innerText;
                        let fullExpression = currentExpression.trim();

                        if (!fullExpression) {
                            basicExplanation.innerText = 'ব্যাখ্যার জন্য একটি এক্সপ্রেশন লিখুন।';
                            return;
                        }

                        basicExplanation.innerText = '';
                        basicExplanationLoading.style.display = 'block';
                        explainBasicBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                basicExplanation.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                basicExplanationLoading.style.display = 'none';
                                explainBasicBtn.disabled = false;
                                return;
                            }

                            let chatHistory = [];
                            chatHistory.push({
                                role: "user",
                                parts: [{
                                    text: `এই গাণিতিক এক্সপ্রেশনটি সহজ ভাষায় ব্যাখ্যা করুন: "${fullExpression}"। এটি কী করে এবং এর মূল ধারণা কী?`
                                }]
                            });
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                basicExplanation.innerText = text;
                            } else {
                                basicExplanation.innerText = 'জেমিনি থেকে কোনো প্রতিক্রিয়া পাওয়া যায়নি।';
                                console.error('জেমিনি API প্রতিক্রিয়া অপ্রত্যাশিত:', result);
                            }
                        } catch (error) {
                            basicExplanation.innerText = 'জেমিনি API কল করার সময় একটি ত্রুটি হয়েছে: ' + error.message;
                            console.error('জেমিনি API ত্রুটি:', error);
                        } finally {
                            basicExplanationLoading.style.display = 'none';
                            explainBasicBtn.disabled = false;
                        }
                    });
                } else {
                    console.error('মৌলিক ব্যাখ্যা উপাদান পাওয়া যায়নি।');
                }


                // --- বয়স ক্যালকুলেটর লজিক ---
                const birthDateInput = document.getElementById('birthDate');
                const currentDateInput = document.getElementById('currentDate');
                const calculateAgeBtn = document.getElementById('calculateAgeBtn');
                const ageResult = document.getElementById('ageResult');
                const ageErrorMessage = document.getElementById('ageErrorMessage');


                // বর্তমান তারিখ ইনপুটের জন্য বর্তমান তারিখ ডিফল্ট হিসাবে সেট করুন
                const todayCurrentDate = new Date();
                const todayCurrentDateString = todayCurrentDate.toISOString().split('T')[0];
                if (currentDateInput) currentDateInput.value = todayCurrentDateString;

                if (calculateAgeBtn) {
                    calculateAgeBtn.addEventListener('click', () => {
                        console.log('বয়স গণনা করুন বোতামে ক্লিক করা হয়েছে।');
                        calculateAge();
                    });
                }

                function calculateAge() {
                    const birthDateValue = birthDateInput ? birthDateInput.value : '';
                    const currentDateValue = currentDateInput ? currentDateInput.value : '';

                    // পূর্ববর্তী বার্তা পরিষ্কার করুন
                    if (ageResult) ageResult.innerText = '';
                    if (ageErrorMessage) ageErrorMessage.innerText = '';

                    if (!birthDateValue || !currentDateValue) {
                        if (ageErrorMessage) ageErrorMessage.innerText = 'অনুগ্রহ করে জন্ম তারিখ এবং বর্তমান তারিখ উভয়ই নির্বাচন করুন।';
                        return;
                    }

                    const birthDate = new Date(birthDateValue);
                    const currentDate = new Date(currentDateValue);

                    if (birthDate > currentDate) {
                        if (ageErrorMessage) ageErrorMessage.innerText = 'জন্ম তারিখ বর্তমান তারিখের চেয়ে বেশি হতে পারে না।';
                        return;
                    }

                    let years = currentDate.getFullYear() - birthDate.getFullYear();
                    let months = currentDate.getMonth() - birthDate.getMonth();
                    let days = currentDate.getDate() - birthDate.getDate();

                    // দিনগুলি নেতিবাচক হলে মাস এবং বছর সামঞ্জস্য করুন
                    if (days < 0) {
                        months--;
                        // বর্তমান তারিখের পূর্ববর্তী মাসের দিনের সংখ্যা পান
                        const prevMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
                        days += prevMonthLastDay;
                    }

                    // মাসগুলি নেতিবাচক হলে বছর সামঞ্জস্য করুন
                    if (months < 0) {
                        years--;
                        months += 12;
                    }

                    if (ageResult) ageResult.innerText = `আপনার বয়স: ${years} বছর, ${months} মাস, ${days} দিন।`;
                }
                // --- বছর ক্যালকুলেটর লজিক ---
                const yearCalcDateInput = document.getElementById('yearCalcDateInput');
                const yearCalcYearsInput = document.getElementById('yearCalcYearsInput');
                const calculateYearsBtn = document.getElementById('calculateYearsBtn');
                const yearCalcResult = document.getElementById('yearCalcResult');

                if (calculateYearsBtn) {
                    calculateYearsBtn.addEventListener('click', () => {
                        console.log('বছর ক্যালকুলেটর বোতামে ক্লিক করা হয়েছে।');
                        calculateAndDisplayYears();
                    });
                }

                function calculateAndDisplayYears() {
                    const startDateValue = yearCalcDateInput.value;
                    const yearsToCalc = parseInt(yearCalcYearsInput.value, 10);

                    // আগের ফলাফল মুছে ফেলুন
                    yearCalcResult.innerHTML = '';

                    if (isNaN(yearsToCalc) || yearsToCalc <= 0) {
                        yearCalcResult.innerHTML = '<p class="error-message">অনুগ্রহ করে বছরের একটি সঠিক সংখ্যা লিখুন।</p>';
                        return;
                    }

                    // যদি কোনো তারিখ নির্বাচন করা না থাকে, তাহলে আজকের তারিখ ব্যবহার করুন
                    const startDate = startDateValue ? new Date(startDateValue) : new Date();

                    // তারিখ অবৈধ হলে ত্রুটি দেখান
                    if (isNaN(startDate.getTime())) {
                        yearCalcResult.innerHTML = '<p class="error-message">অনুগ্রহ করে একটি সঠিক তারিখ নির্বাচন করুন।</p>';
                        return;
                    }


                    // ভবিষ্যতের তারিখ গণনা
                    const futureDate = new Date(startDate);
                    futureDate.setFullYear(startDate.getFullYear() + yearsToCalc);

                    // অতীতের তারিখ গণনা
                    const pastDate = new Date(startDate);
                    pastDate.setFullYear(startDate.getFullYear() - yearsToCalc);

                    // ফলাফল প্রদর্শনের জন্য তারিখ ফরম্যাট করুন
                    const dateFormatter = new Intl.DateTimeFormat('bn-BD', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        weekday: 'long'
                    });

                    // ফলাফল প্রদর্শনের জন্য HTML তৈরি করুন
                    yearCalcResult.innerHTML = `
                        <div class="result-item">
                            <h3>${yearsToCalc} বছর আগে ছিল:</h3>
                            <p class="past-date">${dateFormatter.format(pastDate)}</p>
                        </div>
                        <div class="result-item">
                            <h3>${yearsToCalc} বছর পরে হবে:</h3>
                            <p class="future-date">${dateFormatter.format(futureDate)}</p>
                        </div>
                    `;
                }

                // --- তারিখ ও সময় ক্যালকুলেটর লজিক ---
                const showTodayDatesBtn = document.getElementById('showTodayDatesBtn');
                const showTomorrowDatesBtn = document.getElementById('showTomorrowDatesBtn');

                const todayResultSection = document.getElementById('todayResultSection');
                const tomorrowResultSection = document.getElementById('tomorrowResultSection');

                const todayGregorianDateDisplay = document.getElementById('todayGregorianDateDisplay');
                const todayBengaliDateDisplay = document.getElementById('todayBengaliDateDisplay');
                const todayHijriDateDisplay = document.getElementById('todayHijriDateDisplay');
                const todayDayDisplay = document.getElementById('todayDayDisplay'); // আজকের দিনের জন্য নতুন উপাদান
                const todayTimeDisplay = document.getElementById('todayTimeDisplay');

                const tomorrowGregorianDateDisplay = document.getElementById('tomorrowGregorianDateDisplay');
                const tomorrowBengaliDateDisplay = document.getElementById('tomorrowBengaliDateDisplay');
                const tomorrowHijriDateDisplay = document.getElementById('tomorrowHijriDateDisplay');
                const tomorrowDayDisplay = document.getElementById('tomorrowDayDisplay'); // আগামীকালের দিনের জন্য নতুন উপাদান
                const tomorrowTimeDisplay = document.getElementById('tomorrowTimeDisplay');

                // নতুন তারিখ কনভার্টার DOM উপাদান
                const englishDateInput = document.getElementById('englishDateInput');
                const convertEnglishToBengaliBtn = document.getElementById('convertEnglishToBengaliBtn');
                const convertedBengaliDate = document.getElementById('convertedBengaliDate');
                const convertedDayDisplay = document.getElementById('convertedDayDisplay'); // রূপান্তরিত দিনের জন্য নতুন উপাদান


                if (showTodayDatesBtn) {
                    showTodayDatesBtn.addEventListener('click', () => {
                        console.log('আজকের তারিখ দেখান বোতামে ক্লিক করা হয়েছে।');
                        displayDates('today');
                    });
                }
                if (showTomorrowDatesBtn) {
                    showTomorrowDatesBtn.addEventListener('click', () => {
                        console.log('আগামীকালের তারিখ দেখান বোতামে ক্লিক করা হয়েছে।');
                        displayDates('tomorrow');
                    });
                }

                // গ্রেগরিয়ান তারিখকে বাংলা তারিখে রূপান্তর করার ফাংশন (বাংলাদেশ স্ট্যান্ডার্ড)
                function getBengaliDate(gregorianDate) {
                    const year = gregorianDate.getFullYear();
                    const month = gregorianDate.getMonth(); // 0-11
                    const day = gregorianDate.getDate();

                    let bengaliYear;
                    const bengaliMonthNames = [
                        "বৈশাখ", "জ্যৈষ্ঠ", "আষাঢ়", "শ্রাবণ", "ভাদ্র", "আশ্বিন",
                        "কার্তিক", "অগ্রহায়ণ", "পৌষ", "মাঘ", "ফাল্গুন", "চৈত্র"
                    ];

                    // বাংলা বছর গণনা করুন (বাংলাদেশ স্ট্যান্ডার্ড: পহেলা বৈশাখ 14 এপ্রিল)
                    if (month < 3 || (month === 3 && day < 14)) { // 14 এপ্রিলের আগে
                        bengaliYear = year - 594;
                    } else { // 14 এপ্রিল বা তার পরে
                        bengaliYear = year - 593;
                    }

                    // বাংলা মাসের দিন সংখ্যা (বাংলাদেশ স্ট্যান্ডার্ড)
                    // বৈশাখ থেকে ভাদ্র (5 মাস): 31 দিন
                    // আশ্বিন থেকে চৈত্র (7 মাস): সাধারণত 30 দিন, অধিবর্ষে ফাল্গুন 31 দিন
                    const bengaliMonthLengths = [31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 30, 30];

                    // বাংলা বছরের সাথে সম্পর্কিত গ্রেগরিয়ান বছরটি অধিবর্ষ কিনা তা নির্ধারণ করুন
                    // এটি ফাল্গুনকে প্রভাবিত করে (11তম মাস, সূচক 10)
                    const gregorianYearForBengaliLeapCheck = bengaliYear + 593;
                    const isGregorianLeapYear = (gregorianYearForBengaliLeapCheck % 4 === 0 && gregorianYearForBengaliLeapCheck % 100 !== 0) || gregorianYearForBengaliLeapCheck % 400 === 0;

                    if (isGregorianLeapYear) {
                        bengaliMonthLengths[10] = 31; // অধিবর্ষে ফাল্গুন 31 দিন
                    }

                    // বর্তমান বাংলা বছরের শুরু থেকে অতিবাহিত দিন গণনা করুন (14 এপ্রিল)
                    const startOfCurrentBengaliYearGregorian = new Date(year, 3, 14); // বর্তমান গ্রেগরিয়ান বছরের 14 এপ্রিল
                    if (gregorianDate < startOfCurrentBengaliYearGregorian) {
                        // যদি বর্তমান তারিখ 14 এপ্রিলের আগে হয়, তবে পূর্ববর্তী গ্রেগরিয়ান বছরের 14 এপ্রিলকে রেফারেন্স হিসাবে সামঞ্জস্য করুন
                        startOfCurrentBengaliYearGregorian.setFullYear(year - 1);
                    }

                    const diffTime = gregorianDate.getTime() - startOfCurrentBengaliYearGregorian.getTime();
                    let daysPassedSinceBengaliYearStart = Math.floor(diffTime / (1000 * 60 * 60 * 24));

                    let currentBengaliMonthIndex = 0;
                    let currentBengaliDay = 0;

                    // সঠিক মাস এবং দিন খুঁজে বের করতে বাংলা মাসগুলির মধ্যে পুনরাবৃত্তি করুন
                    for (let i = 0; i < bengaliMonthNames.length; i++) {
                        if (daysPassedSinceBengaliYearStart < bengaliMonthLengths[i]) {
                            currentBengaliMonthIndex = i;
                            currentBengaliDay = daysPassedSinceBengaliYearStart + 1; // দিন 1-ইনডেক্সড
                            break;
                        }
                        daysPassedSinceBengaliYearStart -= bengaliMonthLengths[i];
                    }

                    // সংখ্যাগুলিকে বাংলা সংখ্যায় রূপান্তর করুন
                    const toBengaliNumber = (num) => {
                        const numbers = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
                        return num.toString().split('').map(digit => numbers[parseInt(digit)]).join('');
                    };

                    // বাংলা মাসের মোট দিন
                    const totalDaysInBengaliMonth = bengaliMonthLengths[currentBengaliMonthIndex];

                    return {
                        day: currentBengaliDay,
                        month: bengaliMonthNames[currentBengaliMonthIndex],
                        year: bengaliYear,
                        totalDays: totalDaysInBengaliMonth,
                        formatted: `${toBengaliNumber(currentBengaliDay)} ${bengaliMonthNames[currentBengaliMonthIndex]}, ${toBengaliNumber(bengaliYear)} বঙ্গাব্দ`
                    };
                }

                // আরবি সংখ্যাকে বাংলা সংখ্যায় রূপান্তর করার ফাংশন
                const arabicToBengaliNumbers = (text) => {
                    const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
                    const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
                    let converted = text;
                    for (let i = 0; i < arabicDigits.length; i++) {
                        converted = converted.replace(new RegExp(arabicDigits[i], 'g'), bengaliDigits[i]);
                    }
                    return converted;
                };

                // আরবি হিজরি মাসের নামগুলিকে বাংলা নামে ম্যাপ করুন
                const hijriMonthArabicToBengali = {
                    'محرم': 'মুহাররম',
                    'صفر': 'সফর',
                    'ربيع الأول': 'রবিউল আউয়াল',
                    'ربيع الآخر': 'রবিউস সানি',
                    'جمادى الأولى': 'জমাদিউল আউয়াল',
                    'جمادى الآخرة': 'জমাদিউস সানি',
                    'رجب': 'রজব',
                    'شعبان': 'শাবান',
                    'رمضان': 'রমজান',
                    'شوال': 'শাওয়াল',
                    'ذو القعدة': 'জিলকদ',
                    'ذو الحجة': 'জিলহজ'
                };

                function displayDates(period) {
                    console.log(`তারিখগুলি প্রদর্শন করা হচ্ছে: ${period}`);
                    // প্রথমে উভয় বিভাগ পরিষ্কার করুন
                    if (todayResultSection) todayResultSection.style.display = 'none';
                    if (tomorrowResultSection) tomorrowResultSection.style.display = 'none';

                    // পূর্ববর্তী কন্টেন্ট পরিষ্কার করুন
                    if (todayGregorianDateDisplay) todayGregorianDateDisplay.innerHTML = '';
                    if (todayBengaliDateDisplay) todayBengaliDateDisplay.innerHTML = '';
                    if (todayHijriDateDisplay) todayHijriDateDisplay.innerHTML = '';
                    if (todayDayDisplay) todayDayDisplay.innerHTML = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                    if (todayTimeDisplay) todayTimeDisplay.innerHTML = '';

                    if (tomorrowGregorianDateDisplay) tomorrowGregorianDateDisplay.innerHTML = '';
                    if (tomorrowBengaliDateDisplay) tomorrowBengaliDateDisplay.innerHTML = '';
                    if (tomorrowHijriDateDisplay) tomorrowHijriDateDisplay.innerHTML = '';
                    if (tomorrowDayDisplay) tomorrowDayDisplay.innerHTML = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                    if (tomorrowTimeDisplay) tomorrowTimeDisplay.innerHTML = '';

                    let dateToDisplay = new Date(); // ডিফল্ট হিসাবে আজ
                    if (period === 'tomorrow') {
                        dateToDisplay.setDate(dateToDisplay.getDate() + 1); // আগামীকালের তারিখের জন্য
                    }

                    // --- তারিখ গণনা ---
                    // গ্রেগরিয়ান তারিখ
                    const gregorianDateFormatted = dateToDisplay.toLocaleDateString('bn-BD', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    const dayOfWeek = dateToDisplay.toLocaleDateString('bn-BD', {
                        weekday: 'long'
                    }); // সপ্তাহের দিন পান

                    // বাংলা তারিখ
                    const bengaliDateInfo = getBengaliDate(dateToDisplay);
                    const bengaliDateFormatted = bengaliDateInfo.formatted;

                    // হিজরি তারিখ (প্রয়োজনে স্থানীয় কনভেনশনের জন্য সামঞ্জস্য করা হয়েছে)
                    let hijriCalculationDate = new Date(dateToDisplay);
                    // ব্যবহারকারীর পর্যবেক্ষণের সাথে মিলানোর জন্য হিজরির জন্য -2 দিনের সামঞ্জস্য পুনরায় চালু করা হচ্ছে
                    // এই সামঞ্জস্য স্থানীয় চাঁদ দেখা ভিত্তিক ক্যালেন্ডারের সাথে সারিবদ্ধ করার জন্য সাধারণ,
					//১ দিন বা ২ দিন আগে পরে করতে নিচের লজিকের মান বসাতে হবে, এখানে 1 দিন বা দুই দিন
					//কমবেশি করে সেট করতে হবে প্রতিমাসে আরবি তারিখের ক্ষেত্রে।
                    hijriCalculationDate.setDate(hijriCalculationDate.getDate() - 2);

                    const hijriDateFormatter = new Intl.DateTimeFormat('ar-SA', {
                        calendar: 'islamic',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        timeZone: 'Asia/Dhaka'
                    });
                    const hijriParts = hijriDateFormatter.formatToParts(hijriCalculationDate);

                    let hijriDay = '';
                    let hijriMonthArabic = '';
                    let hijriYear = '';

                    for (const part of hijriParts) {
                        if (part.type === 'day') {
                            hijriDay = arabicToBengaliNumbers(part.value);
                        } else if (part.type === 'month') {
                            hijriMonthArabic = part.value;
                        } else if (part.type === 'year') {
                            hijriYear = arabicToBengaliNumbers(part.value);
                        }
                    }
                    const hijriMonthBengali = hijriMonthArabicToBengali[hijriMonthArabic] || hijriMonthArabic;
                    const hijriDateFormatted = `${hijriDay} ${hijriMonthBengali} ${hijriYear} হিজরি`;

                    // সময়
                    const timeFormatted = dateToDisplay.toLocaleTimeString('bn-BD', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: true,
                        timeZone: 'Asia/Dhaka' // বাংলাদেশের সময়ের জন্য স্পষ্টভাবে সেট করুন
                    });

                    // 26 বা তার বেশি তারিখের জন্য হাইলাইট লজিক
                    let gregorianHighlightClass = '';
                    if (dateToDisplay.getDate() >= 26) {
                        gregorianHighlightClass = 'text-red-800'; // গাঢ় লাল
                    }

                    let bengaliHighlightClass = '';
                    if (bengaliDateInfo.day >= 26) {
                        bengaliHighlightClass = 'text-red-800'; // গাঢ় লাল
                    }

                    let hijriHighlightClass = '';
                    // তুলনার জন্য hijriDay কে সংখ্যায় রূপান্তর করুন
                    if (parseInt(hijriDay) >= 26) {
                        hijriHighlightClass = 'text-red-800'; // গাঢ় লাল
                    }


                    if (period === 'today') {
                        if (todayResultSection) todayResultSection.style.display = 'block';
                        if (todayGregorianDateDisplay) todayGregorianDateDisplay.innerHTML = `<strong>খ্রিষ্টাব্দ:</strong> <span class="${gregorianHighlightClass}">${gregorianDateFormatted}</span>`;
                        if (todayBengaliDateDisplay) todayBengaliDateDisplay.innerHTML = `<strong>বাংলা তারিখ:</strong> <span class="${bengaliHighlightClass}">${bengaliDateFormatted}</span>`;
                        if (todayHijriDateDisplay) todayHijriDateDisplay.innerHTML = `<strong>হিজরি:</strong> <span class="${hijriHighlightClass}">${hijriDateFormatted}</span>`;
                        if (todayDayDisplay) todayDayDisplay.innerHTML = `<strong>বার:</strong> ${dayOfWeek}`; // দিন প্রদর্শন করুন
                        if (todayTimeDisplay) todayTimeDisplay.innerHTML = `<strong>সময়:</strong> ${timeFormatted}`;
                    } else if (period === 'tomorrow') {
                        if (tomorrowResultSection) tomorrowResultSection.style.display = 'block';
                        if (tomorrowGregorianDateDisplay) tomorrowGregorianDateDisplay.innerHTML = `<strong>খ্রিষ্টাব্দ:</strong> <span class="${gregorianHighlightClass}">${gregorianDateFormatted}</span>`;
                        if (tomorrowBengaliDateDisplay) tomorrowBengaliDateDisplay.innerHTML = `<strong>বাংলা তারিখ:</strong> <span class="${bengaliHighlightClass}">${bengaliDateFormatted}</span>`;
                        if (tomorrowHijriDateDisplay) tomorrowHijriDateDisplay.innerHTML = `<strong>হিজরি:</strong> <span class="${hijriHighlightClass}">${hijriDateFormatted}</span>`;
                        if (tomorrowDayDisplay) tomorrowDayDisplay.innerHTML = `<strong>বার:</strong> ${dayOfWeek}`; // দিন প্রদর্শন করুন
                        if (tomorrowTimeDisplay) tomorrowTimeDisplay.innerHTML = `<strong>সময়:</strong> ${timeFormatted}`;
                    }
                }

                // ইংরেজি থেকে বাংলা তারিখ রূপান্তর লজিক
                if (convertEnglishToBengaliBtn) {
                    convertEnglishToBengaliBtn.addEventListener('click', () => {
                        console.log('ইংরেজি থেকে বাংলা রূপান্তর বোতামে ক্লিক করা হয়েছে।');
                        const englishDateValue = englishDateInput ? englishDateInput.value : '';
                        if (!englishDateValue) {
                            if (convertedBengaliDate) convertedBengaliDate.innerText = 'অনুগ্রহ করে একটি ইংরেজি তারিখ নির্বাচন করুন।';
                            if (convertedDayDisplay) convertedDayDisplay.innerText = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                            return;
                        }

                        const gregorianDate = new Date(englishDateValue);
                        if (isNaN(gregorianDate.getTime())) { // অবৈধ তারিখ পরীক্ষা
                            if (convertedBengaliDate) convertedBengaliDate.innerText = 'অবৈধ তারিখ ফরম্যাট।';
                            if (convertedDayDisplay) convertedDayDisplay.innerText = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                            return;
                        }

                        const bengaliDateInfo = getBengaliDate(gregorianDate);
                        const dayOfWeek = gregorianDate.toLocaleDateString('bn-BD', {
                            weekday: 'long'
                        }); // সপ্তাহের দিন পান

                        if (convertedBengaliDate) convertedBengaliDate.innerHTML = `<strong>বাংলা তারিখ:</strong> ${bengaliDateInfo.formatted}`;
                        if (convertedDayDisplay) convertedDayDisplay.innerHTML = `<strong>বার:</strong> ${dayOfWeek}`;
                    });
                }


                // --- বৈজ্ঞানিক ক্যালকুলেটর লজিক ---
                const scientificExpressionInput = document.getElementById('scientificExpressionInput');
                const scientificButtons = document.querySelectorAll('.scientific-buttons-grid button');
                const scientificResultDisplay = document.getElementById('scientificResult');
                const scientificErrorMessage = document.getElementById('scientificErrorMessage');
                // বৈজ্ঞানিক ব্যাখ্যা উপাদানগুলির জন্য সঠিক আইডি
                const explainScientificBtn = document.getElementById('explainScientificBtn');
                const scientificExplanation = document.getElementById('scientificExplanation');
                const scientificExplanationLoading = document.getElementById('scientificExplanationLoading');

                const functionsWithParentheses = ['sin', 'cos', 'tan', 'log', 'ln', 'sqrt'];

                // এক্সপ্রেশন ইনপুটে বোতামের মান যোগ করুন
                scientificButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        console.log('বৈজ্ঞানিক বোতামে ক্লিক করা হয়েছে:', button.dataset.sciInput);
                        const value = button.dataset.sciInput;
                        const inputElement = scientificExpressionInput;
                        // C বাটন চাপলে পুরো ইনপুট ক্ষেত্র পরিষ্কার হবে
                        if (value === 'C') {
                            if (inputElement) inputElement.value = '';
                            if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                            if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                            if (scientificExplanation) scientificExplanation.innerText = '';
                            // DEL বাটন চাপলে একটি অক্ষর মুছে যাবে
                        } else if (value === 'DEL') {
                            if (inputElement) {
                                inputElement.value = inputElement.value.slice(0, -1);
                            }
                        } else if (button.dataset.sciEquals !== undefined) {
                            // সমান হ্যান্ডেল করুন
                            evaluateScientificExpression();
                        } else if (functionsWithParentheses.includes(value)) {
                            // () প্রয়োজন এমন ফাংশন হ্যান্ডেল করুন
                            if (inputElement) {
                                const start = inputElement.selectionStart;
                                const end = inputElement.selectionEnd;
                                const text = inputElement.value;
                                const newValue = text.substring(0, start) + value + '()' + text.substring(end);
                                inputElement.value = newValue;
                                // বন্ধনীর ভিতরে কার্সার অবস্থান করুন
                                inputElement.selectionStart = start + value.length + 1;
                                inputElement.selectionEnd = start + value.length + 1;
                                inputElement.focus();
                            }
                        } else if (value) {
                            // অন্যান্য মান যোগ করুন
                            if (inputElement) inputElement.value += value;
                        }
                    });
                });

                // কীবোর্ড ইনপুট সমর্থন
                if (scientificExpressionInput) {
                    scientificExpressionInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            evaluateScientificExpression();
                        } else if (e.key === 'Escape') {
                            if (scientificExpressionInput) scientificExpressionInput.value = '';
                            if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                            if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                            if (scientificExplanation) scientificExplanation.innerText = '';
                        } else if (e.key === 'Backspace' || e.key === 'Delete') {
                            // ব্যাকস্পেস বা ডিলিট বাটন চাপলে শেষ অক্ষরটি মুছে যাবে
                            if (scientificExpressionInput) {
                                scientificExpressionInput.value = scientificExpressionInput.value.slice(0, -1);
                            }
                        }
                    });
                }

                function evaluateScientificExpression() {
                    const expression = scientificExpressionInput ? scientificExpressionInput.value : '';
                    if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                    if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                    if (scientificExplanation) scientificExplanation.innerText = '';

                    if (expression.trim() === '') {
                        if (scientificErrorMessage) scientificErrorMessage.innerText = 'অনুগ্রহ করে একটি এক্সপ্রেশন লিখুন।';
                        return;
                    }

                    // মৌলিক বন্ধনী ভারসাম্য পরীক্ষা
                    let openParentheses = (expression.match(/\(/g) || []).length;
                    let closeParentheses = (expression.match(/\)/g) || []).length;
                    if (openParentheses !== closeParentheses) {
                        if (scientificErrorMessage) scientificErrorMessage.innerText = 'বন্ধনী সঠিকভাবে বন্ধ করা হয়নি।';
                        return;
                    }

                    try {
                        let processedExpression = expression
                            .replace(/sin\(/g, 'Math.sin(Math.PI / 180 * ')
                            .replace(/cos\(/g, 'Math.cos(Math.PI / 180 * ')
                            .replace(/tan\(/g, 'Math.tan(Math.PI / 180 * ')
                            .replace(/log\(/g, 'Math.log10(')
                            .replace(/ln\(/g, 'Math.log(')
                            .replace(/sqrt\(/g, 'Math.sqrt(')
                            .replace(/\^/g, '**')
                            .replace(/π/g, 'Math.PI')
                            .replace(/e/g, 'Math.E')
                            .replace(/×/g, '*') // '×' কে '*' এ রূপান্তর করুন
                            .replace(/÷/g, '/'); // '÷' কে '/' এ রূপান্তর করুন

                        let result = eval(processedExpression);

                        if (isNaN(result) || !isFinite(result)) {
                            if (scientificErrorMessage) scientificErrorMessage.innerText = 'অবৈধ এক্সপ্রেশন বা ফলাফল।';
                        } else {
                            if (scientificResultDisplay) scientificResultDisplay.innerText = result.toLocaleString('en', {
                                maximumFractionDigits: 10
                            });
                        }
                    } catch (error) {
                        if (scientificErrorMessage) scientificErrorMessage.innerText = 'এক্সপ্রেশন ত্রুটি: ' + error.message + '। অনুগ্রহ করে সঠিক সিনট্যাক্স ব্যবহার করুন।';
                        console.error('বৈজ্ঞানিক ক্যালকুলেটর ত্রুটি:', error);
                    }
                }

                // বৈজ্ঞানিক এক্সপ্রেশন ব্যাখ্যার জন্য জেমিনি API কল
                if (explainScientificBtn) {
                    explainScientificBtn.addEventListener('click', async () => {
                        console.log('বৈজ্ঞানিক ব্যাখ্যা বোতামে ক্লিক করা হয়েছে।');
                        const expressionToExplain = scientificExpressionInput ? scientificExpressionInput.value.trim() : '';
                        if (!expressionToExplain) {
                            if (scientificExplanation) scientificExplanation.innerText = 'ব্যাখ্যার জন্য একটি এক্সপ্রেশন লিখুন।';
                            return;
                        }

                        if (scientificExplanation) scientificExplanation.innerText = '';
                        if (scientificExplanationLoading) scientificExplanationLoading.style.display = 'block';
                        if (explainScientificBtn) explainScientificBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                if (scientificExplanation) scientificExplanation.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                if (scientificExplanationLoading) scientificExplanationLoading.style.display = 'none';
                                if (explainScientificBtn) explainScientificBtn.disabled = false;
                                return;
                            }

                            let chatHistory = [];
                            chatHistory.push({
                                role: "user",
                                parts: [{
                                    text: `এই গাণিতিক এক্সপ্রেশন বা ফাংশনটি সহজ ভাষায় ব্যাখ্যা করুন: "${expressionToExplain}"। এটি কী করে এবং এর মূল ধারণা কী?`
                                }]
                            });
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                if (scientificExplanation) scientificExplanation.innerText = text;
                            } else {
                                if (scientificExplanation) scientificExplanation.innerText = 'জেমিনি থেকে কোনো প্রতিক্রিয়া পাওয়া যায়নি।';
                                console.error('জেমিনি API প্রতিক্রিয়া অপ্রত্যাশিত:', result);
                            }
                        } catch (error) {
                            if (scientificExplanation) scientificExplanation.innerText = 'জেমিনি API কল করার সময় একটি ত্রুটি হয়েছে: ' + error.message;
                            console.error('জেমিনি API ত্রুটি:', error);
                        } finally {
                            if (scientificExplanationLoading) scientificExplanationLoading.style.display = 'none';
                            if (explainScientificBtn) explainScientificBtn.disabled = false;
                        }
                    });
                } else {
                    console.error('বৈজ্ঞানিক ব্যাখ্যা উপাদান পাওয়া যায়নি।');
                }


                // --- সাম্প্রতিক সংবাদ লজিক ---
                // সংবাদ বিভাগের জন্য HTML এ যা আছে তার বাইরে কোনো নির্দিষ্ট লজিক প্রয়োজন নেই।


                if (textAreaLeft) {
                    addState('textAreaLeft');
                    textAreaLeft.addEventListener('input', () => {
                        // অটোমেটিক অক্ষর রিপ্লেসমেন্ট
                        const value = textAreaLeft.value;
                        const selectionStart = textAreaLeft.selectionStart;

                        // রিপ্লেসমেন্টের তালিকা
                        // decomposed form (letter + nukta) থেকে precomposed form-এ পরিবর্তন করা হচ্ছে
                        let newValue = value
                            .replace(/য়/g, 'য়') // U+09AF U+09BC  -> U+09DF
                            .replace(/ড়/g, 'ড়') // U+09A1 U+09BC  -> U+09DC
                            .replace(/ঢ়/g, 'ঢ়'); // U+09A2 U+09BC  -> U+09DD
                        
                        // যদি কোনো পরিবর্তন হয়ে থাকে, তাহলে টেক্সটবক্স আপডেট করুন
                        if (newValue !== value) {
                            textAreaLeft.value = newValue;
                            // টাইপ করার সময় কার্সরের অবস্থান ঠিক রাখার জন্য
                            textAreaLeft.setSelectionRange(selectionStart, selectionStart);
                        }

                        addState('textAreaLeft'); // আপনার বিদ্যমান আনডু/রিডু কার্যকারিতার জন্য
                    });
                }
                if (textAreaRight) {
                    addState('textAreaRight');
                    textAreaRight.addEventListener('input', () => addState('textAreaRight'));
                }

                // --- নতুন: বাংলা বানান সংশোধন লজিক (অর্থসহ উন্নত) ---
                const checkSpellingBtn = document.getElementById('checkSpellingBtn');
                const spellCheckInput = document.getElementById('spellCheckInput');
                const spellCheckResult = document.getElementById('spellCheckResult');
                const spellCheckLoading = document.getElementById('spellCheckLoading');
                const clearSpellCheckBtn = document.getElementById('clearSpellCheckBtn'); // Get the clear button

                if (checkSpellingBtn) {
                    checkSpellingBtn.addEventListener('click', async () => {
                        const textToCorrect = spellCheckInput.value.trim();
                        if (!textToCorrect) {
                            spellCheckResult.innerText = 'অনুগ্রহ করে পরীক্ষা করার জন্য কিছু লেখা দিন।';
                            return;
                        }

                        spellCheckResult.innerText = '';
                        spellCheckLoading.style.display = 'block';
                        checkSpellingBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                spellCheckResult.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                return;
                            }

                            // উন্নত প্রম্পট যা সংশোধিত শব্দের অর্থ এবং ব্যাখ্যা চাইবে
                            const prompt = `নিচের বাংলা লেখাটির বানান এবং ব্যাকরণগত ভুল সংশোধন করো। তোমার উত্তরটি দুটি অংশে বিভক্ত থাকবে।

প্রথম অংশ: 'সংশোধিত লেখা:' শিরোনাম দিয়ে সম্পূর্ণ সঠিক লেখাটি দাও।
দ্বিতীয় অংশ: 'সংশোধিত শব্দাবলি:' শিরোনাম দিয়ে, তুমি যে শব্দগুলো পরিবর্তন করেছ শুধুমাত্র সেগুলোর একটি তালিকা তৈরি করো। প্রতিটি পরিবর্তিত শব্দের জন্য, মূল ভুল শব্দটি উল্লেখ করো, তারপর সঠিক শব্দটি, তার অর্থ এবং একটি সহজ ব্যাখ্যা দাও।

যদি কোনো ভুল না থাকে, তাহলে শুধু 'লেখাটি সঠিক আছে' লিখে দাও।

মূল লেখা:
"${textToCorrect}"`;

                            let chatHistory = [{
                                role: "user",
                                parts: [{
                                    text: prompt
                                }]
                            }];
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                                const correctedText = result.candidates[0].content.parts[0].text;
                                spellCheckResult.innerText = correctedText;
                            } else {
                                spellCheckResult.innerText = 'দুঃখিত, কোনো উত্তর পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                                console.error('API Response Error:', result);
                            }
                        } catch (error) {
                            spellCheckResult.innerText = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                            console.error('API Call Error:', error);
                        } finally {
                            spellCheckLoading.style.display = 'none';
                            checkSpellingBtn.disabled = false;
                        }
                    });
                }

                // Add event listener for Clear button in Spell Checker
                if (clearSpellCheckBtn) {
                    clearSpellCheckBtn.addEventListener('click', () => {
                        if (spellCheckInput) spellCheckInput.value = '';
                        if (spellCheckResult) spellCheckResult.innerText = '';
                        showCustomAlert('বানান সংশোধনের লেখা পরিষ্কার করা হয়েছে!');
                    });
                }

                // --- নতুন: লেখা সাজানো লজিক ---
                const beautifyTextBtn = document.getElementById('beautifyTextBtn');
                const beautifyInput = document.getElementById('beautifyInput');
                const beautifyResult = document.getElementById('beautifyResult');
                const beautifyLoading = document.getElementById('beautifyLoading');
                const copyBeautifiedTextBtn = document.getElementById('copyBeautifiedTextBtn');
                const clearBeautifyTextBtn = document.getElementById('clearBeautifyTextBtn');

                if (beautifyTextBtn) {
                    beautifyTextBtn.addEventListener('click', async () => {
                        const textToBeautify = beautifyInput.value.trim();
                        if (!textToBeautify) {
                            beautifyResult.innerText = 'অনুগ্রহ করে সাজানোর জন্য কিছু লেখা দিন।';
                            return;
                        }

                        beautifyResult.innerText = '';
                        beautifyLoading.style.display = 'block';
                        beautifyTextBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                beautifyResult.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                return;
                            }

                            const prompt = `নিচের বাংলা লেখাটিকে সহজ, সুন্দর, প্রাঞ্জল এবং সাবলীল ভাষায় গুছিয়ে লেখো। কোনো ভূমিকা বা অতিরিক্ত ব্যাখ্যা ছাড়াই শুধুমাত্র সাজানো লেখাটি দাও:\n\n"${textToBeautify}"`;

                            let chatHistory = [{
                                role: "user",
                                parts: [{
                                    text: prompt
                                }]
                            }];
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                                const beautifiedText = result.candidates[0].content.parts[0].text;
                                beautifyResult.innerText = beautifiedText;
                            } else {
                                beautifyResult.innerText = 'দুঃখিত, কোনো উত্তর পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                                console.error('API Response Error:', result);
                            }
                        } catch (error) {
                            beautifyResult.innerText = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                            console.error('API Call Error:', error);
                        } finally {
                            beautifyLoading.style.display = 'none';
                            beautifyTextBtn.disabled = false;
                        }
                    });
                }

                if (copyBeautifiedTextBtn) {
                    copyBeautifiedTextBtn.addEventListener('click', () => {
                        const textToCopy = beautifyResult.innerText;
                        if (textToCopy) {
                            const tempTextArea = document.createElement('textarea');
                            tempTextArea.value = textToCopy;
                            document.body.appendChild(tempTextArea);
                            tempTextArea.select();
                            tempTextArea.setSelectionRange(0, 99999);
                            try {
                                document.execCommand('copy');
                                showCustomAlert('সাজানো লেখা কপি করা হয়েছে!');
                            } catch (err) {
                                console.error('কপি করতে ব্যর্থ:', err);
                                showCustomAlert('কপি করতে ব্যর্থ হয়েছে।');
                            }
                            document.body.removeChild(tempTextArea);
                        }
                    });
                }

                if (clearBeautifyTextBtn) {
                    clearBeautifyTextBtn.addEventListener('click', () => {
                        beautifyInput.value = '';
                        beautifyResult.innerText = '';
                        showCustomAlert('লেখা সাজানোর ইনপুট পরিষ্কার করা হয়েছে!');
                    });
                }

                // --- নতুন: শব্দের অর্থ খোঁজার লজিক ---
                const findMeaningBtn = document.getElementById('findMeaningBtn');
                const wordMeaningInput = document.getElementById('wordMeaningInput');
                const wordMeaningResult = document.getElementById('wordMeaningResult');
                const wordMeaningLoading = document.getElementById('wordMeaningLoading');
                const clearWordMeaningBtn = document.getElementById('clearWordMeaningBtn'); // Get the clear button

                if (findMeaningBtn) {
                    findMeaningBtn.addEventListener('click', handleFindMeaning);
                }
                if (wordMeaningInput) {
                    wordMeaningInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            handleFindMeaning();
                        }
                    });
                }

                async function handleFindMeaning() {
                    const wordToFind = wordMeaningInput.value.trim();
                    if (!wordToFind) {
                        wordMeaningResult.innerText = 'অনুগ্রহ করে অর্থ খোঁজার জন্য একটি শব্দ লিখুন।';
                        return;
                    }

                    wordMeaningResult.innerHTML = '';
                    wordMeaningLoading.style.display = 'block';
                    findMeaningBtn.disabled = true;

                    try {
                        const apiKey = localStorage.getItem('geminiApiKey');
                        if (!apiKey) {
                            wordMeaningResult.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                            return;
                        }

                        const prompt = `"${wordToFind}" - এই শব্দটির বিস্তারিত অর্থ, প্রতিশব্দ, বিপরীত শব্দ (যদি থাকে), এবং একটি সহজ উদাহরণসহ ব্যাখ্যা দাও। ফলাফলটি সুন্দরভাবে ফরম্যাট করে দাও। ভুল বানান এর ক্ষেত্রে তোমার উত্তরের শুরুতে বানানটি ভুল উল্লেখ করে শব্দটির সঠিক বানানটিও উল্লেখ করো।`;

                        let chatHistory = [{
                            role: "user",
                            parts: [{
                                text: prompt
                            }]
                        }];
                        const payload = {
                            contents: chatHistory
                        };
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                            const meaningText = result.candidates[0].content.parts[0].text;
                            wordMeaningResult.innerText = meaningText;
                        } else {
                            wordMeaningResult.innerText = 'দুঃখিত, কোনো উত্তর পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                            console.error('API Response Error:', result);
                        }
                    } catch (error) {
                        wordMeaningResult.innerText = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                        console.error('API Call Error:', error);
                    } finally {
                        wordMeaningLoading.style.display = 'none';
                        findMeaningBtn.disabled = false;
                    }
                }

                // Add event listener for Clear button in Word Meaning
                if (clearWordMeaningBtn) {
                    clearWordMeaningBtn.addEventListener('click', () => {
                        if (wordMeaningInput) wordMeaningInput.value = '';
                        if (wordMeaningResult) wordMeaningResult.innerHTML = '';
                        showCustomAlert('শব্দের অর্থ পরিষ্কার করা হয়েছে!');
                    });
                }

// ====================================================================
// START: GEMINI API TEXT-TO-SPEECH (TTS) SCRIPT
// ====================================================================
const ttsInput = document.getElementById('ttsInput');
const speakBtn = document.getElementById('speakBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resumeBtn = document.getElementById('resumeBtn');
const stopBtn = document.getElementById('stopBtn');
const clearTtsBtn = document.getElementById('clearTtsBtn');
const downloadTtsBtn = document.getElementById('downloadTtsBtn'); // ডাউনলোড বাটন

// ভয়েস এবং পিচ/রেট কন্ট্রোলগুলি এখন জেমিনি দ্বারা নিয়ন্ত্রিত হবে, তাই UI থেকে সরানো হয়েছে
const ttsControls = document.querySelector('.tts-controls');
if (ttsControls) ttsControls.style.display = 'none';

let ttsAudio; // অডিও অবজেক্ট সংরক্ষণ করার জন্য
let downloadableAudioBlob = null; // ডাউনলোডযোগ্য অডিও ব্লব সংরক্ষণ করার জন্য

// Base64 থেকে ArrayBuffer এ রূপান্তর করার জন্য হেল্পার ফাংশন
function base64ToArrayBuffer(base64) {
    const binaryString = window.atob(base64);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
    }
    return bytes.buffer;
}

// PCM ডেটা থেকে WAV ফাইল তৈরি করার জন্য হেল্পার ফাংশন
function pcmToWav(pcmData, sampleRate) {
    const header = new ArrayBuffer(44);
    const view = new DataView(header);
    const numChannels = 1;
    const bitsPerSample = 16;
    const blockAlign = numChannels * bitsPerSample / 8;
    const byteRate = sampleRate * blockAlign;

    // RIFF chunk descriptor
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + pcmData.byteLength, true);
    writeString(view, 8, 'WAVE');
    // "fmt " sub-chunk
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, 1, true); // Audio format 1 for PCM
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, byteRate, true);
    view.setUint16(32, blockAlign, true);
    view.setUint16(34, bitsPerSample, true);
    // "data" sub-chunk
    writeString(view, 36, 'data');
    view.setUint32(40, pcmData.byteLength, true);

    function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }

    return new Blob([header, pcmData], {
        type: 'audio/wav'
    });
}

async function handleGeminiTTS() {
    const textToSpeak = ttsInput.value.trim();
    if (!textToSpeak) {
        showCustomAlert('অনুগ্রহ করে কথা বলার জন্য কিছু টেক্সট লিখুন।');
        return;
    }

    const apiKey = localStorage.getItem('geminiApiKey');
    if (!apiKey) {
        showCustomAlert('জেমিনি API কী সেট করা হয়নি।');
        return;
    }

    // আগের অডিও বন্ধ করুন এবং ডাউনলোড বাটন নিষ্ক্রিয় করুন
    if (ttsAudio) {
        ttsAudio.pause();
        ttsAudio.currentTime = 0;
    }
    downloadableAudioBlob = null;
    if (downloadTtsBtn) downloadTtsBtn.disabled = true;

    speakBtn.disabled = true;
    speakBtn.innerText = 'লোড হচ্ছে...';

    try {
        const payload = {
            contents: [{
                parts: [{
                    text: textToSpeak
                }]
            }],
            generationConfig: {
                responseModalities: ["AUDIO"]
            },
            model: "gemini-2.5-flash-preview-tts"
        };

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        const part = result?.candidates?.[0]?.content?.parts?.[0];
        const audioData = part?.inlineData?.data;
        const mimeType = part?.inlineData?.mimeType;

        if (audioData && mimeType && mimeType.startsWith("audio/")) {
            const sampleRateMatch = mimeType.match(/rate=(\d+)/);
            if (!sampleRateMatch) throw new Error("স্যাম্পেল রেট পাওয়া যায়নি।");

            const sampleRate = parseInt(sampleRateMatch[1], 10);
            const pcmData = base64ToArrayBuffer(audioData);
            const pcm16 = new Int16Array(pcmData);
            const wavBlob = pcmToWav(pcm16, sampleRate);
            
            downloadableAudioBlob = wavBlob; // ডাউনলোড করার জন্য ব্লব সংরক্ষণ করুন
            
            const audioUrl = URL.createObjectURL(wavBlob);

            ttsAudio = new Audio(audioUrl);
            ttsAudio.play();
            
            if (downloadTtsBtn) downloadTtsBtn.disabled = false; // ডাউনলোড বাটন সক্রিয় করুন

            ttsAudio.onended = () => {
                speakBtn.innerText = 'লোড করুন';
                speakBtn.disabled = false;
            };

        } else {
            throw new Error('API থেকে কোনো অডিও ডেটা পাওয়া যায়নি।');
        }
    } catch (error) {
        console.error('Gemini TTS Error:', error);
        showCustomAlert(`একটি ত্রুটি ঘটেছে: ${error.message}`);
        speakBtn.innerText = 'লোড করুন';
        speakBtn.disabled = false;
        if (downloadTtsBtn) downloadTtsBtn.disabled = true;
    }
}

if (speakBtn) speakBtn.addEventListener('click', handleGeminiTTS);
if (pauseBtn) pauseBtn.addEventListener('click', () => ttsAudio?.pause());
if (resumeBtn) resumeBtn.addEventListener('click', () => ttsAudio?.play());
if (stopBtn) stopBtn.addEventListener('click', () => {
    if (ttsAudio) {
        ttsAudio.pause();
        ttsAudio.currentTime = 0;
        speakBtn.innerText = 'লোড করুন';
        speakBtn.disabled = false;
        if (downloadTtsBtn) downloadTtsBtn.disabled = true; // Stop করলে ডাউনলোড বাটন নিষ্ক্রিয় করুন
        downloadableAudioBlob = null;
    }
});
if (clearTtsBtn) clearTtsBtn.addEventListener('click', () => {
    ttsInput.value = '';
    if (ttsAudio) {
        ttsAudio.pause();
        ttsAudio.currentTime = 0;
    }
    speakBtn.innerText = 'লোড করুন';
    speakBtn.disabled = false;
    if (downloadTtsBtn) downloadTtsBtn.disabled = true; // Clear করলে ডাউনলোড বাটন নিষ্ক্রিয় করুন
    downloadableAudioBlob = null;
});

// ডাউনলোড বাটনের জন্য নতুন ইভেন্ট লিসেনার
if (downloadTtsBtn) {
    downloadTtsBtn.addEventListener('click', () => {
        if (downloadableAudioBlob) {
            const url = URL.createObjectURL(downloadableAudioBlob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'bangla-toolbox-tts.wav'; // ফাইলের নাম
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            a.remove();
        } else {
            showCustomAlert('ডাউনলোড করার জন্য কোনো অডিও নেই।');
        }
    });
}
// ====================================================================
// END: GEMINI API TEXT-TO-SPEECH (TTS) SCRIPT
// ====================================================================

// ====================================================================
// START: GEMINI API BASED SPEECH-TO-TEXT (STT) SCRIPT
// This entire block replaces the old browser-based SpeechRecognition script.
// ====================================================================
const sttOutput = document.getElementById('sttOutput');
const sttStatus = document.getElementById('sttStatus');
const startSttBtn = document.getElementById('startSttBtn');
const uploadAudioBtn = document.getElementById('uploadAudioBtn');
const audioFileInput = document.getElementById('audioFileInput');
const copySttBtn = document.getElementById('copySttBtn');
const clearSttBtn = document.getElementById('clearSttBtn');

let mediaRecorder;
let audioChunks = [];
let audioBlob = null;
let isRecording = false;

// Helper function to insert text at the current cursor position
function insertTextAtCursor(textarea, text) {
    if (!textarea) return;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const oldText = textarea.value;
    const newText = oldText.substring(0, start) + text + oldText.substring(end);
    textarea.value = newText;
    // Place cursor after the inserted text
    textarea.selectionStart = textarea.selectionEnd = start + text.length;
    textarea.focus();
}

// Main function to transcribe audio using Gemini API
async function transcribeAudioWithGemini(audioFile) {
    const apiKey = localStorage.getItem('geminiApiKey');
    if (!apiKey) {
        showCustomAlert('জেমিনি API কী সেট করা হয়নি।');
        sttStatus.innerText = 'অবস্থা: API কী প্রয়োজন।';
        return;
    }

    sttStatus.innerText = 'অবস্থা: অডিও প্রসেসিং ও জেমিনিকে পাঠানো হচ্ছে...';
    if(startSttBtn) startSttBtn.disabled = true;
    if(uploadAudioBtn) uploadAudioBtn.disabled = true;


    // Convert audio blob/file to Base64
    const reader = new FileReader();
    reader.readAsDataURL(audioFile);
    reader.onloadend = async () => {
        const base64Audio = reader.result.split(',')[1];
        const mimeType = audioFile.type.split(';')[0]; // Get MIME type without codecs

        try {
            const prompt = "Transcribe the following audio. Provide only the transcribed text without any additional comments, explanations, or introductory phrases.";

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        {
                            inlineData: {
                                mimeType: mimeType,
                                data: base64Audio
                            }
                        }
                    ]
                }]
            };

            const model = "gemini-2.5-flash-preview-05-20"; // This model supports multimodal input
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (response.ok && result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                const transcribedText = result.candidates[0].content.parts[0].text.trim();
                insertTextAtCursor(sttOutput, transcribedText + " "); // Add a space after inserting
                sttStatus.innerText = 'অবস্থা: সফলভাবে টেক্সটে রূপান্তরিত হয়েছে! ✅';
            } else {
                const errorText = result?.error?.message || 'একটি অজানা ত্রুটি ঘটেছে। অডিও থেকে লেখা বের করা যায়নি।';
                sttStatus.innerText = `অবস্থা: ব্যর্থ হয়েছে - ${errorText}`;
                console.error('STT API Response Error:', result);
                showCustomAlert(`ট্রান্সক্রাইব করতে ব্যর্থ: ${errorText}`);
            }
        } catch (error) {
            sttStatus.innerText = `অবস্থা: একটি ত্রুটি ঘটেছে - ${error.message}`;
            console.error('STT API Call Error:', error);
            showCustomAlert(`একটি ত্রুটি ঘটেছে: ${error.message}`);
        } finally {
             // Reset the record button state
             if(startSttBtn) {
                 startSttBtn.dataset.state = 'record';
                 startSttBtn.innerText = 'রেকর্ড করুন';
                 startSttBtn.disabled = false;
             }
             if(uploadAudioBtn) uploadAudioBtn.disabled = false;
        }
    };
    reader.onerror = (error) => {
        console.error('File Reader Error:', error);
        sttStatus.innerText = 'অবস্থা: ফাইল পড়তে সমস্যা হয়েছে।';
        showCustomAlert('ফাইলটি পড়তে একটি ত্রুটি হয়েছে।');
        if(startSttBtn) startSttBtn.disabled = false;
        if(uploadAudioBtn) uploadAudioBtn.disabled = false;
    };
}


// Event listener for the record/stop/send button
if (startSttBtn) {
    startSttBtn.addEventListener('click', async () => {
        const state = startSttBtn.dataset.state;

        if (state === 'record') {
            // Start recording
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = []; // Clear previous chunks

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    // Use a common MIME type like audio/webm
                    audioBlob = new Blob(audioChunks, { type: 'audio/webm' }); 
                    startSttBtn.dataset.state = 'send';
                    startSttBtn.innerText = 'পাঠান';
                    sttStatus.innerText = 'অবস্থা: রেকর্ডিং শেষ। পাঠানোর জন্য প্রস্তুত।';
                    startSttBtn.disabled = false;
                    // Stop microphone track to turn off indicator
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                isRecording = true;
                startSttBtn.dataset.state = 'recording';
                startSttBtn.innerText = 'থামান';
                sttStatus.innerText = 'অবস্থা: রেকর্ডিং চলছে... 🎙️';
            } catch (err) {
                console.error("Microphone access error:", err);
                sttStatus.innerText = 'অবস্থা: মাইক্রোফোন অ্যাক্সেস করা যায়নি।';
                showCustomAlert('মাইক্রোফোন ব্যবহারের অনুমতি প্রয়োজন।');
            }
        } else if (state === 'recording') {
            // Stop recording
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                startSttBtn.disabled = true; // Disable until onstop event fires
                sttStatus.innerText = 'অবস্থা: প্রসেসিং...';
            }
        } else if (state === 'send') {
            // Send the recorded audio
            if (audioBlob) {
                transcribeAudioWithGemini(audioBlob);
                audioBlob = null; // Clear blob after sending
            } else {
                 sttStatus.innerText = 'অবস্থা: পাঠানোর জন্য কোনো রেকর্ডিং নেই।';
            }
        }
    });
}

// Event listeners for the upload functionality
if (uploadAudioBtn) {
    uploadAudioBtn.addEventListener('click', () => {
        if(audioFileInput) audioFileInput.click();
    });
}
if (audioFileInput) {
    audioFileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            transcribeAudioWithGemini(file);
            audioFileInput.value = ''; // Reset input for the next upload
        }
    });
}


// Event listeners for copy and clear buttons
if (copySttBtn) {
    copySttBtn.addEventListener('click', () => copyToClipboard('sttOutput'));
}

if (clearSttBtn) {
    clearSttBtn.addEventListener('click', () => {
        if (sttOutput) sttOutput.value = '';
        if (isRecording) {
            mediaRecorder.stop(); // Stop recording if active
        }
        // Reset button to initial state
        if(startSttBtn) {
            startSttBtn.dataset.state = 'record';
            startSttBtn.innerText = 'রেকর্ড করুন';
            startSttBtn.disabled = false;
        }
        if(sttStatus) sttStatus.innerText = 'অবস্থা: নিষ্ক্রিয় ✅';
    });
}
// ====================================================================
// END: GEMINI API BASED SPEECH-TO-TEXT (STT) SCRIPT
// ====================================================================

// ====================================================================
// START: TRANSLATOR SCRIPT (GEMINI API)
// ====================================================================

// প্রথমে, DOMContentLoaded এর শুরুতে অন্য ট্যাবগুলোর সাথে এগুলোও যোগ করুন
// const translatorTab = document.getElementById('translatorTab');
// const translatorContent = document.getElementById('translatorContent');

// ট্রান্সলেটরের জন্য DOM উপাদান
const translateBtn = document.getElementById('translateBtn');
const translatorInput = document.getElementById('translatorInput');
const translatorOutput = document.getElementById('translatorOutput');
const targetLanguageSelect = document.getElementById('targetLanguage');
const translatorLoading = document.getElementById('translatorLoading');
const copyTranslatedTextBtn = document.getElementById('copyTranslatedTextBtn');
const clearTranslatorTextBtn = document.getElementById('clearTranslatorTextBtn');

// ড্রপডাউনের জন্য ভাষার তালিকা
const languages = {
    'en': 'English',
    'bn': 'Bengali (বাংলা)',
    'hi': 'Hindi (हिन्दी)',
    'ar': 'Arabic (العربية)',
    'es': 'Spanish (Español)',
    'fr': 'French (Français)',
    'de': 'German (Deutsch)',
    'ja': 'Japanese (日本語)',
    'ko': 'Korean (한국어)',
    'ru': 'Russian (Русский)',
    'zh': 'Chinese (中文)',
    'pt': 'Portuguese (Português)',
    'it': 'Italian (Italiano)',
    'id': 'Indonesian (Bahasa Indonesia)',
    'ms': 'Malay (Bahasa Melayu)',
    'tr': 'Turkish (Türkçe)',
    'vi': 'Vietnamese (Tiếng Việt)',
    'th': 'Thai (ภาษาไทย)',
    'ur': 'Urdu (اردو)'
};

// ভাষার ড্রপডাউনটি পূরণ করার ফাংশন
function populateLanguageDropdown() {
    if (!targetLanguageSelect) return;
    targetLanguageSelect.innerHTML = ''; // আগের অপশন মুছে ফেলুন
    for (const code in languages) {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = languages[code];
        targetLanguageSelect.appendChild(option);
    }
    // ডিফল্ট ভাষা হিসেবে বাংলা সেট করুন
    targetLanguageSelect.value = 'bn';
}

// মূল অনুবাদ ফাংশন
async function handleTranslate() {
    const textToTranslate = translatorInput.value.trim();
    const langCode = targetLanguageSelect.value;
    const langName = languages[langCode];

    if (!textToTranslate) {
        showCustomAlert('অনুগ্রহ করে অনুবাদ করার জন্য কিছু টেক্সট লিখুন।');
        return;
    }

    const apiKey = localStorage.getItem('geminiApiKey');
    if (!apiKey) {
        showCustomAlert('জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।');
        translatorOutput.value = 'API কী প্রয়োজন।';
        return;
    }

    translatorLoading.style.display = 'block';
    translateBtn.disabled = true;
    translatorOutput.value = '';

    try {
        const prompt = `Translate the following text to ${langName}. Provide only the translated text without any additional explanations, introductory phrases, or quotation marks.\n\nText to translate:\n"${textToTranslate}"`;

        const payload = {
            contents: [{
                parts: [{ text: prompt }]
            }]
        };
        const model = "gemini-2.5-flash-preview-05-20";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        
        if (response.ok && result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
            translatorOutput.value = result.candidates[0].content.parts[0].text.trim();
        } else {
            const errorText = result?.error?.message || 'একটি অজানা ত্রুটি ঘটেছে।';
            translatorOutput.value = `অনুবাদ ব্যর্থ হয়েছে: ${errorText}`;
            console.error('API Response Error:', result);
        }

    } catch (error) {
        translatorOutput.value = `একটি ত্রুটি ঘটেছে: ${error.message}`;
        console.error('API Call Error:', error);
    } finally {
        translatorLoading.style.display = 'none';
        translateBtn.disabled = false;
    }
}

// ট্রান্সলেটরের জন্য ইভেন্ট লিসেনার যোগ করুন
if (translatorTab) {
    translatorTab.addEventListener('click', () => showTab('translator'));
}

if (translateBtn) {
    translateBtn.addEventListener('click', handleTranslate);
}

if (copyTranslatedTextBtn) {
    copyTranslatedTextBtn.addEventListener('click', () => {
        if (translatorOutput.value) {
            copyToClipboard('translatorOutput');
        } else {
            showCustomAlert('কপি করার জন্য কোনো লেখা নেই।');
        }
    });
}

if (clearTranslatorTextBtn) {
    clearTranslatorTextBtn.addEventListener('click', () => {
        translatorInput.value = '';
        translatorOutput.value = '';
        showCustomAlert('অনুবাদকের লেখা পরিষ্কার করা হয়েছে!');
    });
}

// স্ক্রিপ্ট লোড হওয়ার সময় ড্রপডাউনটি পূরণ করুন
populateLanguageDropdown();

// ====================================================================
// START: IMAGE TO TEXT (OCR) SCRIPT (Drag & Drop Updated)
// ====================================================================
const ocrImageInput = document.getElementById('ocrImageInput');
const imageUploadArea = document.querySelector('.image-upload-area'); // আপলোড এরিয়া সিলেক্ট করা হয়েছে
const ocrImagePreview = document.getElementById('ocrImagePreview');
const extractTextBtn = document.getElementById('extractTextBtn');
const ocrLoading = document.getElementById('ocrLoading');
const ocrResultText = document.getElementById('ocrResultText');
const copyOcrTextBtn = document.getElementById('copyOcrTextBtn');
const clearOcrBtn = document.getElementById('clearOcrBtn');

let ocrUploadedFile = null;

// ফাইল প্রসেস করার জন্য একটি ফাংশন তৈরি করা হয়েছে
function handleOcrFile(file) {
    if (!file) return;
    
    // ফাইলটি ছবি কিনা তা পরীক্ষা করা হচ্ছে
    const allowedTypes = ['image/png', 'image/jpeg', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
        showCustomAlert('শুধুমাত্র PNG, JPEG, বা WEBP ফরম্যাটের ছবি আপলোড করুন।');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        ocrUploadedFile = {
            type: file.type,
            base64: e.target.result.split(',')[1],
            dataUrl: e.target.result
        };
        displayOcrImagePreview();
    };
    reader.onerror = () => {
        showCustomAlert('ফাইলটি পড়তে একটি ত্রুটি হয়েছে।');
    };
    reader.readAsDataURL(file);
}

// ইনপুট থেকে ফাইল সিলেক্ট হ্যান্ডেল করা
if (ocrImageInput) {
    ocrImageInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        handleOcrFile(file);
    });
}

// Drag and Drop ইভেন্ট লিসেনার যোগ করা হয়েছে
if (imageUploadArea) {
    // ডিফল্ট আচরণ বন্ধ করা
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    // ড্র্যাগ করে ছবির উপরে আনলে আপলোড এরিয়া হাইলাইট হবে
    ['dragenter', 'dragover'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, () => {
            imageUploadArea.classList.add('drag-over');
        }, false);
    });

    // ড্র্যাগ করে ছবি সরিয়ে নিলে হাইলাইট চলে যাবে
    ['dragleave', 'drop'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, () => {
            imageUploadArea.classList.remove('drag-over');
        }, false);
    });

    // ফাইল ড্রপ করলে হ্যান্ডেল করা হবে
    imageUploadArea.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            handleOcrFile(files[0]); // প্রথম ফাইলটি প্রসেস করা হবে
        }
    }, false);
}

// বাকি ফাংশনগুলো আগের মতোই থাকছে
function displayOcrImagePreview() {
    if (!ocrUploadedFile) return;
    ocrImagePreview.innerHTML = `
        <img src="${ocrUploadedFile.dataUrl}" alt="Uploaded Image Preview">
        <button class="remove-image-btn" title="ছবি সরান">&times;</button>
    `;
    ocrImagePreview.classList.remove('hidden');
    ocrImagePreview.querySelector('.remove-image-btn').addEventListener('click', clearOcrAreas);
}

function clearOcrAreas() {
    ocrUploadedFile = null;
    if(ocrImageInput) ocrImageInput.value = '';
    if(ocrImagePreview) ocrImagePreview.innerHTML = '';
    if(ocrImagePreview) ocrImagePreview.classList.add('hidden');
    if(ocrResultText) ocrResultText.value = '';
    if(ocrLoading) ocrLoading.style.display = 'none';
}

if (clearOcrBtn) {
    clearOcrBtn.addEventListener('click', () => {
         clearOcrAreas();
         showCustomAlert('সমস্ত কিছু মুছে ফেলা হয়েছে!');
    });
}

if (extractTextBtn) {
    extractTextBtn.addEventListener('click', async () => {
        if (!ocrUploadedFile) {
            showCustomAlert('অনুগ্রহ করে প্রথমে একটি ছবি নির্বাচন করুন।');
            return;
        }

        const apiKey = localStorage.getItem('geminiApiKey');
        if (!apiKey) {
            showCustomAlert('জেমিনি API কী সেট করা হয়নি।');
            return;
        }

        ocrLoading.style.display = 'block';
        extractTextBtn.disabled = true;
        ocrResultText.value = '';

        try {
            const prompt = "Extract all text from this image, including any text in different languages. Provide only the extracted text without any additional comments or explanations.";
            
            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        {
                            inlineData: {
                                mimeType: ocrUploadedFile.type,
                                data: ocrUploadedFile.base64
                            }
                        }
                    ]
                }]
            };

            const model = "gemini-2.5-flash-preview-05-20";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const result = await response.json();

            if (response.ok && result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                ocrResultText.value = result.candidates[0].content.parts[0].text.trim();
            } else {
                const errorText = result?.error?.message || 'একটি অজানা ত্রুটি ঘটেছে। ছবিটি থেকে লেখা বের করা যায়নি।';
                ocrResultText.value = `ব্যর্থ হয়েছে: ${errorText}`;
                console.error('OCR API Response Error:', result);
            }

        } catch (error) {
            ocrResultText.value = `একটি ত্রুটি ঘটেছে: ${error.message}`;
            console.error('OCR API Call Error:', error);
        } finally {
            ocrLoading.style.display = 'none';
            extractTextBtn.disabled = false;
        }
    });
}

if(copyOcrTextBtn){
    copyOcrTextBtn.addEventListener('click', () => {
        if(ocrResultText.value){
            copyToClipboard('ocrResultText');
        } else {
            showCustomAlert('কপি করার জন্য কোনো লেখা নেই।');
        }
    });
}
// ====================================================================
// END: IMAGE TO TEXT (OCR) SCRIPT
// ====================================================================

// ====================================================================
// START: WORD COUNTER SCRIPT
// ====================================================================
function initializeWordCounter() {
    const wordCounterInput = document.getElementById('wordCounterInput');
    const wordCountEl = document.getElementById('wordCount');
    const charCountEl = document.getElementById('charCount');
    const sentenceCountEl = document.getElementById('sentenceCount');
    const paragraphCountEl = document.getElementById('paragraphCount');

    if (!wordCounterInput) return;

    wordCounterInput.addEventListener('input', () => {
        const text = wordCounterInput.value;

        // Character Count
        const charCount = text.length;
        charCountEl.textContent = new Intl.NumberFormat('bn-BD').format(charCount);

        // Word Count
        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
        const wordCount = words.length;
        wordCountEl.textContent = text.trim() === '' ? '০' : new Intl.NumberFormat('bn-BD').format(wordCount);

        // Sentence Count (handles English and Bengali terminators)
        const sentences = text.trim().split(/[.!?।]/).filter(sentence => sentence.trim().length > 0);
        const sentenceCount = sentences.length;
        sentenceCountEl.textContent = new Intl.NumberFormat('bn-BD').format(sentenceCount);

        // Paragraph Count
        const paragraphs = text.trim().split(/\n+/).filter(para => para.trim().length > 0);
        const paragraphCount = paragraphs.length;
        paragraphCountEl.textContent = new Intl.NumberFormat('bn-BD').format(paragraphCount);
    });
}

// Initialize the word counter when the tab is shown
if (wordCounterTab) {
    wordCounterTab.addEventListener('click', initializeWordCounter);
}
// If it's the default active tab, initialize it on load
if (wordCounterContent && wordCounterContent.classList.contains('active')) {
    initializeWordCounter();
}
// ====================================================================
// END: WORD COUNTER SCRIPT
// ====================================================================

// ====================================================================
// START: WEATHER TAB SCRIPT (NEW)
// ====================================================================
const cityInput = document.getElementById('cityInput');
const searchWeatherBtn = document.getElementById('searchWeatherBtn');
const weatherResult = document.getElementById('weatherResult');
const weatherLoading = document.getElementById('weatherLoading');

// অনুগ্রহ করে এখানে আপনার নিজের OpenWeatherMap API কী বসান।
// আপনি [https://openweathermap.org/api](https://openweathermap.org/api) - এই লিংক থেকে বিনামূল্যে একটি কী পেতে পারেন।
const weatherApiKey = '4a5a19a6db3c60132629d8bd29949841'; // <--- এখানে আপনার API কী বসাতে হবে

// নতুন: UNIX টাইমস্ট্যাম্পকে লোকাল সময়ে রূপান্তর করার জন্য ফাংশন
function formatTime(timestamp) {
    const date = new Date(timestamp * 1000); // সেকেন্ডকে মিলিসেকেন্ডে রূপান্তর করা হয়েছে
    return date.toLocaleTimeString('bn-BD', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
    });
}

async function getWeather(city) {
    if (weatherApiKey === 'YOUR_API_KEY_HERE' || weatherApiKey === '') {
        weatherResult.innerHTML = '<p class="text-red-500 font-semibold">আবহাওয়া API কী সেট করা হয়নি। অনুগ্রহ করে স্ক্রিপ্টে আপনার কী যোগ করুন।</p>';
        return;
    }

    weatherLoading.style.display = 'block';
    weatherResult.innerHTML = '';

    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${weatherApiKey}&units=metric&lang=bn`);
        if (!response.ok) {
            if (response.status === 404) {
                throw new Error('শহরটি খুঁজে পাওয়া যায়নি।');
            } else if (response.status === 401) {
                throw new Error('API কী টি সঠিক নয়।');
            } else {
                throw new Error('একটি সমস্যা হয়েছে। আবার চেষ্টা করুন।');
            }
        }
        const data = await response.json();
        displayWeather(data);
    } catch (error) {
        weatherResult.innerHTML = `<p class="text-red-500 font-semibold">${error.message}</p>`;
    } finally {
        weatherLoading.style.display = 'none';
    }
}

function displayWeather(data) {
    const { name, main, weather, wind, sys } = data; // sys যোগ করা হয়েছে
    const iconUrl = `https://openweathermap.org/img/wn/${weather[0].icon}@4x.png`; // আইকন বড় করা হয়েছে

    weatherResult.innerHTML = `
        <h4>${name}</h4>
        <img src="${iconUrl}" alt="${weather[0].description}" class="weather-icon">
        <p class="temp">${Math.round(main.temp)}&deg;C</p>
        <p class="description">${weather[0].description}</p>
        <p class="weather-feels-like"> অনুভূত হচ্ছে: ${Math.round(main.feels_like)}&deg;C</p>

        <div class="weather-extra-details">
            <div class="detail-item">
                <strong>সর্বোচ্চ তাপমাত্রা</strong>
                <span>${Math.round(main.temp_max)}&deg;C</span>
            </div>
            <div class="detail-item">
                <strong>সর্বনিম্ন তাপমাত্রা</strong>
                <span>${Math.round(main.temp_min)}&deg;C</span>
            </div>
             <div class="detail-item">
                <strong>আর্দ্রতা</strong>
                <span>${main.humidity}%</span>
            </div>
            <div class="detail-item">
                <strong>বাতাসের গতি</strong>
                <span>${wind.speed.toFixed(1)} মি/সে</span>
            </div>
            <div class="detail-item">
                <strong>সূর্যোদয়</strong>
                <span>${formatTime(sys.sunrise)}</span>
            </div>
            <div class="detail-item">
                <strong>সূর্যাস্ত</strong>
                <span>${formatTime(sys.sunset)}</span>
            </div>
        </div>
    `;
}

if (searchWeatherBtn) {
    searchWeatherBtn.addEventListener('click', () => {
        const city = cityInput.value.trim();
        if (city) {
            getWeather(city);
        } else {
            showCustomAlert('অনুগ্রহ করে একটি শহরের নাম লিখুন।');
        }
    });
}

if (cityInput) {
    cityInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            searchWeatherBtn.click();
        }
    });
}
// ====================================================================
// END: WEATHER TAB SCRIPT
// ====================================================================

// ====================================================================
// START: NOTEPAD / TO-DO LIST SCRIPT
// ====================================================================
function initializeNotepad() {
    const taskInput = document.getElementById('taskInput');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const taskList = document.getElementById('taskList');

    if (!taskInput || !addTaskBtn || !taskList) return;

    // কাজ যোগ বা আপডেট করার ফাংশন
    function addTask() {
        const text = taskInput.value.trim();
        if (text === '') {
            showCustomAlert('অনুগ্রহ করে একটি কাজ বা নোট লিখুন।');
            return;
        }

        // আমরা নতুন কাজ যোগ করছি নাকি আপডেট করছি তা বোতামের লেখা দেখে পরীক্ষা করুন
        if (addTaskBtn.textContent === 'আপডেট করুন') {
            // এটি একটি আপডেট
            createTaskElement(text); // নতুন লেখা দিয়ে এলিমেন্টটি আবার তৈরি করুন
            addTaskBtn.textContent = 'যোগ করুন'; // বোতামের লেখা রিসেট করুন
        } else {
            // এটি একটি নতুন কাজ
            createTaskElement(text);
        }

        taskInput.value = '';
        saveTasks();
        updateTaskNumbers();
    }
    
    function loadTasks() {
        const tasks = JSON.parse(localStorage.getItem('notepadTasks')) || [];
        taskList.innerHTML = '';
        tasks.forEach(task => createTaskElement(task.text, task.completed));
        updateTaskNumbers();
    }

    function saveTasks() {
        const tasks = [];
        document.querySelectorAll('.task-item').forEach(item => {
            const taskTextSpan = item.querySelector('.task-text');
            if (taskTextSpan) {
                 tasks.push({
                    text: taskTextSpan.textContent,
                    completed: item.classList.contains('completed')
                });
            }
        });
        localStorage.setItem('notepadTasks', JSON.stringify(tasks));
    }

    function createTaskElement(text, isCompleted = false) {
        const li = document.createElement('li');
        li.className = 'task-item';
        li.setAttribute('draggable', 'true');
        if (isCompleted) {
            li.classList.add('completed');
        }

        const numberSpan = document.createElement('span');
        numberSpan.className = 'task-number';

        const textSpan = document.createElement('span');
        textSpan.className = 'task-text';
        textSpan.textContent = text;
        
        // সিംഗেল ক্লিকে কাজ সম্পন্ন/অসম্পন্ন টগল করুন
        textSpan.addEventListener('click', () => {
            li.classList.toggle('completed');
            saveTasks();
        });

        // ডাবল ক্লিকে এডিটের জন্য হ্যান্ডেল করুন (নতুন যুক্ত করা হয়েছে)
        textSpan.addEventListener('dblclick', () => {
            // যদি ইতোমধ্যে কোনো আইটেম এডিট করা হয়, তবে নতুন এডিট শুরু করতে বাধা দিন
            if (addTaskBtn.textContent === 'আপডেট করুন') {
                showCustomAlert('অনুগ্রহ করে বর্তমান সম্পাদনা শেষ করুন।');
                return;
            }
            taskInput.value = textSpan.textContent; // ইনপুট ফিল্ডে লেখাটি পাঠান
            addTaskBtn.textContent = 'আপডেট করুন'; // বোতামের লেখা পরিবর্তন করুন
            taskList.removeChild(li); // তালিকা থেকে আইটেমটি সরিয়ে ফেলুন
            updateTaskNumbers(); // নম্বর আপডেট করুন
            taskInput.focus(); // ইনপুট ফিল্ডে ফোকাস করুন
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-task-btn';
        deleteBtn.innerHTML = '×';
        deleteBtn.addEventListener('click', () => {
            // যদি কোনো আইটেম এডিট করার সময় ডিলিট করা হয়, তাহলে বোতামটি রিসেট করুন
            if (addTaskBtn.textContent === 'আপডেট করুন' && taskInput.value === textSpan.textContent) {
                 taskInput.value = '';
                 addTaskBtn.textContent = 'যোগ করুন';
            }
            li.remove();
            saveTasks();
            updateTaskNumbers();
        });

        li.appendChild(numberSpan);
        li.appendChild(textSpan);
        li.appendChild(deleteBtn);
        taskList.appendChild(li);
    }
    
    // localStorage থেকে কাজগুলো লোড করুন
    loadTasks();

    // Event Listeners
    addTaskBtn.addEventListener('click', addTask);
    taskInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            addTask();
        }
    });

    // Drag-and-drop event listeners
    taskList.addEventListener('dragstart', e => {
        if (e.target.classList.contains('task-item')) {
            e.target.classList.add('dragging');
        }
    });

    taskList.addEventListener('dragend', e => {
        if (e.target.classList.contains('task-item')) {
            e.target.classList.remove('dragging');
            saveTasks();
            updateTaskNumbers();
        }
    });

    taskList.addEventListener('dragover', e => {
        e.preventDefault();
        const afterElement = getDragAfterElement(taskList, e.clientY);
        const dragging = document.querySelector('.dragging');
        if (dragging) {
            if (afterElement == null) {
                taskList.appendChild(dragging);
            } else {
                taskList.insertBefore(dragging, afterElement);
            }
        }
    });

    function updateTaskNumbers() {
        const taskItems = taskList.querySelectorAll('.task-item');
        taskItems.forEach((task, index) => {
            const numberEl = task.querySelector('.task-number');
            if (numberEl) {
                numberEl.textContent = index + 1;
            }
        });
    }

    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
}
// ====================================================================
// END: NOTEPAD / TO-DO LIST SCRIPT
// ====================================================================


//নতুন কোনো ট্যাব যুক্ত করলে তার স্ক্রিপ্ট এটির আগে অ্যাড করতে হবে।

// ====================================================================
// END: TRANSLATOR SCRIPT
// ====================================================================

                // --- টেক্সট অ্যাসিস্ট্যান্ট (চ্যাট) লজিক ---
                const assistantInput = document.getElementById('assistantInput');
                const askGeminiBtn = document.getElementById('askGeminiBtn');
                const chatWindow = document.getElementById('chatWindow');
                const clearChatBtn = document.getElementById('clearChatBtn');

                window.chatHistory = []; // কথোপকথনের ইতিহাস সংরক্ষণ করে

                // চ্যাট মুছুন বোতামের কার্যকারিতা
                if (clearChatBtn) {
                    clearChatBtn.addEventListener('click', () => {
                        if (chatWindow) chatWindow.innerHTML = '';
                        window.chatHistory = []; // ইতিহাস রিসেট করুন
                        addMessageToChat('হ্যালো! আমি আপনার টেক্সট অ্যাসিস্ট্যান্ট। আমি আপনাকে কীভাবে সাহায্য করতে পারি?', 'gemini');
                    });
                }

                // জেমিনিকে জিজ্ঞাসা করার বোতামের কার্যকারিতা
                if (askGeminiBtn) {
                    askGeminiBtn.addEventListener('click', handleAskGemini);
                }

                // Enter চেপে বার্তা পাঠানোর সুবিধা
                if (assistantInput) {
                    assistantInput.addEventListener('keydown', (e) => {
                        // Shift+Enter চাপলে নতুন লাইন তৈরি হবে, শুধু Enter চাপলে বার্তা যাবে
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault(); // ডিফল্ট Enter আচরণ (নতুন লাইন) বন্ধ করুন
                            handleAskGemini();
                        }
                    });
                }

                // --- ফন্ট কনভার্টার লিসেনার যোগ করুন ---
				// ====================================================================
// ====================================================================
// START: PASTE FROM CLIPBOARD FUNCTIONALITY (আপডেট করা হয়েছে)
// ====================================================================
async function pasteFromClipboard(textareaId) {
    const textarea = document.getElementById(textareaId);
    if (!textarea) return;

    try {
        const clipboardText = await navigator.clipboard.readText();
        if (!clipboardText) {
            showCustomAlert('ক্লিপবোর্ডে কোনো টেক্সট নেই।');
            return;
        }

        let textToInsert;
        let preset, customValue, serialCounter;
        let updateSerialCounter;
        let resetSerialCounter;

        // কোন টেক্সটএরিয়া ব্যবহার হচ্ছে তার উপর ভিত্তি করে ভেরিয়েবল সেট করুন
        if (textareaId === 'textAreaLeft') {
            preset = pastePresetLeft;
            customValue = customPasteValueLeft;
            serialCounter = customSerialCounterLeft;
            updateSerialCounter = (val) => { customSerialCounterLeft = val; };
            resetSerialCounter = () => { customSerialCounterLeft = 1; };
        } else { // textAreaRight
            preset = pastePresetRight;
            customValue = customPasteValueRight;
            serialCounter = customSerialCounterRight;
            updateSerialCounter = (val) => { customSerialCounterRight = val; };
            resetSerialCounter = () => { customSerialCounterRight = 1; };
        }
        
        // যদি 'custom-serial' প্রিসেট নির্বাচিত না থাকে, তাহলে সিরিয়াল কাউন্টার রিসেট করুন
        if (preset !== 'custom-serial') {
            resetSerialCounter();
        }
        
        let prefix = '';
        switch (preset) {
            case 'single-space':
                prefix = ' ';
                break;
            case 'double-space':
                prefix = '  ';
                break;
            case 'four-space':
                prefix = '    ';
                break;
            case 'single-enter':
                prefix = '\n';
                break;
            case 'double-enter':
                prefix = '\n\n';
                break;
            case 'custom':
                prefix = customValue || '';
                break;
            case 'custom-serial':
                // সিরিয়াল নম্বরের জন্য {serial} স্ট্রিংটি প্রতিস্থাপন করুন
                prefix = customValue ? customValue.replace(/\{serial\}/g, serialCounter) : '';
                updateSerialCounter(serialCounter + 1);
                break;
        }
        
        // যদি টেক্সটবক্স খালি না থাকে তবেই শুধুমাত্র প্রিফিক্স যোগ করুন
        if (textarea.value !== '') {
            textToInsert = prefix + clipboardText;
        } else {
            textToInsert = clipboardText;
        }

        // --- কার্সরের অবস্থানে টেক্সট যুক্ত করুন ---
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const currentValue = textarea.value;

        const newValue = currentValue.substring(0, start) + textToInsert + currentValue.substring(end);
        textarea.value = newValue;

        // পেস্ট করা টেক্সটের শেষে কার্সরের অবস্থান আপডেট করুন
        const newCursorPosition = start + textToInsert.length;
        textarea.selectionStart = newCursorPosition;
        textarea.selectionEnd = newCursorPosition;
        textarea.focus();

        addState(textareaId); // আনডু/রিডু কার্যকারিতার জন্য
        showCustomAlert('টেক্সট পেস্ট করা হয়েছে!');

    } catch (err) {
        console.error('পেস্ট করতে ব্যর্থ:', err);
        showCustomAlert('পেস্ট করতে ব্যর্থ হয়েছে। ব্রাউজার পারমিশন চেক করুন।');
    }
}





// ====================================================================
// END: PASTE FROM CLIPBOARD FUNCTIONALITY
// ====================================================================
                const fixAnsiButton = document.getElementById('fixAnsiButton');
                if (fixAnsiButton) {
                    fixAnsiButton.addEventListener('click', () => fixAnsiText(true));
                }

                // *** সংশোধিত: প্রাথমিক বার্তাটি এখানে যোগ করা হয়েছে ***
                if (chatWindow && chatWindow.children.length === 0) {
                     addMessageToChat('হ্যালো! আমি আপনার টেক্সট অ্যাসিস্ট্যান্ট। আমি আপনাকে কীভাবে সাহায্য করতে পারি?', 'gemini');
                }
                
                // ইউনিট কনভার্টার ইনিশিয়ালাইজ করুন
                initializeUnitConverters();

// --- ফন্ট কনভার্টার লিসেনার যোগ করুন ---
const pasteButtonLeft = document.getElementById('pasteButtonLeft');
const pasteButtonRight = document.getElementById('pasteButtonRight');

if (pasteButtonLeft) {
    pasteButtonLeft.addEventListener('click', () => pasteFromClipboard('textAreaLeft'));
}

if (pasteButtonRight) {
    pasteButtonRight.addEventListener('click', () => pasteFromClipboard('textAreaRight'));
}

            } catch (e) {
                console.error('DOMContentLoaded এক্সিকিউশনের সময় একটি ত্রুটি ঘটেছে:', e);
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    const errorMessageDiv = document.createElement('div');
                    errorMessageDiv.className = 'text-red-600 font-bold mt-4 p-4 border border-red-300 rounded-lg';
                    errorMessageDiv.innerText = 'অ্যাপ লোড করতে সমস্যা হয়েছে। অনুগ্রহ করে কনসোল চেক করুন।';
                    mainContainer.prepend(errorMessageDiv);
                }
            }
			
        });

// আবহাওয়া ডেটা আনার জন্য JavaScript কোড
// আবহাওয়া কোডগুলোকে বাংলায় রূপান্তর করার জন্য একটি ম্যাপ
const weatherCodes = {
    0: {
        text: "পরিষ্কার আকাশ",
        icon: "☀️"
    },
    1: {
        text: "প্রধানত পরিষ্কার",
        icon: "🌤️"
    },
    2: {
        text: "আংশিক মেঘলা",
        icon: "⛅"
    },
    3: {
        text: "মেঘলা",
        icon: "☁️"
    },
    45: {
        text: "কুয়াশা",
        icon: "🌫️"
    },
    48: {
        text: "হিম কুয়াশা",
        icon: "🌫️"
    },
    51: {
        text: "হালকা গুঁড়ি গুঁড়ি বৃষ্টি",
        icon: "🌧️"
    },
    53: {
        text: "মাঝারি গুঁড়ি গুঁড়ি বৃষ্টি",
        icon: "🌧️"
    },
    55: {
        text: "ঘন গুঁড়ি গুঁড়ি বৃষ্টি",
        icon: "🌧️"
    },
    56: {
        text: "হালকা হিমায়িত গুঁড়ি গুঁড়ি বৃষ্টি",
        icon: "🌧️"
    },
    57: {
        text: "ঘন হিমায়িত গুঁড়ি গুঁড়ি বৃষ্টি",
        icon: "🌧️"
    },
    61: {
        text: "হালকা বৃষ্টি",
        icon: "🌧️"
    },
    63: {
        text: "মাঝারি বৃষ্টি",
        icon: "🌧️"
    },
    65: {
        text: "প্রবল বৃষ্টি",
        icon: "🌧️"
    },
    66: {
        text: "হালকা হিমায়িত বৃষ্টি",
        icon: "🌧️"
    },
    67: {
        text: "ঘন হিমায়িত বৃষ্টি",
        icon: "🌧️"
    },
    71: {
        text: "হালকা তুষারপাত",
        icon: "🌨️"
    },
    73: {
        text: "মাঝারি তুষারপাত",
        icon: "🌨️"
    },
    75: {
        text: "প্রবল তুষারপাত",
        icon: "🌨️"
    },
    77: {
        text: "তুষার দানা",
        icon: "❄️"
    },
    80: {
        text: "হালকা বৃষ্টি",
        icon: "🌧️"
    },
    81: {
        text: "মাঝারি বৃষ্টি",
        icon: "🌧️"
    },
    82: {
        text: "প্রবল বৃষ্টি",
        icon: "🌧️"
    },
    85: {
        text: "হালকা তুষার বৃষ্টি",
        icon: "🌨️"
    },
    86: {
        text: "প্রবল তুষার বৃষ্টি",
        icon: "🌨️"
    },
    95: {
        text: "বজ্রপাতসহ ঝড়",
        icon: "⛈️"
    },
    96: {
        text: "বজ্রপাতসহ হালকা শিলাবৃষ্টি",
        icon: "⛈️"
    },
    99: {
        text: "বজ্রপাতসহ প্রবল শিলাবৃষ্টি",
        icon: "⛈️"
    }
};

// তারিখকে বাংলায় রূপান্তর করার জন্য ফাংশন
function getBanglaDay(date) {
    const days = ['রবিবার', 'সোমবার', 'মঙ্গলবার', 'বুধবার', 'বৃহস্পতিবার', 'শুক্রবার', 'শনিবার'];
    return days[date.getDay()];
}

// আবহাওয়ার ডেটা আনা এবং রেন্ডার করার জন্য মূল ফাংশন
async function fetchAndDisplayWeather(latitude, longitude, locationName) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=8`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const forecastContainer = document.getElementById('forecast-container');
        const weatherSection = document.getElementById('weather-section');
        const locationNameEl = document.getElementById('location-name');

        if (data.daily) {
            forecastContainer.innerHTML = ''; // পুরোনো ডেটা মুছে ফেলা
            locationNameEl.textContent = locationName;

            // প্রতিদিনের জন্য কার্ড তৈরি করা
            for (let i = 0; i < data.daily.time.length; i++) {
                const date = new Date(data.daily.time[i]);
                const day = i === 0 ? "আজ" : getBanglaDay(date);
                const maxTemp = Math.round(data.daily.temperature_2m_max[i]);
                const minTemp = Math.round(data.daily.temperature_2m_min[i]);
                const weatherCode = data.daily.weathercode[i];
                const weatherInfo = weatherCodes[weatherCode] || {
                    text: 'তথ্য নেই',
                    icon: '❓'
                };

                const cardHtml = `
                    <div class="bg-gray-700 p-4 rounded-lg text-center text-white shadow-md transform transition-transform hover:scale-105">
                        <p class="text-xl font-bold">${day}</p>
                        <p class="text-4xl my-2">${weatherInfo.icon}</p>
                        <p class="text-lg font-semibold">${weatherInfo.text}</p>
                        <p class="text-sm">সর্বোচ্চ: ${maxTemp}°C</p>
                        <p class="text-sm">সর্বনিম্ন: ${minTemp}°C</p>
                    </div>
                `;
                forecastContainer.innerHTML += cardHtml;
            }
            weatherSection.classList.remove('hidden'); // সেকশন দৃশ্যমান করা
        } else {
            console.error('আবহাওয়ার ডেটা লোড করা যায়নি:', data);
        }
    } catch (error) {
        console.error('আবহাওয়ার ডেটা আনার সময় ত্রুটি:', error);
    }
}

// জিওকোডিং এপিআই ব্যবহার করে শহরের নাম থেকে অক্ষাংশ ও দ্রাঘিমাংশ খুঁজে বের করার ফাংশন
async function searchLocation(locationName) {
    const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(locationName)}&count=1&language=bn`;

    try {
        const response = await fetch(geocodingUrl);
        const data = await response.json();
        const locationNameEl = document.getElementById('location-name');

        if (data.results && data.results.length > 0) {
            const firstResult = data.results[0];
            fetchAndDisplayWeather(firstResult.latitude, firstResult.longitude, firstResult.name);
        } else {
            locationNameEl.textContent = 'অবস্থান খুঁজে পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
            console.warn('অবস্থান খুঁজে পাওয়া যায়নি।');
        }
    } catch (error) {
        console.error('অবস্থান অনুসন্ধানের সময় ত্রুটি:', error);
        document.getElementById('location-name').textContent = 'অবস্থান অনুসন্ধানের সময় একটি ত্রুটি হয়েছে।';
    }
}

// পেজ লোড হলে ডিফল্ট অবস্থান (ঢাকা) এর জন্য আবহাওয়ার ডেটা লোড করা
document.addEventListener('DOMContentLoaded', () => {
    searchLocation('Dhaka');

    const searchButton = document.getElementById('search-weather-button');
    const searchInput = document.getElementById('location-search-input');

    searchButton.addEventListener('click', () => {
        const location = searchInput.value;
        if (location) {
            searchLocation(location);
        }
    });

    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const location = searchInput.value;
            if (location) {
                searchLocation(location);
            }
        }
    });
});

        window.onload = function() {
            const preloader = document.getElementById('preloader');
            const mainContainer = document.querySelector('.main-container');

            if (preloader) {
                // প্রি-লোডার লুকানোর জন্য ক্লাস যোগ করুন
                preloader.classList.add('preloader-hidden');

                // প্রি-লোডারের ট্রানজিশন (fade-out) শেষ হওয়ার জন্য অপেক্ষা করুন
                preloader.addEventListener('transitionend', () => {
                    if (mainContainer) {
                        // মূল কন্টেন্ট দৃশ্যমান করুন
                        mainContainer.style.visibility = 'visible';
                        // একটি সুন্দর ফেড-ইন অ্যানিমেশন প্রয়োগ করুন (ডিউরেশন এখানে পরিবর্তন করুন)
                        mainContainer.style.animation = 'fadeInContent 2s ease-out forwards'; // 0.75s থেকে 2s করা হয়েছে
                    }
                }, {
                    once: true
                }); // ইভেন্টটি কেবল একবার চালানোর জন্য
            } else {
                // যদি কোনো কারণে প্রি-লোডার না থাকে, তাহলে সরাসরি কন্টেন্ট দেখান
                if (mainContainer) {
                    mainContainer.style.visibility = 'visible';
                    mainContainer.style.opacity = '1';
                }
            }
        };

    </script>
</body>
</html>
